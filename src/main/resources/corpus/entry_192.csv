2019,A Robust Non-Clairvoyant Dynamic Mechanism for Contextual Auctions,Dynamic mechanisms offer powerful techniques to improve on both revenue and efficiency by linking sequential auctions using state information  but these techniques rely on exact distributional information of the buyers’ valuations (present and future)  which limits their use in learning settings. In this paper  we consider the problem of contextual auctions where the seller gradually learns a model of the buyer's valuation as a function of the context (e.g.  item features) and seeks a pricing policy that optimizes revenue. Building on the concept of a bank account mechanism---a special class of dynamic mechanisms that is known to be revenue-optimal---we develop a non-clairvoyant dynamic mechanism that is robust to both estimation errors in the buyer's value distribution and strategic behavior on the part of the buyer. We then tailor its structure to achieve a policy with provably low regret against a constant approximation of the optimal dynamic mechanism in contextual auctions. Our result substantially improves on previous results that only provide revenue guarantees against static benchmarks.,A Robust Non-Clairvoyant Dynamic Mechanism for

Contextual Auctions

Yuan Deng

ericdy@cs.duke.edu

Duke University

Durham  NC

Sébastien Lahaie
Google Research
New York City  NY

slahaie@google.com

Vahab Mirrokni
Google Research
New York City  NY

mirrokni@google.com

Abstract

Dynamic mechanisms offer powerful techniques to improve on both revenue and
efﬁciency by linking sequential auctions using state information  but these tech-
niques rely on exact distributional information of the buyers’ valuations (present
and future)  which limits their use in learning settings. In this paper  we consider
the problem of contextual auctions where the seller gradually learns a model of
the buyer’s valuation as a function of the context (e.g.  item features) and seeks a
pricing policy that optimizes revenue. Building on the concept of a bank account
mechanism—a special class of dynamic mechanisms that is known to be revenue-
optimal—we develop a non-clairvoyant dynamic mechanism that is robust to both
estimation errors in the buyer’s value distribution and strategic behavior on the
part of the buyer. We then tailor its structure to achieve a policy with provably
low regret against a constant approximation of the optimal dynamic mechanism in
contextual auctions. Our result substantially improves on previous results that only
provide revenue guarantees against static benchmarks.

1

Introduction

As a fundamental problem in mechanism design  pricing in repeated auctions has been extensively
studied in recent years. This is partly motivated by the popularity of selling online ads via auctions 
an industry totalling annual revenue of hundreds of billions of dollars. Repeated auctions open up
the possibility of linking auctions across time using state information in order to enhance revenue
or welfare  but this introduces several challenges. To guarantee optimal outcomes  the process must
take into account the bidders’ incentives to possibly manipulate each individual auction as well as the
auction state across time. In practice  the seller must also rely on approximate models of the buyers’
preferences to effectively set auction parameters like reserve prices. These aspects of the problem
have so far been explored in two separate strands of the literature on repeated auctions  where items
arrive online and the allocation and payment decisions must be made as soon as an item arrives.
One strand  known as dynamic mechanism design  considers an environment in which the seller has
exact distributional information over the buyers’ values for the items  for the current stage and all
future stages  and designs revenue-maximizing dynamic mechanisms that adapt the auction state
based on the buyer’s historical bids [Thomas and Worrall  1990  Bergemann and Välimäki  2010 
Ashlagi et al.  2016  Mirrokni et al.  2016a b]. However  this clairvoyant framework relies on the
seller having an accurate forecast of the buyer’s valuation distributions in future auctions. To address
this concern  Mirrokni et al. [2018] propose non-clairvoyant dynamic mechanisms  which do not rely
on any information about the future (but do rely on an accurate forecast of the present). They show
that a non-clairvoyant dynamic mechanism can achieve a constant approximation to the revenue of
the optimal clairvoyant mechanism. The other strand of literature  known as robust price learning 
focuses on a setting where the buyer’s value distributions across stages are parameterized by some
common private factors that are unknown to the seller  and designs robust policies to learn from the

33rd Conference on Neural Information Processing Systems (NeurIPS 2019)  Vancouver  Canada.

buyer’s bids and set prices with good revenue performance [Amin et al.  2013  2014  Medina and
Mohri  2014  Golrezaei et al.  2018]. Although these results also take into account strategic buyer
behavior  they only provide guarantees against the revenue-optimal static benchmark  which does not
take advantage of auction state across time and whose revenue can be arbitrarily smaller than the
optimal dynamic benchmark [Papadimitriou et al.  2016].
In this work  we consider a scenario in which the designer can only make use of an estimate of the
buyer’s value distribution in the present auction stage  which connects dynamic mechanism design
with the problem of learning. Designing dynamic auctions in this setting is challenging for several
reasons. When the seller’s estimate of the distribution is not perfectly aligned with the buyer’s true
distribution  it is impossible for the seller to offer a dynamic mechanism that is exactly incentive-
compatible and also makes use of the prior on values. Furthermore  unlike static mechanisms in
which the auction for each item is independent of the buyer’s past reports  in a dynamic mechanism a
buyer’s misreport can potentially affect auctions for all future items. We overcome these obstacles and
provide a robust non-clairvoyant dynamic mechanism such that the extent of the buyers’ misreports
and the revenue loss can be related to and bounded by the estimation error. We then apply our
robust dynamic mechanism to the concrete problem of contextual auctions  where a buyer’s valuation
depends on the context that describes the item  but the relationship between the buyer’s valuation
and the context is unknown to the seller and must be estimated across auctions. The seller’s task is
to design a policy which adapts the auction mechanism based on the buyer’s historical bids  with
the objective of maximizing revenue. Previous results give no-regret policies against the optimal
static mechanism [Amin et al.  2014  Golrezaei et al.  2018]  but as mentioned it is known that the
revenue gap between optimal static and dynamic mechanisms can be arbitrarily large [Papadimitriou
et al.  2016]. We tailor the structure of our robust non-clairvoyant dynamic mechanism to a learning
environment  leading to a no-regret policy against the strong benchmark of a constant approximation
of the optimal clairvoyant dynamic mechanism.

Related Work We brieﬂy discuss research in dynamic mechanism design that is closely related
to the present work. For a comprehensive review of the literature readers are encouraged to refer
to [Bergemann and Said  2011]. Papadimitriou et al. [2016] provide an example demonstrating
that the revenue gap between optimal static and the dynamic mechanisms can be arbitrarily large 
which is a key motivation for the use of dynamic mechanisms in our setting. Moreover  they show
that it is NP-Hard to design the optimal deterministic auctions even in an environment with a
single buyer and two items only. Ashlagi et al. [2016] and Mirrokni et al. [2016b] simultaneously
and independently provide a fully polynomial-time approximation scheme to compute the optimal
randomized mechanism. Our work builds upon the framework of bank account mechanisms developed
by Mirrokni et al. [2016a b  2018]. Based on the bank account mechanism  Mirrokni et al. [2018]
design a non-clairvoyant mechanism achieving 1/3 of the revenue of a clairvoyant mechanism.
However  their mechanism relies on exact distributional information  which makes it unsuitable in
a learning environment where value distributions are estimated. Our robust dynamic mechanism
addresses this limitation.
Our work is closely related to dynamic pricing with learning; see [den Boer  2015] for a recent
survey. There has been a growing body of literature on learning in dynamic pricing in contextual
auctions with non-strategic buyers [Cohen et al.  2016  Lobel et al.  2018  Leme and Schneider  2018 
Mao et al.  2018]. In their models  the buyers have homogeneous valuations and are non-strategic 
and thus  the problem can be reduced to a single-item setting where the buyer acts myopically
without considering the impact on the future auction from their current bids. However  Edelman and
Ostrovsky [2007] provide empirical evidence that the buyers participating in the online advertising
markets do act strategically. The study of robust price learning with strategic buyers was initiated by
Amin et al. [2013] and Medina and Mohri [2014]. They design no-regret policies in a non-contextual
environment where the buyer’s valuation is ﬁxed and the seller repeatedly interacts with a single buyer
through posted price auctions  where the buyer is less patient than the seller. The regret guarantee
is later improved to Θ(log log T ) by Drutsa [2017  2018]. Amin et al. [2013] show that no learning
algorithm can achieve sublinear revenue loss if the buyer is as patient as the seller.
For learning in contextual auctions  Amin et al. [2014] develop a no-regret policy in a setting without
market noise. Golrezaei et al. [2018] enrich the model by incorporating market noise and design a
no-regret policy for cases where the market noise is known exactly or adversarially selected from
a set of distributions. Liu et al. [2018] apply techniques from differential privacy to learn optimal

2

reserve prices against non-myopic bidders. All these results are no-regret against the optimal static
mechanism as a benchmark  whereas our policy is no-regret against a constant-factor approximation
of the optimal dynamic mechanism which has all distributional information available in advance.

2 Preliminaries

In a dynamic auction a seller (he) sells a stream of T items that arrive online  based on bids placed
by strategic buyers. An item must be sold when it arrives. For the sake of simplicity we will focus
on the case of a single buyer (she) throughout this paper.1 At the beginning of stage t a new item
arrives and the buyer’s valuation vt ∈ [0  at] for the item is drawn independently from a distribution
Ft with density ft. The distributions are not necessarily identical across stages. We assume that ft is
continuous and upper bounded by cf /at where cf is a constant. The domain bounds at are known to
the seller and may vary across stages to reﬂect the fact that item valuations may have different scales.2
As a special case of this framework  in a contextual auction the item at stage t is represented by an
observable feature vector ζt ∈ Rd with (cid:107)ζt(cid:107)2 ≤ 1. In line with the literature  we assume that the
feature vectors are drawn independently from a ﬁxed distribution D with positive-deﬁnite covariance
matrix [Golrezaei et al.  2018]. The buyer’s preferences are encoded by a ﬁxed vector σ ∈ Rd and
the buyer’s valuation at stage t takes the form vt = at((cid:104)σ  ζt(cid:105) + εt)  where εt is a noise term with
cumulative distribution Mt. The distribution Mt and the feature vector ζt are observed by the seller
but the buyer’s preference vector σ remains private. We make the following technical assumption on
the sequence of at:

Assumption 1. For all t (cid:80)

t(cid:48)≤t at(cid:48) ≤ ca · t where ca is a constant.

Assumption 1 limits the portion of welfare and revenue that can arise in the ﬁrst t stages  for any t.
Its purpose is to rule out situations where a large fraction of revenue comes from the initial stages 
under which a large revenue loss may be inevitable since it is impossible for the seller to obtain a
good estimate of σ from just the ﬁrst few stages.
Once the buyer learns her valuation vt at stage t  she then submits a bid bt ∈ [0  at] to the seller who
then decides whether to allocate the item (perhaps stochastically) and what payment to charge. We
write V t to denote the set of all possible sequences (b1  . . .   bt) of buyer bids for the ﬁrst t stages 
and similarly we write (∆V )t to denote the set of all possible independent distributions over the
sequence of ﬁrst t bids. The seller’s distributional beliefs over the buyer’s values across stages are
denoted as ˆF(1 T ) = ( ˆF1  ˆF2  . . .   ˆFT ). Throughout the paper we will use the notation ˆF(t(cid:48) t(cid:48)(cid:48)) to
represent ( ˆFt(cid:48)  . . .   ˆFt(cid:48)(cid:48))  and similarly for F(t(cid:48) t(cid:48)(cid:48))  v(t(cid:48) t(cid:48)(cid:48))  and b(t(cid:48) t(cid:48)(cid:48)). A dynamic mechanism is
represented by sequences (x1  . . .   xT ) and (p1  . . .   pT ) where xt and pt denote the allocation rule
and the payment rule at stage t  respectively. We refer to (cid:104)xt  pt(cid:105) as the stage mechanism at stage t.
Non-Clairvoyant Dynamic Mechanism. In a non-clairvoyant environment  the seller obtains an
estimated distribution ˆFt only at stage t and not before  so the mechanism at stage t can only depend
on ˆF(1 t). The allocation function xt maps the history of bids b(1 t) and distribution ˆF(1 t) to an
allocation probability  xt : V t × (∆V )t → [0  1]. The payment function pt maps the history of bids
b(1 t) and the distribution ˆF(1 t) to a real-valued payment  pt : V t × (∆V )t → R. In line with the
literature  we assume the buyer has a quasi-linear utility such that the buyer’s utility from bidding bt
at stage t is ut
setting the seller maintains a model ˆσt for the buyer’s preference vector estimated from prior bidding
behavior  and combines with at  ζt  and noise model Mt  which can only be observed at the beginning
of stage t and not before  to compute ˆFt.
Utility-Maximizing Buyer. We assume that the buyer knows the true distributions F(1 T ) in advance
so that she can reason about how the mechanism will evolve over time and compute a bidding
strategy that maximizes her utility. Speciﬁcally  we consider a buyer who aims to maximize her time
t(cid:48)=t γt(cid:48)−t · E[ut] at stage t where γ ∈ [0  1) is the discounting factor and the

(cid:1). In the contextual auction

discounted utility(cid:80)T

(cid:0)vt; b(1 t); ˆF(1 t)

(cid:1) = vt · xt

(cid:0)b(1 t); ˆF(1 t)

(cid:1)− pt

(cid:0)b(1 t); ˆF(1 t)

1Our results can be extended to multi-buyer settings by using the techniques from Cai et al. [2012] and Mir-

rokni et al. [2018].

2For instance  in a dynamic auction for display advertising  the value of a video ad may be orders of

magnitude larger than the value of a text ad.

3

expectation is taken with respect to F(1 T ). We note that it is impossible to obtain a no-regret policy
when the buyer is as patient as the seller (the case of γ = 1) [Amin et al.  2013].
Incentive Constraints. In a dynamic environment  the buyer’s best response at stage t depends on
her strategy in the future stages. When the seller has perfect distributional information  the classic
notion of dynamic incentive-compatibility (DIC) requires that the buyer is incentivized to report
truthfully assuming that she plays optimally in the future [Mirrokni et al.  2018].3 When the seller
only has approximate distributional information this is no longer possible to achieve  so we introduce
the notion of η(1 T )-approximate DIC  which requires that the buyer’s bid deviate from the truth by
at most ηt at stage t  assuming the buyer plays optimally in the future (note that optimally now no
longer means truthfully). Formally  at each stage t  there exists ˆbt ∈ [vt − ηt  vt + ηt] such that

for all vt  b(1 t−1)  F(t+1 T )  and ˆF(t+1 T )  where Ut(b(1 t); F(1 T ); ˆF(1 T )) is the continuation
utility that the buyer obtains in the future: UT
Ut

ut

(cid:0)vt; b(1 t); ˆF(1 t)
(cid:1) is deﬁned as

(cid:1) + γ · Ut

(cid:0)b(1 t); F(1 T ); ˆF(1 T )
(cid:0)b(1 T ); F(1 T ); ˆF(1 T )
(cid:1) + γ · Ut+1

(cid:0)vt+1; b(1 t+1); ˆF(1 t+1)

(cid:1)
(cid:1) = 0  and for t < T

(η(1 T )-DIC)

(cid:0)b(1 t+1); F(1 T ); ˆF(1 T )

(cid:1)(cid:105)

.

ˆbt ∈ arg max

bt

(cid:0)b(1 t); F(1 T ); ˆF(1 T )
(cid:104)

Evt+1∼Ft+1

max
bt+1

ut+1

Participation Constraints. We assume that the buyer weighs realized past utilities equally. There-
fore  ex-post individual rationality requires that for all ˆF(1 T ) and for all v(1 T ) 

T(cid:88)

(cid:0)vt; v(1 t); ˆF(1 t)

(cid:1) ≥ 0.

ut

(ex-post IR)

t=1

For convenience  we will use the phrase “for F(1 T )” to indicate the environment where the buyer’s
true distribution is F(1 T ). For example  when we say that a mechanism is η(1 T )-DIC for F(1 T ) we
mean that it is η(1 T )-DIC when the buyer’s true distribution is F(1 T ).
No-Regret Policy. Our task is to design a policy π that includes both a learning policy for σ
and an associated dynamic mechanism policy to extract revenue. At the beginning of stage t  the
learning policy estimates ˆFt using information a(1 t)  ζ(1 t)  M(1 t)  and b(1 t−1)  while the dynamic
mechanism policy computes the stage mechanism (cid:104)xt  pt(cid:105) at stage t using ˆF(1 t) and b(1 t−1). Let
Rev(π; F(1 T )) and Rev(B; F(1 T )) be the revenue of implementing policy π and mechanism B for
F(1 T )  respectively. Moreover  let B∗(F(1 T )) denote the revenue-optimal clairvoyant dynamic
mechanism that knows F(1 T ) in advance. The regret of policy π against a c-approximation of the

dynamic benchmark is deﬁned as Regretπ(F(1 T )) = c · Rev(cid:0)B∗(F(1 T )); F(1 T )

(cid:1) − Rev(π; F(1 T )).

Our objective is to design a policy with sublinear regret.4

3 Robust Non-clairvoyant Mechanism

The literature on dynamic mechanism design relies on the strong assumption that the seller has
perfect distributional information at each stage  ˆF(1 T ) = F(1 T ) [Ashlagi et al.  2016  Mirrokni
et al.  2016b a  2018]. However  in a learning setting like that of contextual auctions  the seller
can only obtain a sequence of estimated distributions by estimating σ. In this section  we design a
non-clairvoyant mechanism that is robust to misspeciﬁcations in the value distribution in the sense
that the buyer is incentivized to place a bid within known bounds from its value  which ultimately
allows us to relate the mechanism revenue under the estimated and true value distributions. The
misspeciﬁcations handled by the mechanism are captured by the following assumption.
Assumption 2. There exists a coupling between a random draw vt from Ft and a random draw ˆvt
from ˆFt such that vt = ˆvt + at · t with t ∈ [−∆  ∆].

which is the case when(cid:80)T
Ω((cid:80)

3Interested readers can refer to [Mirrokni et al.  2018] for discussions on the choice of DIC notions.
4Note that sublinear revenue loss is only meaningful if the available revenue to extract is itself at least linear 
t=1 at = Ω(T ) since the revenue obtained by the optimal dynamic mechanism is
t at) revenue by offering a posted
price pat with p = 1/(2cf ) at stage t which induces revenue at least p· at(1− p· cf ) = at/(4cf ) from stage t.

t at) in our setting. In fact  a static mechanism can already achieve Ω((cid:80)

4

3.1 The Mechanism

t = 1  pG

t+1 = balt + bt

t = 0  and balG

(cid:104)(cid:0)vt − rt(balt)(cid:1)+(cid:105)

Building on the 1
3-approximation non-clairvoyant mechanism from Mirrokni et al. [2018]  we design
our robust non-clairvoyant mechanism by mixing their mechanism with a random posted-price
auction. The mechanism is an instance of a bank account mechanism where the state information is
captured by a single scalar balt.
Mechanism 1. The robust non-clairvoyant mechanism B( ˆF(1 T )  λ) consists of a mixture of four
mechanisms: the give-for-free mechanism  the posted-price auction with extra fee  the Myerson’s
auction  and the random posted-price auction. The stage mechanism at stage t is parameterized by a
non-negative balance balt. When the buyer submits a bid bt:
Give-for-free Mechanism. Allocate the item no matter what the buyer’s bid is and increase the
balance by the buyer’s bid: xG
Posted-price Auction with Extra Fee. Let feet(balt; ˆFt) = min(3balt  E
[vt]) and rt(balt) be
the posted-price such that E
= feet(balt; ˆFt). The mechanism charges the
buyer feet(balt; ˆFt) before the buyer learns her valuation and then runs a posted-price auction with
t = 1{bt ≥ rt(balt)} and pP
t = feet(balt; ˆFt) + rt(balt) · 1{bt ≥ rt(balt)}  and
price rt(balt): xP
t+1 = balt − feet(balt; ˆFt).
decrease the balance by feet(balt; ˆFt): balP
Myerson’s Auction. Let r∗

(cid:0)1 − ˆFt(r)(cid:1) and run a posted-price auction with price r∗

t ( ˆFt) be Myerson’s optimal reserve price  i.e.  r∗
t ( ˆFt) · 1{bt ≥ r∗

1{bt ≥ r∗
Random Posted-price Auction. Let ˆrt be random reserve price drawn from [0  at] uniformly and
run a posted-price auction with price ˆrt without changing the balance: xR
t =
ˆrt · 1{bt ≥ ˆrt}  and balR
The robust non-clairvoyant mechanism at stage t is: xt = λ · xR
λ · pR
balG

(cid:3)  and balt = λ · balR

t ( ˆFt) without changing the balance: xM
t+1 = balt.

t ( ˆFt) = arg maxr r ·
t =

t + xM
t + xP
t
t + balM
.
t

t = 1{bt ≥ ˆrt}  pR

t ( ˆFt)}  and balM

t ( ˆFt)}  pM

t = r∗

t + 1−λ
3
t + balP

(cid:3)  pt =

t + pP

t + pM
t

(cid:2)xG

t+1 = balt.

(cid:2)pG

t + 1−λ

3

t + 1−λ

3

vt∼ ˆFt

vt∼ ˆFt

(cid:105)

(cid:104)

The following central result gives a guarantee on the revenue performance of our robust non-
clairvoyant mechanism against a utility-maximizing buyer subject to an estimation error ∆.

Theorem 3.1. Rev(cid:0)B( ˆF(1 T )  λ)  F(1 T )

(cid:16)

(cid:1) − O

(cid:113) ∆

(cid:17)

.

λT +

λ T

(cid:1) ≥ 1
3 Rev(cid:0)B∗(F(1 T ))  F(1 T )
(cid:17)

(cid:16)

3 the revenue loss is O

∆ 1

3 T

. The remainder of this section is

At the optimal choice of λ = ∆ 1
devoted to proving Theorem 3.1.

3.2 Analysis

We start by describing the incentive properties that B( ˆF(1 T )  λ) satisﬁes for ˆF(1 T ). First notice that
all four base mechanisms are variants of posted-price auctions  and therefore  all of them are stage-IC:

∀bt  vt · xt(bal  vt) − pt(bal  vt) ≥ vt · xt(bal  bt) − pt(bal  bt).

(stage-IC)

In particular  all mechanisms except the posted-price auction with extra fee are stage-IR:

∀vt  vt · xt(vt) − pt(vt) ≥ 0

(stage-IR)
We emphasize that the posted-price auction with extra fee is different from a classic posted-price
auction: the posted-price auction with extra fee will charge the buyer an extra payment feet(balt; ˆFt)
no matter what the buyer’s bid is  and therefore  it is not stage-IR. Moreover  each stage mechanism
is balance-independent (BI) with respect to the estimated distribution ˆFt: there exists a constant ct 
(BI)
In particular  the give-for-free mechanism  the Myerson’s auction  and the random posted-price
auction are static and independent of the balance; as for the posted-price auction with extra fee  it
ensures that the buyer’s expected utility is always 0 for all balt ≥ 0 under ˆFt.

[vt · xt(bal  vt) − pt(bal  vt)] = ct.

E
vt∼ ˆFt

5

The combination of stage-IC and BI implies that the mechanism is DIC: since the mechanism
promises the buyer that all future stage mechanisms are BI  the buyer can infer that her action at the
current stage does not impact her expected utility in the future. Moreover  notice that the non-negative
balance bal always lower-bounds the buyer’s cumulative utility  and therefore  B( ˆF(1 T )  λ) is ex-post
IR under the estimated distributions ˆF(1 T ).
Proposition 3.1. B( ˆF(1 T )  λ) is stage-IC  BI  DIC  and ex-post IR for ˆF(1 T ).

We next turn to the mechanism’s properties under the true distributions F(1 T ).

3.2.1 Mismatch between ˆF(1 T ) and F(1 T )

We ﬁrst bound the revenue loss due to the mismatch between ˆF(1 T ) and F(1 T ). Observe that one can
interpret the estimation error under Assumption 2 as the buyer’s misreport: when the buyer reports
truthfully under F(1 T ) this is equivalent to the case in which the buyer misreports by a magnitude at
most at · ∆ under ˆF(1 T ). We develop a program for computing the revenue of our mechanism even
when the buyer misreports. For a non-clairvoyant mechanism B( ˆF(1 T )  λ)  we consider a program
ψt(bal  ˆF(1 T ); F(1 T )) to keep track on the revenue of implementing B( ˆF(1 T )  λ) when the buyer’s
true distribution is F(1 T ). We deﬁne ψT (bal) = 0 and for t < T  

ψt−1(bal  ˆF(1 T ); F(1 T )) = Evt∼Ft

feet(bal; ˆFt) +

t ( ˆFt) · 1{v(cid:48)
r∗

t ≥ r∗

t ( ˆFt)}

(cid:20) 1

3

(cid:18)

1
3
t − 1
v(cid:48)
3

1
3

(cid:19)(cid:21)

(1)

+ ψt

bal +

feet(bal; ˆFt)  ˆF(1 T ); F(1 T )

where v(cid:48)
t is the buyer’s reported bid that maximizes her continuation utility when her true value is vt.
Recall that conditioned on that the stage mechanism is not the random posted-price auction  with
3 probability  we run the posted-price auction with extra fee and extract feet(bal; ˆFt) as revenue.
1
Here  we omit the revenue rt(balt) obtained from the posted-price auction with extra fee. In addition 
t ( ˆFt).
with another 1
Moreover  the balance is increased by v(cid:48)
3 from the give-for-free mechanism and
decreased by 1

3 probability  we run the Myerson’s auction and extract r∗

t ( ˆFt) revenue if v(cid:48)

t ≥ r∗

t with probability 1
3 from the posted-price auction.

(cid:17) ≥ (1 − λ) · ψ0(0  ˆF(1 T ); F(1 T )).

Proposition 3.2. Rev

3 feet(bal) with probability 1
B( ˆF(1 T )  λ); F(1 T )

(cid:16)

3-approximation of

3 · Rev(cid:0)B∗(F(1 T ))  F(1 T )

According to the revenue analysis in [Mirrokni et al.  2018]  we can still obtain 1
the optimal revenue even when the revenue rt(balt) is omitted.
Lemma 3.1. [Mirrokni et al.  2018] ψ0(0  F(1 T ); F(1 T )) ≥ 1
The following lemma establishes a connection between the change of the balance and the change of
the revenue  when the seller’s distributional information is perfect so that the buyer does not misreport.
In particular  it shows that as balance increases by δ  the change of the future revenue is between 0
and δ. Therefore  it demonstrates the smoothness of revenue curve such that if the buyer misreports at
stage t to change the balance by δ  then the revenue loss is at most δ for the future stages  assuming
the buyer reports truthfully in the future.
Lemma 3.2. For all 0 ≤ t ≤ T and δ ≥ 0 

(cid:1).

ψt(bal + δ  F(1 T ); F(1 T )) − δ ≤ ψt(bal  F(1 T ); F(1 T )) ≤ ψt(bal + δ  F(1 T ); F(1 T )).

Applying Lemma 3.2 with Assumption 2  we can bound the revenue loss due to the mismatch between
F(1 T ) and ˆF(1 T ). More precisely  we will bound the difference between ψ0(0  F(1 T ); F(1 T )) and
ψ0(0  ˆF(1 T ); ˆF(1 T )). Notice that B(F(1 T )) is dynamic incentive-compatible for F(1 T )  and thus 
the buyer will not misreport  i.e.  v(cid:48)
t = vt in (1); similarly for ˆF(1 T ).
Lemma 3.3. ψ0(0  ˆF(1 T ); ˆF(1 T )) ≥ ψ0(0  F(1 T ); F(1 T )) − O(∆T ).

6

3.2.2 The Buyer’s Misreport

Note that in a single-buyer environment  the properties stage-IC and ex-post IR do not depend on
the underlying distributions  and therefore  B( ˆF(1 T )  λ) is also stage-IC and ex-post IR for F(1 T ).
However  B( ˆF(1 T )  λ) is no longer BI for F(1 T )  which is the key property to ensure DIC. To
circumvent this difﬁculty  we generalize the deﬁnition of BI to approximate balance-independence.
Deﬁnition 3.1. A dynamic mechanism is β(1 T )-BI for F(1 T ) if ∀t  there exists a constant ct:

∀bal ≥ 0  Evt∼Ft[vt · xt(bal  vt) − pt(bal  vt)] ∈ [ct − βt
2

  ct +

βt
2

]

(β(1 T )-BI)

Since with the same stage mechanism  the difference between the expected utility under ˆFt and Ft is
at most ∆at  B( ˆF(1 T )  λ) is β(1 T )-BI with βt = 2∆at.
Proposition 3.3. B( ˆF(1 T )  λ) is stage-IC  β(1 T )-BI with βt = 2∆at  and ex-post IR for F(1 T ).
For a dynamic mechanism satisfying β(1 T )-BI for F(1 T )  the range of the buyer’s expected utility
under truthful reporting is βt in the t-th stage. Therefore  no matter how the buyer misreports in the
ﬁrst (t − 1) stages  her expected utility in the t-th stage can only ﬂuctuate at most βt if she reports
truthfully at stage t. Combining this with the fact that the stage mechanisms are stage-IC  we have
Lemma 3.4. For a dynamic mechanism that is stage-IC and β(1 T )-BI for F(1 T )  for any b(1 t−1) and
vt  the difference between the continuation utility of reporting any bt ∈ [0  at] and the continuation

utility of reporting vt truthfully is bounded by(cid:80)T

t(cid:48)=t+1 γt(cid:48)−t · βt(cid:48).

Lemma 3.4 states that the gain of the continuation utility by misreporting is bounded and the bound
is independent of the magnitude of the misreport. The key observation behind Lemma 3.4 is that at
stage t  the buyer obtains the maximum utility when she reports truthfully since the stage mechanism
is stage-IC. Therefore  by the property of β(1 T )-BI  the difference of utility between misreporting in
an optimal way and reporting truthfully is at most βt at stage t.
As a result  once the mechanism posts a risk for misreporting  we are able to bound the magnitude
of the buyer’s misreport. This is the purpose of mixing in the random posted-price mechanism at
each stage t: it can be shown that a misreport with magnitude mt will cause the buyer a utility loss
λ · m2
. Since the buyer is a utility-maximizer with discounting factor γ  we can bound the magnitude
of misreport for each stage:
Lemma 3.5. B( ˆF(1 T )  λ) is η(1 T )-DIC with ηt =

(cid:113) 2at
λ ·(cid:80)T

t(cid:48)=t+1 γt(cid:48)−tβt(cid:48).

t
2at

Applying Lemma 3.2  we can show that B( ˆF(1 T )  λ) is robust against the buyer’s misreport. We
abuse the notion to use ψ0(0  ˆF(1 T ); F(1 T )) to track the revenue conditioned on that the magnitude
of the buyer’s misreport at stage t is bounded by ηt.
Lemma 3.6. ψ0(0  ˆF(1 T ); F(1 T )) ≥ ψ0(0  ˆF(1 T ); ˆF(1 T )) − O

(cid:16)(cid:113) ∆

(cid:17)

λ T

.

Finally  combining Proposition 3.2  Lemma 3.3 and Lemma 3.6  completes the proof of Theorem 3.1.

4 No-Regret Policy in Contextual Auctions

4.1 Learning Policy

Our learning policy is adapted from the contextual robust pricing policy proposed in [Golrezaei et al. 
2018]. Our learning policy partitions the entire time horizon into K = (cid:100)log T(cid:101) phases where T is the
time horizon  such that the partition is speciﬁed by ((cid:96)1 = 1  (cid:96)2 ···   (cid:96)K  (cid:96)K+1 = T + 1)  in which
(cid:96)k = 2k−1. The k-th phase spans between the (cid:96)k-th stage and the ((cid:96)k+1 − 1)-th stage  and therefore 
the length of phase k is exactly (cid:96)k. Note that the partition can be implemented even when T is not
known in advance. We use Ek = {(cid:96)k ···   (cid:96)k+1 − 1} to refer to the stages in the k-th phase.
At the beginning of the k-th phase  we update the estimation of the buyer’s preference vector σ using
the buyer’s bids from the (k − 1)-th phase  denoted by ˆσk. To estimate ˆσk  we sample wt uniformly

7

from [0  1] for t ∈ ˆEk−1  where ˆEk−1 = {t ∈ Ek−1 | (cid:96)k − t > c log (cid:96)k} for some constant c. In
other words  we will only use the information from the stages that are at least c log (cid:96)k ahead of the
end of phase (k − 1). ˆσk is set to be arg min(cid:107)σ(cid:107)≤1 Lk−1(σ)  where

Lk−1(σ) = − (cid:88)

t∈ ˆEk−1

(cid:104)
1{bt ≥ at · wt} log(cid:0)1 − Mt(wt − (cid:104)σ  ζt(cid:105))(cid:1)
+ 1{bt < at · wt} log(cid:0)Mt(wt − (cid:104)σ  ζt(cid:105))(cid:1)(cid:105)

.

Note that when the buyer reports truthfully  Lk−1(σ) is exactly the negative of log-likelihood
corresponding to σ. We do not change our estimation throughout the k-th phase and the next update
happens at the beginning of the (k + 1)-phase. As a result  based on the estimate ˆσk  we compute the
estimated distribution in phase k as ˆFt(vt) = Mt
We say a lie is a misreport from the buyer that results in 1{bt ≥ at · wt} (cid:54)= 1{vt ≥ at · wt}. Let

− (cid:104) ˆσk  ζt(cid:105)(cid:17)

Lk−1 =(cid:8)t ∈ ˆEk−1 | 1{bt ≥ at · wt} (cid:54)= 1{vt ≥ at · wt}(cid:9)

for all t ∈ Ek.

(cid:16) vt

at

be the set of stages in which the buyer lies. For a dynamic mechanism that is η(1 T )-DIC  we have
vt − ηt ≤ bt ≤ vt + ηt. Hence  if |at · wt − vt| > ηt  any misreport from the buyer does not result in
a lie. Moreover  the buyer has an additional motivation to misreport to change the seller’s estimation
for the future phases. However  for t ∈ ˆEk−1  such a gain is relatively small since the buyer discounts
the future.
Let B( ˆF(1 T )  λ(1 K)) be a mechanism generalized from B( ˆF(1 T )  λ) such that for t ∈ Ek 
B( ˆF(1 T )  λ(1 K)) offers the random posted-price auction with probability λk instead of λ.
Lemma 4.1. In B( ˆF(1 T )  λ(1 K))  the additional misreport at stage t ∈ ˆEk is O(
|Lk| = O
Given this upper bound on |Lk−1|  the following lemma bounds the estimation error of ˆσk.
Lemma 4.2 (Proposition 7.1 [Golrezaei et al.  2018]). With probability 1 − 1
for phase k is ∆k ≡ (cid:107) ˆσk − σ(cid:107) = O

(cid:16)
log (cid:96)k +(cid:80)

(cid:113) log((cid:96)k−1·d)

with probability 1 − 1

  the estimation error

d · |Lk−1|

). Moreover 

t∈ ˆEk

(cid:16)

1√

λk·(cid:96)2

k

(cid:17)

(cid:17)

.

.

(cid:96)k

ηt
at

(cid:96)k

+

(cid:96)k−1

(cid:96)k−1

4.2 Dynamic Mechanism Policy

We develop a hybrid non-clairvoyant mechanism to reduce the number of lies by reducing the
magnitude of misreports. To do so  observe that the buyer has no incentive to misreport in order
to affect future stage mechanisms when the latter are static. However  as previously mentioned 
offering a purely static mechanism may forego a large amount of revenue [Papadimitriou et al.  2016].
Motivated by this insight  our hybrid mechanism contains both dynamic stages dependent on the
history and static stages independent of the history. We adapt B( ˆF(1 T )  λ(1 K)) to obtain a hybrid
non-clairvoyant mechanism Bhybrid( ˆF(1 T )  λ(1 K)  ω  τ )  which is parameterized by ω ∈ (0  1) and
a function τ : Z+ → R+ that maps the phase number to a real number. The stage mechanism at stage
t is parameterized by at  two balances balt and sbalt  and an additional parameter swt. We provide a
high level description of our mechanism while a detailed description is deferred to the full version.
k = {t ∈ Ek | at < (cid:96)ω
k}. Intuitively  the hybrid non-clairvoyant mechanism runs different
Let Eω
stage mechanisms conditioned on whether t ∈ Eω
k or not: the stage mechanism is dynamic for
k and the stage mechanism is static for t ∈ Eω
t (cid:54)∈ Eω
k with high probability.
More precisely  for t (cid:54)∈ Eω
k   the stage mechanisms are exactly the same as B( ˆF(1 T )  λ(1 K)) and in
(cid:80)
particular  the posted-price auction with extra fee only uses the balance from balt. For t ∈ Eω
k   the
give-for-free mechanism and the Myerson’s auction remain the same. We use swt to keep track of the
E
vt(cid:48)∼ ˆFt(cid:48) [vt(cid:48)]. If swt < τ (k)  we turn
summation of expected valuations  i.e.  swt = 1
3
the posted-price auction with extra fee into a give-for-free mechanism  but we increase the balance
sbal instead of bal; otherwise  we run the posted-price auction with extra fee  except that it only uses
the balance from sbal and it will in addition deposit the buyer’s utility to sbal.

k  t(cid:48)<t

t(cid:48)∈Eω

8

3

3

(cid:17)

[vt]

(cid:16)

= E

vt∼ ˆFt

vt∼ ˆFt

vt∼ ˆFt

3sbalt  E

and a Myerson’s auction with probability 1−λk

For t ∈ Eω
k and swt < τ (k)  the stage mechanism is static since it in fact runs a give-for-free
mechanism with probability 2(1−λk)
  both of which
are independent of the history. For t ∈ Eω
k and swt ≥ τ (k)  by choosing τ properly  we show that
with high probability  even if the buyer plays strategically  3sbalt ≥ E
[vt]  which implies that
[vt] so that the posted-price would be 0. Therefore  with high
min
probability  the hybrid posted-price auction with extra fee is a give-for-free mechanism with fee
E
[vt]  which is static and independent of balt and sbalt. To formally prove these statements 
vt∼ ˆFt
we exploit the fact that the dynamics of sbalt forms a martingale for stage t with swt ≥ τ (k).
Lemma 4.3. With τ (k) = Ω

(cid:1) −(cid:88)
Rev(cid:0)Bhybrid( ˆF(1 T )  λ(1 K)  ω  τ )  F(1 T )
 (cid:80)
Lemma 4.3 states that there exits a function γ such that the revenue loss is at most(cid:80)

(cid:113) ∆k
(cid:1) ≥ 1
Rev(cid:0)B∗(F(1 T ))  F(1 T )
≤ ˜O(cid:0)(cid:96)1−ω

k (τ (k) + λk · (cid:96)k)
and the number of lies is ˜O((cid:96)1−ω
). In particular  as ω increases  the revenue loss increases while the
number of lies decreases  and therefore  our hybrid non-clairvoyant mechanism achieves a trade-off
between the revenue loss and the number of lies.

and with probability at least 1 − 1

(τ (k) + λk · (cid:96)k)

for all k  we have

1
2 (1+ω)
(cid:96)
k

log (cid:96)k +

(cid:1).

t∈ ˆEk

ηt
at

(cid:96)k

λk

(cid:96)k

k

(cid:16)

k

3

k

√

(cid:17)

4.3 The Final Policy

Learning Policy: At the start of phase k  estimate ˆσk = arg min(cid:107)σ(cid:107)≤1 Lk−1(σ).

Dynamic Mechanism Policy: Bhybrid( ˆF(1 T )  λ(1 K)  1

2   τ ): at phase k

− 1
k

6

• λk = (cid:96)
• Compute the distributional information ˆFt for t ∈ Ek according to the estimation ˆσk;

and τ (k) = c∗(cid:96)

k ;

5
6

Figure 1: Robust Non-clairvoyant Dynamic Contextual Auction Policy

We are now ready to combine our learning policy and dynamic mechanism policy to obtain our
no-regret policy for contextual auctions in a non-clairvoyant environment (Figure 1). For our hybrid
non-clairvoyant mechanism  we will set ω = 1
k with a large enough
constant c∗. In particular  the estimation error for ˆσk is ∆k = O((cid:96)
Theorem 4.1. The T -stage regret of the robust non-clairvoyant dynamic contextual auction policy is
˜O(T 5

3 -approximation of the optimal clairvoyant dynamic mechanism.

− 1
k ) under our policy.

− 1
k   and τ (k) = c∗(cid:96)

6 ) against 1

2  λk = (cid:96)

5
6

2

6

5 Conclusion

In this paper  we present a framework of designing non-clairvoyant dynamic mechanisms that
are robust to both the estimation errors on the buyer’s distributional information and the buyer’s
strategic behavior. We then tailor our framework to the setting of contextual auctions to develop a
non-clairvoyant mechanism that achieves no-regret against 1
3-approximation of the revenue-optimal
clairvoyant dynamic mechanism. A natural direction for future work is to improve the regret guarantee
or to provide a matching lower bound. Moreover  it is interesting to understand how to apply our
framework to dynamic auction environments other than contextual auctions. Finally  it would also be
interesting to investigate what can be achieved when the seller has limited prediction power of the
future  a region between non-clairvoyant and clairvoyant environments.

9

References
Kareem Amin  Afshin Rostamizadeh  and Umar Syed. Learning prices for repeated auctions with
strategic buyers. In Advances in Neural Information Processing Systems  pages 1169–1177  2013.

Kareem Amin  Afshin Rostamizadeh  and Umar Syed. Repeated contextual auctions with strategic

buyers. In Advances in Neural Information Processing Systems  pages 622–630  2014.

Itai Ashlagi  Constantinos Daskalakis  and Nima Haghpanah. Sequential mechanisms with ex-
post participation guarantees. In Proceedings of the 2016 ACM Conference on Economics and
Computation  pages 213–214. ACM  2016.

Dirk Bergemann and Maher Said. Dynamic auctions. In Wiley Encyclopedia of Operations Research

and Management Science  2011.

Dirk Bergemann and Juuso Välimäki. The dynamic pivot mechanism. Econometrica  78(2):771–789 

2010.

Yang Cai  Constantinos Daskalakis  and S. Matthew Weinberg. An algorithmic characterization of
multi-dimensional mechanisms. In Proceedings of the 44th Annual ACM Symposium on Theory of
Computing  pages 459–478  2012.

Maxime C. Cohen  Ilan Lobel  and Renato Paes Leme. Feature-based dynamic pricing. In Proceedings
of the 2016 ACM Conference on Economics and Computation  EC ’16  pages 817–817  New York 
NY  USA  2016. ACM. ISBN 978-1-4503-3936-0.

Arnoud V. den Boer. Dynamic pricing and learning: Historical origins  current research  and new

directions. Surveys in Operations Research and Management Science  20(1):1–18  2015.

Alexey Drutsa. Horizon-independent optimal pricing in repeated auctions with truthful and strategic
buyers. In Proceedings of the 26th International Conference on World Wide Web  pages 33–42.
International World Wide Web Conferences Steering Committee  2017.

Alexey Drutsa. Weakly consistent optimal pricing algorithms in repeated posted-price auctions with

strategic buyer. In International Conference on Machine Learning  pages 1318–1327  2018.

Benjamin Edelman and Michael Ostrovsky. Strategic bidder behavior in sponsored search auctions.

Decision support systems  43(1):192–198  2007.

Negin Golrezaei  Adel Javanmard  and Vahab Mirrokni. Dynamic incentive-aware learning: Ro-
bust pricing in contextual auctions. Available at SSRN: https://ssrn.com/abstract=3144034 or
http://dx.doi.org/10.2139/ssrn.3144034  2018.

Christos Koufogiannakis and Neal E. Young. A nearly linear-time PTAS for explicit fractional

packing and covering linear programs. Algorithmica  70(4):648–674  2014.

Renato Paes Leme and Jon Schneider. Contextual search via intrinsic volumes. 2018.

Jinyan Liu  Zhiyi Huang  and Xiangning Wang. Learning optimal reserve price against non-myopic

bidders. In Advances in Neural Information Processing Systems  pages 2038–2048  2018.

Ilan Lobel  Renato Paes Leme  and Adrian Vladu. Multidimensional binary search for contextual

decision-making. Operations Research  66(5):1346–1361  2018.

Jieming Mao  Renato Leme  and Jon Schneider. Contextual pricing for lipschitz buyers. In Advances

in Neural Information Processing Systems  pages 5643–5651  2018.

Andres M. Medina and Mehryar Mohri. Learning theory and algorithms for revenue optimization
in second price auctions with reserve. In Proceedings of the 31st International Conference on
Machine Learning  pages 262–270  2014.

Vahab Mirrokni  Renato Paes Leme  Pingzhong Tang  and Song Zuo. Dynamic auctions with bank
accounts. In Proceedings of the 25th International Joint Conference on Artiﬁcial Intelligence 
pages 387–393  2016a.

10

Vahab Mirrokni  Renato Paes Leme  Pingzhong Tang  and Song Zuo. Optimal dynamic mechanisms

with ex-post IR via bank accounts. arXiv preprint arXiv:1605.08840  2016b.

Vahab Mirrokni  Renato Paes Leme  Pingzhong Tang  and Song Zuo. Non-clairvoyant dynamic
mechanism design. In Proceedings of the 19th ACM Conference on Economics and Computation 
pages 169–169  2018.

Roger B. Myerson. Optimal auction design. Mathematics of Operations Research  6(1):58–73  1981.

Christos Papadimitriou  George Pierrakos  Christos-Alexandros Psomas  and Aviad Rubinstein. On
the complexity of dynamic mechanism design. In Proceedings of the 27th annual ACM-SIAM
Symposium on Discrete Algorithms  pages 1458–1475  2016.

Jonathan Thomas and Tim Worrall. Income ﬂuctuation and asymmetric information: An example of

a repeated principal-agent problem. Journal of Economic Theory  51(2):367–390  1990.

11

,Yuan Deng
Sébastien Lahaie
Vahab Mirrokni