2018,Practical exact algorithm for trembling-hand equilibrium refinements in games,Nash equilibrium strategies have the known weakness that they do not prescribe rational play in situations that are reached with zero probability according to the strategies themselves  for example  if players have made mistakes. Trembling-hand refinements---such as extensive-form perfect equilibria and quasi-perfect equilibria---remedy this problem in sound ways. Despite their appeal  they have not received attention in practice since no known algorithm for computing them scales beyond toy instances. In this paper  we design an exact polynomial-time algorithm for finding trembling-hand equilibria in zero-sum extensive-form games. It is several orders of magnitude faster than the best prior ones  numerically stable  and quickly solves game instances with tens of thousands of nodes in the game tree. It enables  for the first time  the use of trembling-hand refinements in practice.,Practicalexactalgorithmfortrembling-handequilibriumreﬁnementsingamesGabrieleFarinaComputerScienceDepartmentCarnegieMellonUniversitygfarina@cs.cmu.eduNicolaGattiDEIBPolitecnicodiMilanonicola.gatti@polimi.itTuomasSandholmComputerScienceDepartmentCarnegieMellonUniversitysandholm@cs.cmu.eduAbstractNashequilibriumstrategieshavetheknownweaknessthattheydonotprescriberationalplayinsituationsthatarereachedwithzeroprobabilityaccordingtothestrategiesthemselves forexample ifplayershavemademistakes.Trembling-handreﬁnements—suchasextensive-formperfectequilibriaandquasi-perfectequilibria—remedythisprobleminsoundways.Despitetheirappeal theyhavenotreceivedattentioninpracticesincenoknownalgorithmforcomputingthemscalesbeyondtoyinstances.Inthispaper wedesignanexactpolynomial-timeal-gorithmforﬁndingtrembling-handequilibriainzero-sumextensive-formgames.Itisseveralordersofmagnitudefasterthanthebestpriorones numericallysta-ble andquicklysolvesgameinstanceswithtensofthousandsofnodesinthegametree.Itenables fortheﬁrsttime theuseoftrembling-handreﬁnementsinpractice.1IntroductionNashequilibrium(NE)[Nash 1950]isthemostseminalsolutionconceptingametheory.However inmanygamesitistoopermissive prescribingunsatisfactorystrategies.Inthecaseofimperfect-informationextensive-formgames onelimitationisthatsomeNEsdonotprescribeoptimalplayaftertheplayerortheopponenthasmadeamistake.OtherissuesarethatsomeNEsmayprescribenon-crediblethreatsorweaklydominatedstrategies.SincetheclassicpaperbySelten[1975] trembleshaveplayedacrucialroleinreﬁning—thatis furthercurtailing—thesetofNEs toaddresstheseissues.Intuitively tremblesrepresentpoten-tialmistakesbytheplayers.ReﬁnedsolutionsthenarelimitpointsofNEsasthemistakeprob-abilitiesapproachzero(differentreﬁnementconceptshavedifferentadditionalconstraintsonthetrembles whichwewillmakespeciﬁcinthenextsections).Theprimaryroleoftremblesistoguaranteethatthesolutionsaresequentiallyrational[KrepsandWilson 1982].Thetwomostfa-moustrembling-handsolutionconceptsthatreﬁneNEswhileguaranteeingsequentialrationalityarequasi-perfectequilibria(QPEs)[vanDamme 1984]andextensive-formperfectequilibria(EF-PEs)[Selten 1975].1InaQPE aplayerplaysoptimallyateveryinformationsettakingintoaccountpossiblefuturemistakesofheropponentbutassumingthatshewillnotmakefuturemistakes.Inan1Properequilibria(PEs) proposedbyMyerson[1978] areanon-emptysubsetofEFPEs withtheaddi-tionalrequirementthattheworseanactionisforaplayer thelowertheagent’strembleprobabilityonthat32ndConferenceonNeuralInformationProcessingSystems(NeurIPS2018) Montr´eal Canada.EFPE aplayeralsotakesherownpossiblefuturemistakesintoaccount.Interestingly EFPEsneednotbeasubsetofQPEs:thetwosetscanbedisjoint[HillasandKohlberg 2002].(AnEFPEmayprescribetheplayerstoplayweaklydominatedstrategies whileaQPEneverdoes.)SequentialrationalityguaranteesthatthestrategiesinQPEsandEFPEsareoptimalalsoinpartsofthegamethatarereachedwithzeroprobabilityinequilibrium.Thisisimportant forexample whenplayingagainstahumanplayer whoisexpectednottoalwaysplayoptimally.Nopracticallyviablealgorithmforcomputingtrembling-handreﬁnementsinlargeimperfect-informationgamesisknown.Forinstance considertherecentmilestonewhereanAI Libratus[BrownandSandholm 2017b a c]—thatwascreatedautomaticallyusingequilibrium-ﬁndingapproaches—beattophumanspecialistprofessionalsinheads-upno-limitTexashold’empoker.ThetechniqueswerebasedonapproximatingNE:noNEreﬁnementwasusedtocapitalizeontheopponent’smistakes.SequentialrationalityshouldnotbeconfusedwiththeconceptofundominatedstrategyvanDamme[1987].MiltersenandSørensen[2006 page108]illustratetheweaknessofundominatedNashequi-libria(UNEs)andtheirinabilitytocapitalizeonmistakescomparedtoQPEs.Inparticular UNEsdonotprecludeaplayerfromhopingfora“gift”(mistake)fromtheopponent.Pokerillustratesthisproblemwell:onlyveryfewstrategiesaredominatedsincethereisoftenroomfortheopponenttomakemistakeslater.Inotherwords whilerestrictingtoundominatedstrategiesisastepintherightdirection itdoesnotruleoutsequentially-irrationalbehaviorforeitherplayer.Thesolutioncon-ceptswestudyinthispaper—QPEsandEFPEs—guaranteesequentialrationalityandareastandardsolutiontothisproblem.21.1PriorstateoftheartIntwo-playerzero-sumgames theproblemsofﬁndingaQPEoranEFPEcanbeformulatedaslimitpointsoflinearprogramsparameterizedbythetremblemagnitude.Ineachlinearprograminthatsequence thetremblesarecapturedbyrequiringeachactiontobeplayedwithatleastsomelower-boundprobability.Assumingthegameisofperfectrecall thelinearprogramcanbewritteninthesequenceform[Kolleretal. 1996;Romanovskii 1962;vonStengel 1996] whichwewillmakepreciselaterinthepaper.Thetremblesusedforthetwosolutionconceptsaredifferent leadingtoproblemsofdifferentnature.InthecaseofQPE thetremblesappearintheobjectivefunctionandintheright-handsideoftheconstraints[MiltersenandSørensen 2010].InthecaseofEFPE thetremblesonlyappearintheconstraintmatrix[FarinaandGatti 2017].LikeNashequilibrium aQPEandEFPEcanbecomputedinpolynomialtimeinthesizeoftheinputgame.However thebig-OcomplexityhidesdramaticallylargerconstantsinthecaseofaQPEoranEFPE andthealgorithmsknownsofarthusdonotscalebeyondsmallinstances[ˇCerm´aketal. 2014;GanzfriedandSandholm 2015].Solutionsunderbothconceptscanbefoundbysettingtheperturbationmagnitudetoasufﬁcientlysmallvaluethatguaranteesthatthebasisoftheoptimalsolutionwiththatvalueremainsoptimalas↓0 3andthenbysolvingthecorrespondingLPbyanyLPoracleforthatsufﬁcientlysmall.MiltersenandSørensen[2010]andFarinaandGatti[2017]provideaformulaforsuchanforQPEsandEFPEs respectively andshowthatitisalwaysrepresentableusingapolynomialnumberofbits.However inpractice callinganLPoraclewiththatvalueofisimpracticalbecausethevalueisextremelysmall.ThiscausesfatalnumericalinstabilityintheLPsolverifﬁnite-precision(i.e. real-valued)arithmeticisused.Ifrational(i.e. inﬁnite-precision)arithmeticisused theLPoracleisprohibitivelyslow.AnalternativealgorithmtocomputeaQPEisasimplexalgorithmvariantthatdealssymbolicallywiththeperturbationusingthelexico-minimumratiotest[MiltersenandSørensen 2010].Thatalgorithmmayrequireexponentialtimeasitreliesonthesimplexalgorithm anditwasnotknownif inpractice itcanscaleuptolargeinstances.Ourexperimentsshowthatitdoesnot.WhileinprinciplealsoanEFPEcanbecomputedusingasimplexalgorithmthatdealswiththeperturbationsymbolically itisnotevenclearwhetheritcanruninpolynomialspace.Insummary althoughthereactionmustbe.Therefore thetremblesareafunctionofthestrategiesoftheplayers.Thispotentiallycompli-catesequilibriumﬁnding.ItisunknownwhetherPEscanbeefﬁcientlyfoundinextensive-formgames.2ˇCerm´aketal.[2014]showexperimentallythatintwosmallartiﬁcialpokervariants(sixcardsinthedeckandtwobettingrounds) fortwoparticularmodelsofopponentmistakes undominatedequilibriaareasgoodasQPEs.Asexplainedabove thisisnotthecaseingeneral.3Weusethesymbol“↓”todenoteconvergencefromtheright.2isagreementthatNEreﬁnementscanplayanimportantroleevenintwo-playerzero-sumgames prioralgorithmsdonotscaleinpractice.41.2OurcontributionsWedesignapracticalalgorithmthatworksinaniterativefashion.Ateachiteration ithalvesthevalueofusedinthepreviousiteration callsanLPoracle andcheckswhetherthebasisofthesolutionobtainedisalsoabasisofanoptimalsolutionwhen↓0.Thecrucialtechnicalcontributionisthedesignofanefﬁcientnumericalalgorithmforthebasischeckstep.Weprovethatourpracticalalgorithmrequiresonlypolynomialtimeevenintheworstcase(weprovethatthemaximumnumberofiterationsispolynomialandthateachiterationrunsinpolynomialtime).UnlikeinpriorpapersthatproposealgorithmsforQPEs[MiltersenandSørensen 2010]andEF-PEs[FarinaandGatti 2017] whichwerepurelytheoretical weshowthatouralgorithmworkswellinpracticealso.WeapplyittoﬁndingaQPEandanEFPEinmanydifferentcardgames:Kuhnpoker Leducpokerwithvariousnumbersofranks andtwoversionsofGoofspiel[Ross 1971]withvariousnumbersofranks.Ouralgorithmdramaticallyoutperformstheprioralgorithmsintheliterature.Itisabletosolvegamesuptofourordersofmagnitudelargerthanthosepreviouslysolv-able.Itsolvesgameswithtensofthousandsofnodesinafewminutes thusshowing fortheﬁrsttime thattrembling-handreﬁnementscanbeeffectivelyusedinpractice—whilehavingatheoreticalguaranteeofcorrectnessandpolynomialruntime.2Extensive-formgamesandNashequilibriaExtensive-formgamesareageneralstandardrepresentationofgames whichcancapturesequentialandsimultaneousmovesaswellasprivateinformation.Itisatreeformgamesupplementedwithinformationsets.Eachinformationsetcontainsasetoftreenodes whicharethesetofnodesthattheplayerwhoseturnitistomovecannotdistinguishamong.Wewillfocusonextensive-formgameswithperfectrecall thatis wherenoplayerforgetswhattheplayerknewearlier.AdditionalbackgroundmaterialcanbefoundinthetextbookbyShohamandLeyton-Brown[2008].Extensive-formgameswithperfectrecallareoftenstudiedinatabularrepresentationcalledthesequenceform[Romanovskii 1962;Kolleretal. 1996;vonStengel 1996].Itprovidesaconciserepresentationthatusesspacelinearinthesizeofthegametree.AsequenceqforplayeriisasubsetofAthatspeciﬁesplayeri’sactionsonthepathfromtheroottoadecisionnodev.WedenotewithQithesetofsequencesofplayeri.Astrategydeﬁnedonthesequenceformiscalledarealizationplan.Itisanon-negativevectorrithatmapseachsequenceq∈Qitoitsprobabilityofbeingplayed.Arealizationplanriforplayeriiswell-deﬁnedwhenitsatisﬁesthelinearconstraintFiri=fi whereFiisa(|Hi|+1)×|Qi|matrixthatcontains{0 ±1}entriesonly fiisa(|Hi|+1)-dimensionalvector andriisthevectorthatcontainstherealizationplanofplayeri.Finally theutilityfunctionofplayeriisrepresentedasasparsematrixUideﬁnedonlyfortheproﬁlesofterminalsequencesleadingtoaleaf.Theexpectedpayoffforplayeri∈{1 2}whenthetwoplayersplayaccordingtotherealizationplan(r1 r2)isr>iUir−i(ascustomary welet−idenotetheopponentofplayeri).5ANEisastrategyproﬁleinwhichthestrategyofeachplayerisabestresponsetothestrategiesoftheopponents.Inatwo-playergame anNEcanbedeﬁnedinthesequenceformasastrategyproﬁle(r∗1 r∗2)wherer∗i∈argmaxr>iUir−iforalli∈{1 2}.Eveninzero-sumgames thatisgameswherethesumoftheplayers’payoffsineveryleafiszero NEscanbeunsatisfactoryastheydonotprecludesuboptimalplayinbranchesofthegametreethatarenotreachedinequilibrium butthatmightstillbereachedifplayers(e.g. humans)canmakemistakes.See forinstance theworkbyMiltersenandSørensen[2006]foradiscussionofthisissueinthecontextofcomputerpoker.4Somealgorithmshavebeenproposedforcomputingapproximatetrembling-handequilibriaresortingtoregret-minimizationtechniques[Farinaetal. 2017]ortosmoothingmethodspairedwithbilinearsaddle-pointtechniques[Kroeretal. 2017].ThosealgorithmsdonotprovideanyguaranteeofﬁndingorapproximatingactualQPEsorEFPEs.Rather theyprovideapproximatesolutionstoapproximatesolutionconcepts.5Weusethesuperscript>todenotethetransposematrix.Similarly laterinthetextweusethesuperscript−>todenotetheinversetransposematrix.33Trembling-handreﬁnementsNashequilibriumreﬁnementsolutionconceptscurtailthesetofNashequilibriabyimposingaddi-tionaldesiderataonthesolution.Agivenequilibriumreﬁnementconceptselectssomesubsetofagame’sNashequilibria thuspotentiallyﬁlteringoutsomeoralloftheequilibriumpointsthatexhibitundesirablebehaviors.Asdiscussedintheintroduction trembling-handreﬁnementsareakeyformofequilibriumreﬁnement.Inthenextsubsectionswereviewkeypropertiesofthetwomaintrembling-handreﬁnements QPEsandEFPEs.AdetailedderivationoftheQPEandEFPEformulationsisprovidedinAppendixA.1andAppendixA.2 respectively.3.1Quasi-perfectequilibria(QPEs)InaQPE[vanDamme 1984] aplayerplaysoptimallyateveryinformationsettakingintoaccountpossiblefuturemistakesofheropponentbutassumingthatshewillnotmakefuturemistakes.Mil-tersenandSørensen[2010]showthatatleastoneQPEcanbefoundbyforcingtherealizationri(q)ofeverysequenceqtobeatleastd wheredisthedepthofthesequenceitself.Thiscorrespondstoaconstraintoftheformri≥li() whereli()>0collectsallthelowerboundsonthesequencerealizations.So thefollowingresultbyMiltersenandSørensen[2010 Equation(25)]holds.Proposition1.Inazero-sumextensive-formgamewithperfectrecall alimitpointas↓0ofsolutionsofthelinearprobleminFigure1(a)isthestrategyofplayeri∈{1 2}inaQPE.max˜ri v−i z−if>−iv−i+l>−i()z−is.t.1F>−iv−i−U>i˜ri≤U>ili()−z−i2Fi˜ri=fi−Fili()3˜ri z−i≥0(a)QPEformulationmax˜ri v−if>−iv−is.t.1R−>−i()F>−iv−i≤R−>−i()U>iR−1i()˜ri2FiR−1i()˜ri=fi3˜ri≥0.(b)EFPEformulationFigure1:Linearprogrammingformulationsoftrembling-handreﬁnements.3.2Extensive-formperfectequilibria(EFPEs)InanEFPE[Selten 1975] aplayertakesnotonlytheopponent’sbutalsoherownpossiblefu-turemistakesintoaccount.LikeQPEs EFPEsimposealowerboundontherealizationofeverysequence.Speciﬁcally givenasequenceqandanextensionwithactiona(i.e. thesequenceqa) therealizationri(qa)hastosatisfythelowerboundri(qa)≥qri(q) whereq>0isarealconstant(differentsequencescanhaveadifferentvalueforq).Inthispaper wewilluseauniformperturbationovertheactionsoftheagentform:q=forallsequencesq.AnEFPEwithsuchauni-formperturbationalwaysexists.Thisallowstoexpressallconstraintsoftheformri(qa)≥ri(q)moreconciselyasRi()ri≥0 whereRi()isthebehavioralperturbationmatrix.Withthat thefollowingresultwasprovenbyFarinaandGatti[2017].Proposition2.Inazero-sumextensive-formgamewithperfectrecall alimitpointas↓0ofsolutionsofthelinearprobleminFigure1(b)isthestrategyofplayeri∈{1 2}inanEFPE.4TremblinglinearprogramsandtheirlimitsolutionsTheprevioussectionshowsthattheproblemsofﬁndingaQPEandthatofﬁndinganEFPEaresimilar:inbothcasesanLPwithaparameter>0isgiven andalimitpointofasequenceofoptimalsolutionstotheLPas↓0issought.Weformalizethisobservationintheconceptofatremblinglinearprogram(TLP) thatisafunction7→P():maxc()>xs.t.A()x=b()x≥0whereP()isanLP andA() b() c()arepolynomialsin withrationalcoefﬁcients.Further-more werequirethatthesetofallfeasiblesolutionsforP()benon-emptyforallpositivereals4≤˜ andthatthesetofallfeasiblesolutionsforP(0)benon-emptyandbounded.TheseadditionalassumptionsaresatisﬁedbytheformulationsinFigure1.Deﬁnition3(LimitsolutiontoaTLP).AlimitsolutiontoaTLP7→P()isalimitpoint as↓0 ofoptimalsolutionsforP().InthecaseoftheQPETLP(Figure1(a)) theperturbationvariableonlyappearsinb;limitsolu-tionstotheQPETLPareQPEs.InthecaseoftheEFPEformulation(Figure1(b)) theperturbationonlyappearsinA;limitsolutionstotheEFPETLPareEFPEs.WenowintroducetheconceptofbasisstabilityforTLPs.First recallthatabasisofanLPisasubsetoftheprogram’svariablessuchthatwhenonlythosecolumnsofmatrixAthatcorrespondtothosevariablesareincludedinanewmatrixA0 thenewmatrixA0isinvertible[BertsimasandTsitsiklis 1997 page55].Deﬁnition4(Stablebasis).Let7→P()beaTLP.TheLPbasisBiscalledstableifthereexists¯>0suchthatBisoptimalforP()forall:0<≤¯.WeprovethatthereisatightconnectionbetweenastablebasisandaTLPlimitsolution.Inpar-ticular givenastablebasis onecanﬁndaTLPlimitsolutioninpolynomialtime(allproofsarepresentedinAppendixA):Theorem5.LetP:7→P()beaTLP andletBbeastablebasisforP optimalforall:0<≤¯.Furthermore letx()betheoptimalbasicsolutionofP()correspondingtoB.Then ˜x=lim↓0x()exists and˜xisalimitsolutiontotheTLPP.GivenaTLPandastablebasisBforit letB()denotethebasismatrixcorrespondingtoBintheunderlyingperturbedLPP() andletcBdenotetheportionoftheobjectivevectorccorrespondingtothebasicvariables.Similarly let¯B()andc¯Bdenotethematrixformedbyallnonbasiccolumnsandthevectorformedbytheobjectivecoefﬁcientsofallnonbasicvariables respectively.Theorem6.GivenaTLP7→P() abasisBisstableifandonlyifthereexists¯>0suchthattB():=(cid:18)B−1()b()¯B>()B−>()cB−c¯B(cid:19)≥0∀:0≤≤¯.ThevectortB()iscalledtheoptimalitycertiﬁcateforB.Theorem6isakeystepinprovingthefollowing.Theorem7.GivenasinputaTLP7→P() thereexists∗>0suchthatforall0<¯≤∗ anyoptimalbasisforthenumericalLPP(¯)isstable.Furthermore suchavalue∗canbecomputedinpolynomialtimeintheinputsize assumingthatapolynomialofdegreedrequiresΩ(d)spaceintheinput.5ApracticalalgorithmforﬁndingaTLPlimitsolutionWenowdevelopapracticalalgorithmforﬁndingalimitsolutioninaTLP7→P().Itavoidsthepessimisticallysmallnumericalperturbation∗ofTheorem7byusinganefﬁcientstability-checkingoracleforcheckingifabasisisstableornot.Itenablesaniterativealgorithmthatrepeatedlypicksanumericalperturbation¯ computesanoptimalbasisfortheperturbedLPP(¯) andqueriesthebasis-stabilityoracle.Ifthebasisisnotstable thealgorithmconcludesthattheperturbationvalue¯wastoooptimistic andanewiterationisperformedwithasmallerperturbation.Ontheotherhand ifthebasisisstable thealgorithmtakesthelimitoftheLPsolutionandreturnsitasthelimitsolutionoftheTLP(byTheorem5 thisisguaranteedtoprovidealimitsolution).Terminationofthealgorithmisguaranteedbythefollowingobservation.Observation8.Anyvalueof¯intherange(0 ∗]guaranteesterminationofthealgorithm.Indeed byTheorem7 anyoptimalbasisforP(¯)isstableandmakesouriterativealgorithmterminate.Furthermore ifaftereverynegativestabilitytestthevalueof¯isreducedbyaconstantmultiplicativefactor(e.g. halved) thensince∗onlyhasapolynomialnumberofbits thealgorithmterminatesaftertryingatmostapolynomialnumberofdifferentvaluesfor¯.Itisnotnecessary—andingeneralnottrue—thattheinverseofB(0)exist.WestartfromthesimplercaseinwhichB−1(0)exists(thusrulingoutthepossibilitythattheoptimalitycertiﬁcatetBisnotdeﬁnedin0)andlatermovetothegeneralcase.55.1Oraclefornon-singularbasismatricesIfB(0)isnon-singular thenB−1()b()and¯B>()B−>()cB−c¯Bareanalyticfunctionsofat=0.ThustB()isanalyticat=0.Inotherwords eachentryti()oftB()isequaltoitsTaylorexpansionti()=αi0+αi11!+αi22!2+αi33!3+···whereαij=(djti()/dj)(0)isthej-thderivativeofti()evaluatedat=0.6Thesignofti()inpositiveproximity7of0isthesameastheﬁrst(i.e. relativetothelowestdegreemonomial)non-zerocoefﬁcientoftheexpansionofti()around0.Inotherwords thereexistsa¯>0suchthatti()hasthesamesignastheﬁrstnon-zeroderivativeoftievaluatedin0forall0<<¯.Ifallderivativesare0 thenweconcludethatti()isidenticallyzeroaround=0.ThissuggestsasimplealgorithmfordeterminingwhetherBisstable:wecomputeitsoptimalitycertiﬁcatetB()andrepeatedlydifferentiateeachrowuntilweeitherdeterminethesignofthatrowinpositiveproximityof0orweestablishthattherowisidenticallyzero.Ifalltherowshappentobenon-negativeinpositiveproximityof0 thenthebasisisstable;otherwise itisnot.Inordertomakethealgorithmfast weneedtobeabletoquicklyevaluatetB()anditsderivativesat0.ThisfundamentallyreducestoourabilitytoefﬁcientlycomputeaTaylorexpansionofafunctionoftheformB−1()H()around=0 whereHisamatrixorvectorwhoseentriesarepolynomialin.ThispartofthealgorithmassumesthatasparseLUfactorizationofthenumericalbasismatrixB(0)isavailable;oneiseasytocomputeinpolynomialtime.Below wewillbreakthepresentationofthealgorithmintomultiplesteps.SincethealgorithmdescribedbelowcanbeappliedtoanysquarematrixM()—notonlytoabasismatrixB()—withpolynomialentriesandwithnonzerodeterminantat=0 wewillusethesymbolM()inplaceofB().DerivativesofM−1()H.Westartbyshowinghowtoefﬁcientlyandinductivelyevaluatederiva-tivesofM−1()Hin0 whereHisaconstantmatrixorvector.Westartwithasimplelemma.Lemma9.Foralln≥1 nXi=0(cid:18)ni(cid:19)diM()didn−iM−1()dn−i=0.Lemma9impliesthatM(0)dnM−1dn(0)=−nXi=1(cid:18)ni(cid:19)diMdi(0)dn−iM−1dn−i(0).MultiplyingbyHandintroducingthesymbolDn:=dnM−1dn(0)H weobtainM(0)Dn=−nXi=1(cid:18)ni(cid:19)diMdi(0)Dn−i.Therighthandsideisrelativelyinexpensivetocompute especiallywhennissmall.Indeed computing(diM/di)(0)amountstoextractingthecoefﬁcientsofthemonomialsofdegreeiofthepolynomialentriesinM.ThiscanbedoneextremelyefﬁcientlybyreadingdirectlyfromtheperturbedLPconstraintmatrixA.Therefore ifweinductivelyassumeknowledgeofD0 D1 ... Dn−1 wecaneasilycomputeDnusingtheprecomputedLUfactorizationofM(0).DerivativesofM−1()H().WenowturnourattentiontothecomputationofthederivativesofM−1()H() whereH()canbeanymatrixorvectorwithpolynomialentries.Thiscaseisparticularlyrelevant asitappliestoboththeprimal-feasibilityconditionsandthereducedcosts.Weintroducetheformalsymbolhi jideﬁnedoverpairs(i j)∈N2ashi ji:=diM−1di(0)djHdj(0).Bymeansoftheproductrule wehavethatdn(M−1H)dn(0)=nXi=0(cid:18)ni(cid:19)hi n−ii.(1)6Throughoutthispaper wedeﬁnethezerothderivatived0f/d0offtobefitself.7Wesaythatapropertyparametrizedbyistrueinpositiveproximityof0tomeanthatthereexistsa¯>0suchthatthepropertyholdsforall:0<<¯.Wesaythatthepropertyistrueinproximityof0ifthereexistsa¯>0suchthatthepropertyholdsforall:0<||<¯.6Fromtheprevioussection weknowhowtocomputehi+1 jihavingaccesstoh0 ji h1 ji ... hi ji.Ontheotherhand h0 ji=M(0)−1dj/djH(0)iseasytocomputehavingaccesstotheLUfactorizationofM(0).Therefore Equation(1)givesanefﬁcientwayofexpandingM−1()H()intoitspowerseries.Finally weaddresstheproblemofdetermining rowbyrowinthederivativevectorintheTaylorseries whenitissafetostopafterobservingonlyzero-valuedderivativesforsomerowforanumberofiterations(i.e. anumberoftermsintheTaylorseries).Lemma10.ConsideraTLP7→P()whereP()hasnrowsandletmbethemaximumdegreeappearinginthepolynomialfunctionsdeﬁningP.FixedanybasisB iftheﬁrst2nm+1derivativesofthei-thentryoftheoptimalitycertiﬁcatetB()areallzero theentryisidenticallyzero.Since2nm+1isapolynomialnumberintheinputsize weconcludethattheoverallalgorithmrunsinpolynomialtime sinceitterminatesinapolynomialnumberofstepsandeachsteptakespolynomialtime.Thereisamoreconvenientwayofdeterminingwhetheragivenrowis0.Itissufﬁcienttopickarandomnumber˜(forexamplein(0 1)) andevaluatetherationalfunctiontiat˜:ifti(˜)=0 thentiisidenticallyzerowithprobability1becauseofthefundamentaltheoremofalgebra.Thisisthevariantthatweuseintheexperimentslaterinthispaper.Finally insomecaseswecantaketheoreticallysoundshortcutstofurtherenhancethespeedofthealgorithm.Weprovidetwoexamples andweusethetwoinourimplementationofthealgorithm.Astheﬁrstexample consideraTLPthat foreach hasnoobjective.Inthiscase thevectorciszero.Thisallowsustoavoidconsideringthereduced-costconditionsofTheorem6 therebysavingtimeandspace.Asthesecondexample ifintheQPEformulationofProposition1 theLPconstraintmatrixAisconstant meaningthattheoptimalitycertiﬁcatebhaspolynomialentries itisextremelyeasytodealwith.Again wecanavoidcomputingallthederivativesofB−1 withlargepracticalsavingsoftimeandspace.5.2OracleforsingularbasismatricesWenowshowhowtodealwithasingularB(0).ThecoreideaofourmethodistoreplacethecomputationoftheTaylorexpansionoftheoptimalitycertiﬁcatearound=0withaLaurentexpansion thatisapowerseriesatwherenegativeexponentsareallowed.Lemma11providesthekeyresultthatenablesthisprocess.Lemma11.LetM()beasquarematrixwithpolynomialentries notallofwhichareidenticallyzero.Thenthereexistk∈N+andmatrices˜M()andT()thathavepolynomialsasentries withnonsingular˜M(0) suchthatM()=kT−1()˜M() (2)inproximityof=0.B()respectsthehypothesesofLemma11:itsentriesarenotallidenticallyzerosinceitsdetermi-nantisnotidenticallyzero.InvertingEquation(2)inproximityof=0 weobtainM−1()=1k˜M−1()T().Now givenamatrixorvectorwithpolynomialentriesH() supposethatweseektoexpandM−1()·H()intoitsLaurentseries.DuetoLemma11 wecanrewritethisproductasM−1()·H()=1k(cid:16)˜M−1()(T()H())(cid:17) wheretheequalityholdsinproximityof=0.Since˜M()isasquarematrixwithpolynomialen-triesinvertibleat=0andT()H()isavectorormatrixwithpolynomialentries wecanleveragethemachineryofSection5.1toexpand˜M−1()·(T()H())intoitsTaylorseriesaround=0.Multiplyingthispowerseriesby−kgivesaLaurentseriesforM−1()H()at=0.Theaboveshowshowtodealwithasingularbasismatrix.Therestofthealgorithmremainsunchanged.To-gether Sections5.1and5.2showthat foreveryTLP thereexistsapolynomial-timebasis-stabilityoracle.Finally wedealwiththelastpieceofthealgorithm whichisthecomputationofthelimitofoptimalsolutionslim↓0x()=lim↓0B−1()b().ThistaskiseasyafterhavingcomputedtheLaurentseriesexpansionofx()around=0(seeSections5.1and5.2).76ExperimentsTheLPoracleweuseisGLPK4.63[GLPK 2017].When≥1/500weusetheﬁnite-precisionsimplexalgorithmprovidedbyGLPK whilefor<1/500weusethearbitrary-precisionvariant as fromourobservations when<1/500theﬁnite-precisionsolverisdoomedtoeventuallyfailduetonumericalinstability.Weexperimentallyevaluatetheperformanceofthefollowingfouralgorithms.ExactNashequilibriumsolver usinganLPoraclewitharbitrary-precisionarithmetics.WewarmstarttheLPoraclewithaNEfoundbyanLPoraclethatusesﬁnite-precisionarithmetics.“NPPsolver”forEFPE[MiltersenandSørensen 2010]andforQPE[FarinaandGatti 2017] usinganinﬁnite-precisionLPoracle;toimprovetheefﬁciency wewarmstarttheLPoraclewithaNEfoundusinganLPoraclewithﬁnite-precisionarithmetics.Symbolic-simplexQPEsolver(“M&SSolver”) proposedbyMiltersenandSørensen[2010]toﬁndaQPE.Itisamodiﬁedsimplexalgorithm wheresomeentriesarekeptaspolynomials.Weimplementedthealgorithmasdescribedintheoriginalpaper.However wemodiﬁedthepivotingrulefromthesuggestedone(pickanynonbasicvariablewithpositivereducedcost)tothegreedyone(pickanynonbasicvariablewithmaximumreducedcost).Thisgreatlyimprovedruntime.OurproposedpracticalalgorithmfromSection5forﬁndingaTLPlimitsolution.WeuseanLPoraclewithinﬁnite-precisionarithmetics;toimprovetheefﬁciency wewarmstarttheﬁrstiterationofthealgorithmwithaNEfoundbyanLPoraclewithﬁnite-precisionarithmetics andwewarmstarteachsubsequentiterationwiththeNEreturnedbythepreviousiteration.Theseconditerationisperformedwith=1/10 andishalvedbetweensubsequentconsecutiveiteration.Table1liststhegamesweusetobenchmarkthealgorithms togetherwiththeirsizes.Allthegamesarefairlystandardinthecomputationalgametheoryliterature.AppendixBincludesadetaileddescriptionofeachgame.GameInstanceNodesInformationSetsSequencesDescriptionAcronymNatureLeavesPlayer1Player2Player1Player2Player1Player2KuhnpokerK1301212661313SimpleLeducpokerSL1398444428285757Leducpoker—3ranksL3461116387387144144337337Leducpoker—5ranksL5126550018751875390390911911Leducpoker—8ranksL8321229367752775298498422972297Leducpoker—9ranksL94063272411043110431242124228992899Goofspiel—3ranksG328216273333273273334334Goofspiel—4ranksG4179313824174762132817476174762132921329Goofspiel∗—3ranksG∗3036465746465858Goofspiel∗—4ranksG∗40576737916737737917917Table1:Treesizesandacronymsofthetestgameinstances.Everyexperimentwasrepeated50times.WesummarizetheaverageempiricalresultsinTable2.ExactNashequilibriumcomputation.Theimpactoftherationalsimplexiterationisminimalinthecaseofthe(exact)NEsolver.Thisisbecausetherationalsimplexiswarmstartedfromaﬁnite-precisionsolution andinpracticethisavoidsfurtherrational-precisionpivotingsteps.Forexample inL9 theﬁnite-precisionLPoracleisresponsibleforroughly90%ofthetotalcomputetime whileinG4 thisﬁguregrowstoabout98%.NPPsolvers.Thelargestpokergamessolvablewithin6hourswereL5(QPEcase)andSL(EFPEcase).TheNPPsolverissigniﬁcantlyslowerthantheNEsolver.Thisisbecause1)itrequiresalargernumberofpivotingsteps and2)eachpivotingstephasahighercost.UnliketheexactNEcomputation additionalpivotingstepsareneededbytherationalsimplextoﬁndaQPEoranEFPE evenafterwarmstartingfromaNashequilibrium.Theseextrapivotingstepsneedtomanipulateextremelysmallconstantsduetothevaluesof henceintroducingalargeoverhead.Forinstance inL5 theorderofmagnitudeoftheusedforQPEis10−5883.IntheQPEcase theseexpensivenumericalvaluesonlyappearintheobjectivefunctionandintheright-hand-sideconstants.Inthe8NashQPEEFPEGameSimplexM&SNPPTLPSolverNPPTLPSolverLPSolv.LPSolv.LPSolv.LPSolv.OracleIters.FinalLPSolv.LPSolv.OracleIters.FinalK1ms78ms28ms45ms35ms21/1014ms1ms5ms21/10SL4ms5.71s93ms19ms82ms21/103.09s5ms26ms31/20L359ms36.35m37.21s362ms1.99s111/5120>6h1.56s1.15s121/10240L5372ms>6h27.81m2.61s4.43s101/2560>6h57.65s2.87s101/2560L83.35s>6h>6h13.38s16.65s141/40960>6h3.51m1.18m171/327680L94.90s>6h>6h30.60s21.47s151/81920>6h22.66m28.43s151/81920G333ms21.64m2.88s62ms251ms21/101.93m36ms117ms21/10G41.01m>6h>6h2.93m28.02s51/80>6h1.46m1.01m51/80G∗35ms7.03m94ms20ms78ms21/10266ms5ms22ms21/10G∗4204ms>6h4.00m588ms1.48s61/160>6h417ms1.83s61/160Table2:Comparisonbetweendifferentsolvers(acronymsareasinTable1).ForTLPSolver ‘Iters.’:numberofdifferentperturbationstried;‘Final’:valueofinthelastiterationofouralgorithm;‘LPSolv.’and‘Oracle’:totalcomputetimeoveralltheiterationsspentbytheLPsolverandourBasisStabilityOracle respectively.Thetotalcomputetimeofouralgorithmisgivenbythesumofthesetwoquantities.EFPEcase theyappearintheconstraintmatrix andtherearequalitativelymoreofthem makingthecomputationevenslower.Accordingly theEFPENPPsolverscalesverypoorly.M&Ssolver.TheM&SsolveronlyappliestoQPEs.Empirically itissigniﬁcantlyslowerthantheNPPsolver.Thereasonistwo-fold.First themethodishardertowarmstart astheinitialbasicsolutionhastobefeasibleforallsufﬁcientlysmall>0.Weinitializethemethodaccordingtothesuggestionoftheauthors butthisinitialvertexisempiricallyfartherawayfromtheoptimalonethanaNE whichweusetowarmstartNPPsolvers.Second thepivotingstepismoreexpensive asthemin-ratiotestissubstitutedwithamoresophisticatedlexicographictestonpolynomialcoefﬁcients.TLPsolver.Oursolverrepresentsadramaticimprovementoverthepriorstate-of-the-artalgo-rithms.ItﬁndsaQPE/EFPEinfewminutesevenonthelargestgameinstances.Thisisareductioninruntimeby3–4ordersofmagnitude.Thisbreakthroughismainlyduetothefactthat inpractice terminateswithanthatisdrasticallylargerthanthatrequiredbytheNPPalgorithms.AsshowninTable2 theﬁnalusedbyoursolverisneversmallerthan10−6 evenforthelargestinstances.InKuhnpoker theﬁnalofoursolverisabout10−5forQPE whilethevalueusedbytheprioralgorithmsisoftheorder10−42.Insomecases ourmethodisabletocomputeanexactreﬁnementwithoutevenusingrationalarithmetic.Still ourTLPsolverissigniﬁcantlyslowerthanthesolverforNE.Forinstance onL9 theratioofthecomputetimesisabout30.Here thebottleneckismostlyduetoLPoracle whilethecomputetimerequiredbyourbasisstabilityoracleisrelativelysmall andbecomesrelativelyevensmallerwithincreasingproblemsize.7ConclusionsWeintroducedtremblinglinearproblems(TLPs) whicharelinearprogramsinwhicheveryentrycanbesubjecttoanindependentperturbationexpressedbyapolynomialin>0.WedeﬁnedalimitsolutiontoaTLPasanylimitpointofanysequenceofoptimalsolutionsfortheperturbedlinearprogramas↓0.Forgametheory TLPsprovideaframeworkforanalyzingandcomputingimportantNashequilibriumreﬁnementsbasedonvariousformsoftrembling-handperfectionintwo-playerzero-sumgames suchasquasi-perfectequilibria(QPEs)andextensive-formperfectequilibria(EFPEs).Wedesignedanexactpolynomial-timealgorithmforﬁndingalimitsolutiontoaTLPthat whenappliedtoﬁndingaQPEorEFPE outperformsthespeedofprioralgorithmsbyseveralordersofmagnitude.Ouralgorithmquicklysolvesgameswithtensofthousandsofnodes thusenabling—fortheﬁrsttime—theuseoftrembling-handreﬁnementsinpractice.Acknowledgments.ThismaterialisbasedonworksupportedbytheNationalScienceFoundationundergrantsIIS-1718457 IIS-1617590 andCCF-1733556 andtheAROunderawardW911NF-17-1-0082.9ReferencesDimitrisBertsimasandJohnTsitsiklis.IntroductiontoLinearOptimization.AthenaScientiﬁc 1stedition 1997.NoamBrownandTuomasSandholm.Reducedspaceandfasterconvergenceinimperfect-informationgamesviapruning.InInternationalConferenceonMachineLearning(ICML) 2017.NoamBrownandTuomasSandholm.Safeandnestedsubgamesolvingforimperfect-informationgames.InProceedingsoftheAnnualConferenceonNeuralInformationProcessingSystems(NIPS) pages689–699 2017.NoamBrownandTuomasSandholm.SuperhumanAIforheads-upno-limitpoker:Libratusbeatstopprofessionals.Science 2017.Jiˇr´ıˇCerm´ak BranislavBoˇsansk`y andViliamLis`y.Practicalperformanceofreﬁnementsofnashequilibriainextensive-formzero-sumgames.InProceedingsoftheTwenty-ﬁrstEuropeanCon-ferenceonArtiﬁcialIntelligence(ECAI) pages201–206.IOSPress 2014.GeorgeBDantzigandMukundNThapa.Linearprogramming2:theoryandextensions.SpringerScience&BusinessMedia 2006.GabrieleFarinaandNicolaGatti.Extensive-formperfectequilibriumcomputationintwo-playergames.InAAAIConferenceonArtiﬁcialIntelligence(AAAI) 2017.GabrieleFarina ChristianKroer andTuomasSandholm.Regretminimizationinbehaviorally-constrainedzero-sumgames.InInternationalConferenceonMachineLearning(ICML) 2017.SamGanzfriedandTuomasSandholm.Endgamesolvinginlargeimperfect-informationgames.InInternationalConferenceonAutonomousAgentsandMulti-AgentSystems(AAMAS) 2015.ExtendedearlyversionsinAAAI-15WorkshoponComputerPokerandImperfectInformationandinAAAI-13WorkshoponComputerPokerandIncompleteInformation.GLPK.Gnulinearprogrammingkit version4.63 2017.JohnHillasandElonKohlberg.Foundationsofstrategicequilibrium.HandbookofGameTheorywithEconomicApplications 2002.DaphneKoller NimrodMegiddo andBernhardvonStengel.Efﬁcientcomputationofequilibriaforextensivetwo-persongames.GamesandEconomicBehavior 14(2) 1996.DavidM.KrepsandRobertWilson.Sequentialequilibria.Econometrica 50(4):863–894 1982.ChristianKroer GabrieleFarina andTuomasSandholm.Smoothingmethodforapproximateextensive-formperfectequilibrium.InProceedingsoftheInternationalJointConferenceonAr-tiﬁcialIntelligence(IJCAI) 2017.HaroldW.Kuhn.Asimpliﬁedtwo-personpoker.InH.W.KuhnandA.W.Tucker editors Contri-butionstotheTheoryofGames volume1ofAnnalsofMathematicsStudies 24 pages97–103.PrincetonUniversityPress Princeton NewJersey 1950.PeterBroMiltersenandTroelsBjerreSørensen.Computingsequentialequilibriafortwo-playergames.InProceedingsoftheSeventeenthAnnualACM-SIAMSymposiumonDiscreteAlgorithms SODA2006 Miami Florida USA January22-26 2006 pages107–116 2006.PeterBroMiltersenandTroelsBjerreSørensen.Computingaquasi-perfectequilibriumofatwo-playergame.EconomicTheory 42(1) 2010.RogerB.Myerson.ReﬁnementsoftheNashequilibriumconcept.InternationalJournalofGameTheory 15:133–154 1978.JohnNash.Equilibriumpointsinn-persongames.ProceedingsoftheNationalAcademyofSciences 36:48–49 1950.10I.Romanovskii.Reductionofagamewithcompletememorytoamatrixgame.SovietMathematics 3 1962.SheldonMRoss.Goofspiel—thegameofpurestrategy.JournalofAppliedProbability 8(3):621–625 1971.ReinhardSelten.Reexaminationoftheperfectnessconceptforequilibriumpointsinextensivegames.Internationaljournalofgametheory 1975.YoavShohamandKevinLeyton-Brown.MultiagentSystems:Algorithmic Game-Theoretic andLogicalFoundations.CambridgeUniversityPress NewYork NY USA 2008.FinneganSouthey MichaelBowling BryceLarson CarmeloPiccione NeilBurch DarseBillings andChrisRayner.Bayes’bluff:Opponentmodellinginpoker.InProceedingsofthe21stAnnualConferenceonUncertaintyinArtiﬁcialIntelligence(UAI) July2005.EricvanDamme.Arelationbetweenperfectequilibriainextensiveformgamesandproperequilib-riainnormalformgames.InternationalJournalofGameTheory 1984.EricvanDamme.StabilityandPerfectionofNashEquilibria.Springer-Verlag Berlin Heidelberg 1987.BernhardvonStengel.Efﬁcientcomputationofbehaviorstrategies.GamesandEconomicBehavior 14(2) 1996.11,Kiran Garimella
Aristides Gionis
Nikos Parotsidis
Nikolaj Tatti
Gabriele Farina
Nicola Gatti
Tuomas Sandholm