2019,Spatially Aggregated Gaussian Processes with Multivariate Areal Outputs,We propose a probabilistic model for inferring the multivariate function from multiple areal data sets with various granularities. Here  the areal data are observed not at location points but at regions. Existing regression-based models can only utilize the sufficiently fine-grained auxiliary data sets on the same domain (e.g.  a city). With the proposed model  the functions for respective areal data sets are assumed to be a multivariate dependent Gaussian process (GP) that is modeled as a linear mixing of independent latent GPs. Sharing of latent GPs across multiple areal data sets allows us to effectively estimate the spatial correlation for each areal data set; moreover it can easily be extended to transfer learning across multiple domains. To handle the multivariate areal data  we design an observation model with a spatial aggregation process for each areal data set  which is an integral of the mixed GP over the corresponding region. By deriving the posterior GP  we can predict the data value at any location point by considering the spatial correlations and the dependences between areal data sets  simultaneously. Our experiments on real-world data sets demonstrate that our model can 1) accurately refine coarse-grained areal data  and 2) offer performance improvements by using the areal data sets from multiple domains.,Spatially Aggregated Gaussian Processes

with Multivariate Areal Outputs

Yusuke Tanaka1 3  Toshiyuki Tanaka3  Tomoharu Iwata2  Takeshi Kurashima1 

Maya Okawa1  Yasunori Akagi1  Hiroyuki Toda1

1NTT Service Evolution Labs.  2NTT Communication Science Labs.  3Kyoto University

{yusuke.tanaka.rh tomoharu.iwata.gy takeshi.kurashima.uf  maya.ookawa.af 

yasunori.akagi.cu hiroyuki.toda.xb}@hco.ntt.co.jp  tt@i.kyoto-u.ac.jp

Abstract

We propose a probabilistic model for inferring the multivariate function from
multiple areal data sets with various granularities. Here  the areal data are observed
not at location points but at regions. Existing regression-based models can only
utilize the sufﬁciently ﬁne-grained auxiliary data sets on the same domain (e.g. 
a city). With the proposed model  the functions for respective areal data sets are
assumed to be a multivariate dependent Gaussian process (GP) that is modeled as
a linear mixing of independent latent GPs. Sharing of latent GPs across multiple
areal data sets allows us to effectively estimate the spatial correlation for each areal
data set; moreover it can easily be extended to transfer learning across multiple
domains. To handle the multivariate areal data  we design an observation model
with a spatial aggregation process for each areal data set  which is an integral of
the mixed GP over the corresponding region. By deriving the posterior GP  we can
predict the data value at any location point by considering the spatial correlations
and the dependences between areal data sets  simultaneously. Our experiments on
real-world data sets demonstrate that our model can 1) accurately reﬁne coarse-
grained areal data  and 2) offer performance improvements by using the areal data
sets from multiple domains.

1

Introduction

Governments and other organizations are now collecting data from cities on items such as poverty
rate  air pollution  crime  energy consumption  and trafﬁc ﬂow. These data play a crucial role in
improving the life quality of citizens in many aspects including socio-economics [23  24]  public
security [2  32]  public health [12]  and urban planning [38]. For instance  the spatial distribution of
poverty is helpful in identifying key regions that require intervention in a city; it makes it easier to
optimize resource allocation for remedial action.
In practice  the data collected from cities are often spatially aggregated  e.g. 
averaged over a region; thus only areal data are available; observations are not
associated with location points but with regions. Figure 1 shows an example
of areal data  which is the distribution of poverty rate in New York City  where
darker hues represent regions with higher rates. This poverty rate data set was
actually obtained via household surveys taken over the whole city. The survey
results are aggregated over predeﬁned regions [24]. The problem addressed
herein is to infer the function from the areal data; once we have the function
we can predict data values at any location point. Solving this problem allows
us to obtain spatially-speciﬁc information about cities; it is useful for ﬁnding
key pin-point regions efﬁciently.

Figure 1: Areal data

33rd Conference on Neural Information Processing Systems (NeurIPS 2019)  Vancouver  Canada.

One promising approach to address this problem is to utilize a wide variety of data sets from the
same domain (e.g.  a city). Existing regression-based models learn relationships between target data
and auxiliary data sets [14  18  21  24  28]. These models  however  assume that the auxiliary data
sets have sufﬁciently ﬁne spatial granularity (e.g.  1 km ⇥ 1 km grid cells); unfortunately  many areal
data sets are actually associated with large regions (e.g.  zip code and police precinct). These models
cannot then make full use of the coarse-grained auxiliary data sets. Another important drawback of
all the prior works is that their performance in reﬁning the areal data is suspect if we have only a few
data sets available for the domain.
In this paper  we propose a probabilistic model  called Spatially Aggregated Gaussian Processes
(SAGP) herein after  that can infer the multivariate function from multiple areal data sets with various
granularities. In SAGP  the functions for the areal data sets are assumed to be a multivariate dependent
Gaussian process (GP) that is modeled as a linear mixing of independent latent GPs. The latent GPs
are shared among all areal data sets in the target domain  which is expected to effectively learn the
spatial correlation for each data set even if the number of observations in a data set is small; that is  a
data set associated with a coarse-grained region. Since the areal data are identiﬁed by regions  not by
location points  we introduce an observation model with the spatial aggregation process  in which
areal observations are assumed to be calculated by integrating the mixed GP over the corresponding
region; then the covariance between regions is given by the double integral of the covariance function
over the corresponding pair of regions. This allows us to accurately evaluate the covariance between
regions from a consideration of region shape. Thus the proposal is very helpful if there are irregularly
shaped regions (e.g.  extremely elongated) in the input data.
The mechanism adopted in SAGP for sharing latent processes is also advantageous in that it makes
it straightforward to utilize data sets from multiple domains. This allows our model to learn the
spatial correlation for each data set by sharing the latent GPs among all areal data sets from multiple
domains; SAGP remains applicable even if we have only a few data sets available for a single domain.
The inference of SAGP is based on a Bayesian inference procedure. The model parameters can be
estimated by maximizing the marginal likelihood  in which all the GPs are analytically integrated
out. By deriving the posterior GP  we can predict the data value at any location point considering the
spatial correlations and the dependences between areal data sets  simultaneously.
The major contributions of this paper are as follows:

incorporates aggregation processes for handling multivariate areal data.

• We propose SAGP  a novel multivariate GP model that is deﬁned by mixed latent GPs; it
• We develop a parameter estimation procedure based on the marginal likelihood in which latent
GPs are analytically integrated out. This is the ﬁrst explicit derivation of the posterior GP given
multivariate areal data; it allows the prediction of values at any location point.

• We conduct experiments on multiple real-world data sets from urban cities; the results show
that our model can 1) accurately reﬁne coarse-grained areal data  and 2) improve reﬁnement
performances by utilizing areal data sets from multiple cities.

2 Related Work

Related works can be roughly categorized into two approaches: 1) regression-based model and
2) multivariate model. The major difference between them is as follows: Denoting yt and y as
target data and auxiliary data  respectively  the aim of the ﬁrst approach is to design a conditional
distribution p(yt|y); the second approach designs a joint distribution p(yt  y).
Regression-based models. A related problem has been addressed in the spatial statistics community
under the name of downscaling  spatial disaggregation  areal interpolation  or ﬁne-scale modeling [8] 
and this has attracted great interest in many disciplines such as socio-economics [2  24]  agricultural
economics [11  36]  epidemiology [27]  meteorology [33  35]  and geographical information systems
(GIS) [7]. The problem of predicting point-referenced data from areal observations is also related to
the change of support problem in geostatistics [8]. Regression-based models have been developed for
reﬁning coarse-grained target data via the use of multiple auxiliary data sets that have ﬁne granularity
(e.g.  1 km ⇥ 1 km grid cells) [18  21]. These models learn the regression coefﬁcients for the auxiliary
data sets under the spatial aggregation constraints that encourage consistency between ﬁne- and
coarse-grained target data. The aggregation constraints have been incorporated via block kriging [5]

2

or transformations of Gaussian process (GP) priors [19  25]. There have been a number of advanced
models that offer a fully Bayesian inference [13  29  34] or a variational inference [14] for model
parameters. The task addressed in these works is to reﬁne the coarse-grained target data on the
assumption that the ﬁne-grained auxiliary data are available; however  the areal data available on a
city are actually associated with various geographical partitions (e.g.  police precinct)  thus one might
not be able to obtain the ﬁne-grained auxiliary data. In that case  these models cannot make full use
of the auxiliary data sets with various granularities  which contain the coarse-grained auxiliary data.
A GP-based model was recently proposed for reﬁning coarse-grained areal data by utilizing auxiliary
data sets with various granularities [28]. In this model  GP regression is ﬁrst applied to each auxiliary
data set for deriving a predictive distribution deﬁned on the continuous space; this conceptually
corresponds to spatial interpolation. By hierarchically incorporating the predictive distributions
into the model  the regression coefﬁcients can be learned on the basis of not only the strength of
relationship with the target data but also the level of spatial granularity. A major disadvantage of
this model is that the spatial interpolation is separately conducted for each auxiliary data set  which
makes it difﬁcult to accurately interpolate the coarse-grained auxiliary data due to the data sparsity
issue; this model fails to fully use the coarse-grained data.
In addition  these regression-based models (e.g.  [14  21  28]) do not consider the spatial aggregation
constraints for the auxiliary data sets. This is a critical issue in estimating the multivariate function
from multiple areal data sets  the problem focused in this paper.
Different from the regression-based models  we design a joint distribution that incorporates the
spatial aggregation process for all areal data sets (i.e.  for both target and auxiliary data sets). The
proposed model infers the multivariate function while considering the spatial aggregation constraints
for respective areal data sets. This allows us to effectively utilize all areal data sets with various
granularities for the data reﬁnement even if some auxiliary data sets have coarse granularity.
Multivariate models. The proposed model builds closely upon recent studies in multivariate spatial
modeling  which model the joint distribution of multiple outputs. Many geostatistics studies use the
classical method of co-kriging for predicting multivariate spatial data [20]; this method is  however 
problematic in that it is unclear how to deﬁne cross-covariance functions that determine the depen-
dences between data sets [6]. In the machine learning community  there has been growing interest in
multivariate GPs [22]  in which dependences between data sets are introduced via methodologies
such as process convolution [4  10]  latent factor modeling [16  30]  and multi-task learning [3  17].
The linear model of coregionalization (LMC) is one of the most widely-used approaches for con-
structing a multivariate function; the outputs are expressed as linear combinations of independent
latent functions [39]. The semiparametric latent factor model (SLFM) is an instance of LMC  in
which latent functions are deﬁned by GPs [30]. Unfortunately  these multivariate models cannot be
straightforwardly used for modeling the areal data we focus on  because they assume that the data
samples are observed at location points; namely they do not have an essential mechanism  i.e.  the
spatial aggregation constraints  for handling data that has been aggregated over regions.
The proposed model is an extension of SLFM. To handle the multivariate areal data  we newly
introduce an observation model with the spatial aggregation process for all areal data sets; this is
represented by the integral of the mixed GP over each corresponding region  as in block kriging. We
also derive the posterior GP  which enables us to obtain the multivariate function from the observed
areal data sets. Furthermore  the sharing of key information (i.e.  covariance function) can be used for
transfer learning across a wide variety of areal data sets; this allows our model to robustly estimate
the spatial correlations for areal data sets and to support areal data sets from multiple domains.
Multi-task GP models have recently and independently been proposed for addressing similar prob-
lems [9  37]. Main differences of our work from them are as follows: 1) Explicit derivation of the
posterior GP given multivariate areal data; 2) transfer learning across multiple domains; 3) extensive
experiments on real-world data sets deﬁned on the two-dimensional input space.

3 Proposed Model

We propose SAGP (Spatially Aggregated Gaussian Processes)  a probabilistic model for inferring the
multivariate function from areal data sets with various granularities. We ﬁrst consider a formulation
in the case of a single domain  then we mention an extension to the case of multiple domains.

3

(a) The case of a single domain.

(b) The case of two domains.

Figure 2: Graphical model representation of SAGP.

Areal data. We start by describing the areal data this study focuses on. For simplicity  let us consider
the case of a single domain (e.g.  a city). Assume that we have a wide variety of areal data sets
from the same domain and each data set is associated with one of the geographical partitions that
have various granularities. Let S be the number of kinds of areal data sets. Let X⇢ R2 denote an
input space (e.g.  a total region of a city)  and x 2X denote an input variable  represented by its
coordinates (e.g.  latitude and longitude). For s = 1  . . .   S  the partition Ps of X is a collection of
disjoint subsets  called regions  of X . Let |Ps| be the number of regions in Ps. For n = 1  . . .  |Ps| 
let Rs n 2P s denote the n-th region in Ps. Each areal observation is represented by the pair
(Rs n  ys n)  where ys n 2 R is a value associated with the n-th region Rs n. Suppose that we have
S areal data sets {(Rs n  ys n) | s = 1  . . .   S; n = 1  . . .  |Ps|}.
Formulation for the case of a single domain. In the proposed model  the functions for the respective
areal data sets on the continuous space are assumed to be the dependent Gaussian process (GP)
with multivariate outputs. We ﬁrst construct the multivariate dependent GP by linearly mixing some
independent latent GPs. Consider L independent GPs 

gl(x) ⇠GP (⌫l(x)  l(x  x0))  

(1)
where ⌫l(x) : X! R and l(x  x0) : X⇥X! R are a mean function and a covariance function 
respectively  for the l-th latent GP gl(x)  both of which are assumed integrable. Deﬁning fs(x) as the
s-th GP  the S-dimensional dependent GP f (x) = (f1(x)  . . .   fS(x))> is assumed to be modeled
as a linear mixing of the L independent latent GPs  then f (x) is given by

l = 1  . . .   L 

f (x) = Wg(x) + n(x) 

(2)
where g(x) = (g1(x)  . . .   gL(x))>  W is an S ⇥ L weight matrix whose (s  l)-entry ws l 2 R
is the weight of the l-th latent GP in the s-th data set  and n(x) ⇠GP (0  ⇤(x  x0)) is an S-
dimensional zero-mean Gaussian noise process. Here  0 is a column vector of 0’s and ⇤(x  x0) =
diag(1(x  x0)  . . .   S(x  x0)) with s(x  x0) : X⇥X! R being a covariance function for the
s-th Gaussian noise process. By integrating out g(x)  the multivariate GP f (x) is given by
(3)
where the mean function m(x) : X! RS is given by m(x) = W⌫(x). The covariance function
K(x  x0) : X⇥X! RS⇥S is given by K(x  x0) = W(x  x0)W> + ⇤(x  x0). Here  ⌫(x) =
(⌫1(x)  . . .  ⌫ L(x))> and (x  x0) = diag (1(x  x0)  . . .   L(x  x0)). The derivation of (3) is
described in Appendix A of Supplementary Material. The (s  s0)-entry of K(x  x0) is given by

f (x) ⇠GP (m(x)  K(x  x0))  

ks s0(x  x0) = s s0s(x  x0) +

ws lws0 ll(x  x0) 

(4)

where • • represents Kronecker’s delta; Z Z0 = 1 if Z = Z0 and Z Z0 = 0 otherwise. The
covariance function (4) for the multivariate GP f (x) is represented by the linear combination of the
l=1 for the latent GPs. The covariance functions for latent GPs are
covariance functions {l(x  x0)}L
shared among all areal data sets  which allows us to effectively learn the spatial correlation for each
data set by considering the dependences between data sets; this is advantageous in the case where
the number of observations is small  that is  the spatial granularity of the areal data is coarse. In this
paper we focus on the case L < S  with the aim of reducing the number of free parameters as this
helps to avoid overﬁtting [30].
The areal data are not associated with location points but with regions  and their observations
are obtained by spatially aggregating the original data. To handle the multivariate areal data  we

LXl=1

4

design an observation model with a spatial aggregation process for each of the areal data sets. Let
ys = (ys 1  . . .   ys |Ps|) be a |Ps|-dimensional vector consisting of the areal observations for the
s-th areal data set. Let y = (y1  y2  . . .   yS)> denote an N-dimensional vector consisting of the
observations for all areal data sets  where N =PS
s=1 |Ps| is the total number of areal observations.
Each areal observation is assumed to be obtained by integrating the mixed GP f (x) over the
corresponding region; y is generated from the Gaussian distribution1 
A(x)f (x) dx  ⌃◆  
y | f (x) ⇠N ✓yZX
1CCA  
A(x) =0BB@

where A(x) : X! RN⇥S is represented by
a1(x)
0
...
0

in which as(x) =as 1(x)  . . .   as |Ps|(x)>  whose entry as n(x) is a nonnegative weight function
for spatial aggregation over region Rs n. This formulation does not depend on the particular choice
of {as n(x)}  provided that they are integrable. If one takes  for region Rs n 

···
···
...
··· aS(x)

0
...
0

a2(x)

(5)

(6)

0
0
...

as n(x) =

 

(7)

(x 2R s n)
(x0 2R s n) dx0

RX

1I  . . .   2

SI) in (5) is an N ⇥ N block diagonal matrix  where 2

(Z) = 1 if Z is true and (Z) = 0 otherwise  then ys n is the
where (•) is the indicator function;
average of fs(x) over Rs n. We may also consider other aggregation processes to suit the property
of the areal observations  including simple summation and population-weighted averaging over Rs n.
s is the noise variance
⌃ = diag(2
for the s-th GP  and I is the identity matrix. Figure 2(a) shows a graphical model representation of
SAGP  where shaded and unshaded nodes indicate observed and latent variables  respectively.
Extension to the case of multiple domains. It is possible to apply SAGP to areal data sets from
multiple domains by assuming that observations are conditionally independent given the latent GPs
l=1. The graphical model representation of SAGP shown in Figure 2(b) is for the case of two
{gl(x)}L
domains. The superscript in Figure 2(b) is the domain index  and X u is the union of the input spaces
for both domains. Although y(1) and y(2) in Figure 2(b) are not directly correlated across domains 
the shared covariance functions {l(x  x0)}L
l=1 for the latent GPs can be learned by transfer learning
based on the data sets from multiple domains; thus the spatial correlation for each data set could be
more appropriately output via the covariance functions  even if we have only a few data sets available
for a single domain. SAGP can be extended to the case of more domains in a similar fashion.

4

Inference

Given the areal data sets  we aim to derive the posterior GP on the basis of a Bayesian inference
procedure. The posterior GP can be used for predicting data values at any location point in the
continuous space. The model parameters  W  ⇤(x  x0)  ⌃  ⌫(x)  (x  x0)  are estimated by
maximizing the marginal likelihood  in which multivariate GP f (x) is analytically integrated out; we
then construct the posterior GP by using the estimated parameters.
Marginal likelihood. Consider the case of a single domain. Given the areal data y  the marginal
likelihood is given by

(8)
where we analytically integrate out the GP prior f (x). Here  µ is an N-dimensional mean vector
represented by

p(y) = N (y | µ  C)  

A(x)m(x) dx 

(9)

1We here assume that the integral appearing in (5) is well-deﬁned. It should be noted that without additional
assumptions sample paths of a Gaussian process are in general not integrable. See Appendix C of Supplementary
Material for discussion on the conditions under which the integral is well-deﬁned.

µ =ZX

5

C =ZZX⇥X
Cs s0 =ZZX⇥X

(10)

(11)

(12)

which is the integral of the mean function m(x) over the respective regions for all areal data sets. C
is an N ⇥ N covariance matrix represented by

A(x)K(x  x0)A(x0)> dx dx0 + ⌃.

It is an S ⇥ S block matrix whose (s  s0)-th block Cs s0 is a |Ps|⇥|P s0| matrix represented by

ks s0(x  x0)as(x)as0(x0)> dx dx0 + s s02

s I.

Equation (11) provides the region-to-region covariance matrices in the form of the double integral of
the covariance function ks s0(x  x0) over the respective pairs of regions in Ps ⇥P s0; this conceptually
corresponds to aggregation of the covariance function values that are calculated at the inﬁnite pairs of
location points in the corresponding regions. Since the integrals over regions cannot be calculated
analytically  in practice we use a numerical approximation of these integrals. Details are provided at
the end of this section. This formulation allows for accurately evaluating the covariance between
regions considering their shapes; this is extremely helpful as some input data are likely to originate
from irregularly shaped regions (e.g.  extremely elongated). By maximizing the logarithm of the
marginal likelihood (8)  we can estimate the parameters of SAGP.
Transfer learning across multiple domains. Consider the case of V domains. Let {y(v)}V
v=1
denote the collection of data sets for the V domains. In SAGP  the observations for different domains
are assumed to be conditionally independent given the shared latent GPs {gl(x)}L
l=1; the marginal
likelihood for V domains is thus given by the product of those for the V domains:

p⇣y(1)  y(2)  . . .   y(V )⌘ =

VYv=1

N⇣y(v) µ(v)  C(v)⌘  

where µ(v) and C(v) are the mean vector and the covariance matrix for the v-th domain  respectively.
Estimation of model parameters based on (12) allows for transfer learning across the areal data sets
from multiple domains via the shared covariance functions.
Posterior GP. We have only to consider the case of a single domain  because the derivation of the
posterior GP can be conducted independently for each domain. Given the areal data y and the
estimated parameters  the posterior GP f⇤(x) is given by

f⇤(x) ⇠GP (m⇤(x)  K⇤(x  x0))  

(13)
where m⇤(x) : X! RS and K⇤(x  x0) : X⇥X! RS⇥S are the mean function and the covariance
function for f⇤(x)  respectively. Deﬁning H(x) : X! RN⇥S as
A(x0)K(x0  x) dx0 

(14)

H(x) =ZX

which consists of the point-to-region covariances  which are the covariances between any location
point x and the respective regions in all areal data sets  the mean function m⇤(x) and the covariance
function K⇤(x  x0) are given by

m⇤(x) = m(x) + H(x)>C1(y  µ) 
K⇤(x  x0) = K(x  x0)  H(x)>C1H(x0) 

(15)
(16)
respectively. We can predict the data value at any location point by using the mean function (15). The
second term in (15) shows that the predictions are calculated by considering the spatial correlations and
the dependences between areal data sets  simultaneously. By using the covariance function (16)  we
can also evaluate the prediction uncertainty. Derivation of the posterior GP is detailed in Appendix B
of Supplementary Material.
Approximation of the integral over regions. The integrals over regions in (9)  (11)  and (14) cannot
be performed analytically; thus we approximate these integrals by using sufﬁciently ﬁne-grained
square grid cells. We divide input space X into square grid cells  and take Gs n to be the set of grid
points that are contained in region Rs n. Let us consider the approximation of the integral in the
covariance matrix (11). The (n  n0)-entry Cs s0(n  n0) of Cs s0 is approximated as follows:

6

Cs s0(n  n0) =ZZX⇥X

⇡

1

|Gs n|

ks s0(x  x0)as n(x)as0 n0(x0) dx dx0 + s s0n n0s

1

|Gs0 n0| Xi2Gs n Xj2Gs0 n0

ks s0(i  j) + s s0n n0s 

(17)

(18)

where we use the formulation of the region-average-observation model (7). The integrals in (9) and
(14) can be approximated in a similar way. Letting |G| denote the number of all grid points  the
computational complexity of Cs s0 (11) is O(|G|2); assuming the constant weight as n(x) = as n
(e.g.  region average)  the computational complexity can be reduced to O(|Ps||Ps0||D|)  where |D| is
the cardinality of the set of distinct distance values between grid points. Here  we use the property
that ks s0(i  j) in (18) depends only on the distance between i and j. This is useful for reducing
the computation time and the memory requirement. The average computation times for inference
were 1728.2 and 115.1 seconds for the data sets from New York City and Chicago  respectively; the
experiments were conducted on a 3.1 GHz Intel Core i7.

5 Experiments

Data. We evaluated SAGP using 10 and 3 real-world areal data sets from two cities  New York City
and Chicago  respectively. They were obtained from NYC Open Data 2 and Chicago Data Portal 3.
We used a variety of areal data sets including poverty rate  air pollution rate  and crime rate. Each data
set is associated with one of the predeﬁned geographical partitions with various granularities: UHF42
(42)  community district (59)  police precinct (77)  and zip code (186) in New York City; police
precinct (25) and community district (77) in Chicago  where each number in parentheses denotes the
number of regions in the corresponding partition. In the experiments  the data were normalized so
that each variable in each city has zero mean and unit variance. Details about the real-world data sets
are provided in Appendix D of Supplementary Material.
Reﬁnement task. We examined the task of reﬁning coarse-grained areal data by using multiple areal
data sets with various granularities. To evaluate the performance in predicting the ﬁne-grained areal
data  we ﬁrst picked up one target data set and used its coarser version for learning model parameters;
then we predicted the original ﬁne-grained target data by using the learned model. Note that the
ﬁne-grained target data was used only for evaluating the reﬁnement performance; we did not use
them in the inference process. The target data sets were poverty rate (5  59)  PM2.5 (5  42)  crime (5 
77) in New York City and poverty rate (9  77) in Chicago  where each pair of numbers in parentheses
denotes the numbers of regions in the coarse- and the ﬁne-grained partitions  respectively. Deﬁning
s0 as the index of the target data set  the evaluation metric is the mean absolute percentage error
s0 n is the
(MAPE) of the ﬁne-grained target values 
true value associated with the n-th region in the target ﬁne-grained partition; y⇤s0 n is its predicted
value  obtained by integrating the s0-th function f⇤s0(x) of the posterior GP f⇤(x) (13) over the
corresponding target ﬁne-grained region.
Setup of the proposed model. In our experiments  we used zero-mean Gaussian processes as the
latent GPs {gl(x)}L
l=1  i.e.  ⌫l(x) = 0 for l = 1  . . .   L. We used the following squared-exponential
l expkx  x0k2/22
l  where
kernel as the covariance function for the latent GPs  l(x  x0) = ↵2
l is a signal variance that controls the magnitude of the covariance  l is a scale parameter that
↵2
determines the degrees of spatial correlation  and k·k is the Euclidean norm. Here  we set ↵2
l = 1
because the variance can already be represented by scaling the columns of W. For simplicity  the
covariance function for the Gaussian noise process n(x  x0) is set to ⇤(x  x0) = diag(2
1(x 
S(x  x0))  where (•) is Dirac’s delta function. The model parameters  W  {s}S
s=1 
x0)  . . .   2
⌃  {l}L
l=1  were learned by maximizing the logarithm of the marginal likelihood (8) or (12) using
the L-BFGS method [15] implemented in SciPy (https://www.scipy.org/). For approximating
the integral over regions (see (18))  we divided a total region of each city into sufﬁciently ﬁne-grained
square grid cells  the size of which was 300 m ⇥ 300 m for both cities; the resulting sets of grid
points G for New York City and Chicago consisted of 9 352 and 7 400 grid points  respectively. The
number L of the latent GPs was chosen from {1  . . .   S} via leave-one-out cross-validation [1]; the

|Ps0|Pn2Ps0(ytrue

s0 n  where ytrue

s0 n  y⇤s0 n)/ytrue

1

2https://opendata.cityofnewyork.us
3https://data.cityofchicago.org/

7

Table 1: MAPE and standard errors for the prediction of ﬁne-grained areal data (a single city). The
numbers in parentheses denote the number L of the latent GPs determined by the validation procedure.
The single star (?) and the double star (??) indicate signiﬁcant difference between SAGP and other
models at the levels of P values of < 0.05 and < 0.01  respectively.

GPR
2-stage GP
SLFM
SAGP

Poverty rate

0.344 ± 0.046 (–)
0.210 ± 0.022 (–)
0.207 ± 0.025 (4)
0.177 ± 0.019?? (3)

New York City

PM2.5

Crime

Chicago

Poverty rate

0.072 ± 0.010 (–)
0.042 ± 0.005 (–)
0.036 ± 0.005 (6)
0.030 ± 0.005? (5)

0.860 ± 0.102 (–)
0.454 ± 0.075 (–)
0.401 ± 0.053 (2)
0.379 ± 0.055?? (3)

0.599 ± 0.099 (–)
0.380 ± 0.060 (–)
0.335 ± 0.052 (2)
0.278 ± 0.032?? (2)

(a) SAGP

(b) SLFM

(c) Visualization of the estimated parameters W and {l}L

l=1.

Figure 3: (a b) Reﬁned poverty rate data in NYC  and (c) Visualization of the estimated parameters
when predicting the poverty rate data in NYC. The radii of green and blue circles equal the values of
l estimated by SAGP and SLFM  respectively. The edge widths are proportional to the absolute
weights |ws l| estimated by the respective models. Here  we omitted those edges whose absolute
weights were lower than a threshold.
validation error was obtained using each held-out coarse-grained data value. Here  the validation was
conducted on the basis of the coarse-grained target areal data; namely we did not use the ﬁne-grained
target data in the validation process.
Baselines. We compared the proposed model  SAGP  with naive Gaussian process regression
(GPR) [22]  two-stage GP-based model (2-stage GP) [28]  and semiparametric latent factor model
(SLFM) [30]. GPR predicts the ﬁne-grained target data simply from just the coarse-grained target
data. 2-stage GP is one of the latest regression-based models. SLFM is the multivariate GP model;
SAGP is regarded as the extension of SLFM. GPR and SLFM assume that data samples are observed
at location points. We thus associate each areal observation with the centroid of the region. This
simpliﬁcation is also used for modeling the auxiliary data sets in [28].
Results for the case of a single city. Table 1 shows MAPE and standard errors for GPR  2-stage GP 
SLFM  and SAGP. For all data sets  SAGP achieved better performance in reﬁning coarse-grained
areal data; the differences between SAGP and the baselines were statistically signiﬁcant (Student’s
t-test). These results show that SAGP can utilize the areal data sets with various granularities from
the same city to accurately predict the reﬁned data. The results for all data sets from both cities are
shown in Appendix E of Supplementary Material.
Figures 3(a) and 3(b) show the reﬁnement results of SAGP and SLFM for the poverty rate data in
New York City. Here  the predictive values of each model were normalized to the range [0  1]  and
darker hues represent regions with higher values. Compared with the true data in Figure 1  SAGP
yielded more accurate ﬁne-grained data than SLFM. Figure 3(c) visualizes the mixing weights W
and the scale parameters {l}L
l=1 estimated by SAGP and SLFM when predicting the ﬁne-grained
poverty rate data in New York City  where we picked up 4 areal data sets: Poverty rate  PM2.5 
unemployment rate  and the number of 311 calls; their observations were also shown. One observes
that the scale parameters estimated by SAGP are relatively small compared with those estimated

8

PovertyPM2.5Unemployment311 call10 kmSLFM (L=4)SAGP (L=3)Table 2: MAPE and standard er-
rors for the prediction of the ﬁne-
grained data (two cities).

Chicago

Poverty rate

SLFM (trans)
SAGP (trans)

0.328 ± 0.050 (6)
0.219 ± 0.023 (4)

(a) True

(c) SLFM (trans)
Figure 5: Reﬁned poverty rate data in Chicago.

(b) SAGP (trans)

by SLFM  presumably because the spatial aggregation process incorporated in SAGP effectively
separates intrinsic spatial correlations and apparent smoothing effects due to the spatial aggregation
to yield areal observations. A comparison of the estimated weights in Figure 3(c) shows that SAGP
emphasized the useful dependences between data sets  e.g.  the strong correlation between the poverty
rate data and the unemployment rate data.
One beneﬁt of SAGP is that all predictions as-
sociated with the target regions have uncertainty
estimates  where the prediction variance can be
calculated by integrating the covariance function
K⇤(x  x0) (16) of the posterior GP (13) over the
corresponding target region. Figure 4 visualizes
the variance with SAGP in the prediction of the
poverty rate in New York City and Chicago  re-
spectively. One observes that the variances at the
regions located at the edge of the city tend to have
larger values compared with those inside the city.
This is reasonable because extrapolation is gener-
ally more difﬁcult than interpolation. These uncertainty estimates are useful in that the predictions
may help guide policy and planning in a city even if validation of them is difﬁcult.
Results for the case of two cities. SLFM and SAGP can be used for transfer learning across multiple
cities  which is more advantageous in such a situation that we have only a few data sets available on a
single city. We here show the results of reﬁning the poverty rate data in Chicago with simultaneously
utilizing the data sets from New York City. Table 2 shows MAPE and standard errors for SLFM
(trans) and SAGP (trans). Comparing Tables 1 and 2  one observes that SAGP (trans) attained
improved reﬁnement performance compared with SLFM (trans) and models trained with only the
data in a single city (i.e.  Chicago). the differences between SAGP (trans) and the other models were
statistically signiﬁcant (Student’s t-test  P value of < 0.01). This result shows that SAGP (trans)
transferred knowledge across the cities  and yielded better reﬁnement results even if there are only
a few data sets available on the target city. Figure 5 shows the reﬁnement results for the poverty
rate data in Chicago. We illustrate the true data on the left in Figure 5  and the predictions attained
by SAGP (trans) and SLFM (trans) on the right. As shown  SAGP (trans) better identiﬁed the key
regions compared with SLFM (trans).

Figure 4: Variance of the posterior GP with SAGP
for predicting the poverty rate in New York City
(Left) and Chicago (Right)  respectively.

6 Conclusion

This paper has proposed the Spatially Aggregated Gaussian Processes for inferring the multivariate
function from multiple areal data sets with various granularities. To handle multivariate areal data 
we design an observation model with the spatial aggregation process for each areal data set  which
is the integral of the Gaussian process over the corresponding region. We have conﬁrmed that our
model can accurately reﬁne the coarse-grained areal data  and improve the reﬁnement performance
by using the areal data sets from multiple cities.
There are several avenues that can be explored in future work. First  we can introduce nonlinear link
functions  as in warped GP [26]  and/or alternative likelihoods; this might help handle some kinds of
observations (e.g.  rates). Second  we can use scalable variational inference with inducing points 
similar to [31]  for large-scale data sets. Finally  our formulation provides a general framework for
modeling aggregated data and offers a potential research direction; for instance  it has the ability to
consider data aggregated on a higher dimensional input space  e.g.  spatio-temporal aggregated data.

9

References
[1] Christopher M. Bishop. Pattern Recognition and Machine Learning. Springer  2006.
[2] A. Bogomolov  B. Lepri  J. Staiano  N. Oliver  F. Pianesi  and A. Pentland. Once upon a crime:
Towards crime prediction from demographics and mobile data. In ICMI  pages 427–434  2014.
[3] E. Bonilla  K. M. Chai  and C. Williams. Multi-task Gaussian process prediction. In NeurIPS 

pages 153–160  2008.

[4] P. Boyle and M. Frean. Dependent Gaussian processes. In NeurIPS  pages 217–224  2005.
[5] T. M. Burgess and R. Webster. Optimal interpolation and isarithmic mapping of soil properties.

Journal of Soil Science  31(2)  1980.

[6] M. Gibbs and D. J. C. MacKay. Efﬁcient implementation of Gaussian processes. Technical

Report  1997.

[7] P. Goovaerts. Combining areal and point data in geostatistical interpolation: Applications to

soil science and medical geography. Mathematical Geosciences  42(5):535–554  2010.

[8] C. A. Gotway and L. J. Young. Combining incompatible spatial data. Journal of the American

Statistical Association  97(458):632–648  2002.

[9] O. Hamelijnck  T. Damoulas  K. Wang  and M. Girolami. Multi-resolution multi-task Gaussian

processes. In NeurIPS  2019 (to appear).

[10] D. Higdon. Space and space-time modelling using process convolutions. Quantitative Methods

for Current Environmental Issues  pages 37–56  2002.

[11] R. Howitt and A. Reynaud. Spatial disaggregation of agricultural production data using

maximum entropy. European Review of Agricultural Economics  30(2):359–387  2003.

[12] M. Jerrett  R. T. Burnett  B. S. Beckerman  M. C. Turner  D. Krewski  and G. Thurston et al.
Spatial analysis of air pollution and mortality in California. American Journal of Respiratory
and Critical Care Medicine  188(5):593–599  2013.

[13] P. Keil  J. Belmaker  A. M. Wilson  P. Unitt  and W. Jetz. Downscaling of species distribution

models: A hierarchical approach. Methods in Ecology and Evolution  4(1):82–94  2013.

[14] H. C. L. Law  D. Sejdinovic  E. Cameron  T. C. D. Lucas  S. Flaxman  K. Battle  and K. Fuku-
mizu. Variational learning on aggregate outputs with Gaussian processes. In NeurIPS  pages
6084–6094  2018.

[15] D. C. Liu and J. Nocedal. On the limited memory BFGS method for large scale optimization.

Mathematical Programming  45(1–3):503–528  1989.

[16] J. Luttinen and A. Ilin. Variational Gaussian-process factor analysis for modeling spatio-

temporal data. In NeurIPS  pages 1177–1185  2009.

[17] C. A. Micchelli and M. Pontil. Kernels for multi-task learning. In NeurIPS  pages 921–928 

2004.

[18] D. Murakami and M. Tsutsumi. A new areal interpolation technique based on spatial economet-

rics. Procedia-Social and Behavioral Sciences  21:230–239  2011.

[19] R. Murray-Smith and B. A. Pearlmutter. Transformations of Gaussian process priors.

DSMML  pages 110–123  2004.

In

[20] D. E. Myers. Co-kriging – new developments. In G. Verly  M. David  A. G. Journel  and
A. Marechal  editors  Geostatistics for Natural Resources Characterization: Part 1  volume
122 of NATO ASI Series C: Mathematical and Physical Sciences  pages 295–305. D. Reidel
Publishing  Dordrecht  1984.

[21] N. -W. Park. Spatial downscaling of TRMM precipitation using geostatistics and ﬁne scale

environmental variables. Advances in Meteorology  2013:1–9  2013.

10

[22] C. E. Rasmussen and C. K. I. Williams. Gaussian Processes for Machine Learning. MIT Press 

2006.

[23] A. Rupasinghaa and S. J. Goetz. Social and political forces as determinants of poverty: A

spatial analysis. The Journal of Socio-Economics  36(4):650–671  2007.

[24] C. -C. Smith  A. Mashhadi  and L. Capra. Poverty on the cheap: Estimating poverty maps using

aggregated mobile communication networks. In CHI  pages 511–520  2014.

[25] M. T. Smith  M. A. Álvarez  and N. D. Lawrence. Gaussian process regression for binned data.

In arXiv e-prints  2018.

[26] E. Snelson  Z. Ghahramani  and Carl E. Rasmussen. Warped Gaussian processes. In NeurIPS 

pages 337–344  2004.

[27] H. J. W. Sturrock  J. M. Cohen  P. Keil  A. J. Tatem  A. L. Menach  N. E. Ntshalintshali  M. S.
Hsiang  and Roland D Gosling. Fine-scale malaria risk mapping from routine aggregated case
data. Malaria Journal  13:421  2014.

[28] Y. Tanaka  T. Iwata  T. Tanaka  T. Kurashima  M. Okawa  and H. Toda. Reﬁning coarse-grained
spatial data using auxiliary spatial data sets with various granularities. In AAAI  pages 5091 –
5100  2019.

[29] B. M. Taylor  R. Andrade-Pacheco  and H. J. W. Sturrock. Continuous inference for aggregated
point process data. Journal of the Royal Statistical Society: Series A (Statistics in Society)  page
12347  2018.

[30] Y. W. Teh  M. Seeger  and M. I. Jordan. Semiparametric latent factor models. In AISTATS 

pages 333–340  2005.

[31] M. Titsias. Variational learning of inducing variables in sparse Gaussian processes. In AISTATS 

pages 567–574  2009.

[32] H. Wang  D. Kifer  C. Graif  and Z. Li. Crime rate inference with big data. In KDD  pages

635–644  2016.

[33] R. L. Wilby  S. P. Zorita  E. Timbal  B. Whetton  and L. O. Mearns. Guidelines for Use of

Climate Scenarios Developed from Statistical Downscaling Methods  2004.
[34] K. Wilson and J. Wakeﬁeld. Pointless spatial modeling. Biostatistics  2018.
[35] G. Wotling  C. Bouvier  J. Danloux  and J. -M. Fritsch. Regionalization of extreme precipitation
distribution using the principal components of the topographical environment. Journal of
Hydrology  233(1-4):86–101  2000.

[36] A. Xavier  M. B. C. Freitas  M. D. S. Rosj´ario  and R. Fragoso. Disaggregating statistical data

at the ﬁeld level: An entropy approach. Spatial Statistics  23:91–103  2016.

[37] F. Youseﬁ  M. T. Smith  and M. A. Álvarez. Multi-task learning for aggregated data using

Gaussian processes. In NeurIPS  2019 (to appear).

[38] J. Yuan  Y. Zheng  and X. Xie. Discovering regions of different functions in a city using human

mobility and POIs. In KDD  pages 186–194  2012.

[39] M. A. Álvarez  L. Rosasco  and N. D. Lawrence. Kernels for vector-valued functions: A review.

Foundations and Trends R in Machine Learning  4(3):195–266  2012.

11

,Minjie Xu
Balaji Lakshminarayanan
Yee Whye Teh
Jun Zhu
Bo Zhang
Yusuke Tanaka
Toshiyuki Tanaka
Tomoharu Iwata
Takeshi Kurashima
Maya Okawa
Yasunori Akagi
Hiroyuki Toda