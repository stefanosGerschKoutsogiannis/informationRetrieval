2018,Solving Large Sequential Games with the Excessive Gap Technique,There has been tremendous recent progress on equilibrium-finding algorithms for zero-sum imperfect-information extensive-form games  but there has been a puzzling gap between theory and practice. First-order methods have significantly better theoretical convergence rates than any counterfactual-regret minimization (CFR) variant. Despite this  CFR variants have been favored in practice. Experiments with first-order methods have only been conducted on small- and medium-sized games because those methods are complicated to implement in this setting  and because CFR variants have been enhanced extensively for over a decade they perform well in practice. In this paper we show that a particular first-order method  a state-of-the-art variant of the excessive gap technique---instantiated with the dilated entropy distance function---can efficiently solve large real-world problems competitively with CFR and its variants. We show this on large endgames encountered by the Libratus poker AI  which recently beat top human poker specialist professionals at no-limit Texas hold'em. We show experimental results on our variant of the excessive gap technique as well as a prior version. We introduce a numerically friendly implementation of the smoothed best response computation associated with first-order methods for extensive-form game solving. We present  to our knowledge  the first GPU implementation of a first-order method for extensive-form games. We present comparisons of several excessive gap technique and CFR variants.,SolvingLargeSequentialGameswiththeExcessiveGapTechniqueChristianKroer GabrieleFarina andTuomasSandholmDepartmentofComputerScienceCarnegieMellonUniversityPittsburgh PA15213{ckroer gfarina sandholm}@cs.cmu.eduAbstractTherehasbeentremendousrecentprogressonequilibrium-ﬁndingalgorithmsforzero-sumimperfect-informationextensive-formgames buttherehasbeenapuz-zlinggapbetweentheoryandpractice.First-ordermethodshavesigniﬁcantlybettertheoreticalconvergenceratesthananycounterfactual-regretminimization(CFR)variant.Despitethis CFRvariantshavebeenfavoredinpractice.Experimentswithﬁrst-ordermethodshaveonlybeenconductedonsmall-andmedium-sizedgamesbecausethosemethodsarecomplicatedtoimplementinthissetting andbecauseCFRvariantshavebeenenhancedextensivelyforoveradecadetheyperformwellinpractice.Inthispaperweshowthataparticularﬁrst-ordermethod astate-of-the-artvariantoftheexcessivegaptechnique—instantiatedwiththedilatedentropydistancefunction—canefﬁcientlysolvelargereal-worldproblemscompetitivelywithCFRanditsvariants.WeshowthisonlargeendgamesencounteredbytheLibratuspokerAI whichrecentlybeattophumanpokerspecialistprofessionalsatno-limitTexashold’em.Weshowexperimentalresultsonourvariantoftheexcessivegaptechniqueaswellasapriorversion.Weintroduceanumericallyfriendlyimplementationofthesmoothedbestresponsecomputationassociatedwithﬁrst-ordermethodsforextensive-formgamesolving.Wepresent toourknowledge theﬁrstGPUimplementationofaﬁrst-ordermethodforextensive-formgames.WepresentcomparisonsofseveralexcessivegaptechniqueandCFRvariants.1IntroductionTwo-playerzero-sumextensive-formgames(EFGs)areageneralrepresentationthatenablesonetomodelamyriadofsettingsrangingfromsecuritytobusinesstomilitarytorecreational.TheNashequilibriumsolutionconcept[22]prescribesasoundnotionofrationalplayforthissetting.Itisalsorobustinthisclassofgame:iftheopponentplayssomeotherstrategythananequilibriumstrategy thatcanonlyhelpus.Therehasbeentremendousrecentprogressonequilibrium-ﬁndingalgorithmsforextensive-formzero-sumgames.However therehasbeenavexinggapbetweenthetheoryandpracticeofequilibrium-ﬁndingalgorithms.Inthispaperwewillhelpclosethatgap.Itiswell-knownthatthestrategyspacesofanextensive-formgamecanbetransformedintoconvexpolytopesthatallowabilinearsaddle-pointformulation(BSPP)oftheNashequilibriumproblemasfollows[26 28 16].minx∈Xmaxy∈Yhx Ayi=maxy∈Yminx∈Xhx Ayi(1)32ndConferenceonNeuralInformationProcessingSystems(NeurIPS2018) Montréal Canada.Problem(1)canbesolvedinanumberofways.Earlyon vonStengel[28]showedthatitcanbesolvedwithalinearprogram(LP)—bytakingthedualoftheoptimizationproblemfacedbyoneplayer(saytheyplayer)whenholdingthestrategyofthexplayerﬁxed andinjectingtheprimalx-playerconstraintsintothedualLP.Thisapproachwasusedinearlyworkonextensive-formgamesolving uptogamesofsize105[15].GilpinandSandholm[10]coupleditwithlosslessabstractioninordertosolveRhodeIslandhold’emwhichhas109nodesinthegametree.Sincethen LPapproacheshavefallenoutoffavor.TheLPisoftentoolargetoﬁtinmemory andevenwhenitdoesﬁttheiterationsofthesimplexorinterior-pointmethodsusedtosolvetheLPtaketoolong—evenifonlymodestaccuracyisrequired.Instead modernworkonsolvingthisgameclassinthelargefocusesoniterativemethodsthatconvergetoaNashequilibriuminthelimit.Twotypesofalgorithmshavebeenpopularinparticular:regret-minimizationalgorithmsbasedoncounterfactualregretminimization(CFR)[29 20 1 5 21 4] andﬁrst-ordermethods(FOMs)basedoncombiningafastbilinearsaddle-pointproblem(BSPP)solversuchastheexcessivegaptechnique(EGT)[24]withanappropriatedistance-generatingfunction(DGF)forEFGstrategies[11 17 19 18].TheCFRfamilyhasbeenmostpopularinpracticesofar.TheCFR+variant[27]wasusedtonear-optimallysolveheads-uplimitTexashold’em[1] agamethathas1013decisionpointsafterlosslessabstraction.CFR+wasalsousedforsubgamesolvinginLibratus[4] anAIthatbeatfourtopprofessionalheads-upno-limitTexashold’empoker(HUNL)players—agamethathas10161decisionpoints(beforeabstraction)[12].AvariantofCFRwasalsousedbyLibratustocomputethewhole-gamestrategy(alsoknownas“blueprint”strategy)[4].AhybridofCFRandCFR+wasutilizedbyDeepStacktobeatHUNLprofessionals[21].CFR-basedalgorithmsconvergeatarateof1√T whereassomealgorithmsbasedonFOMsconvergeatarateof1T.Despitethistheoreticallysuperiorconvergencerate FOMshavehadrelativelylittleadoptioninpractice.ComparisonsofCFR-basedalgorithmsandFOMswereconductedbyKroeretal.[17]andKroeretal.[19] wheretheyfoundthataheuristicvariantofEGTinstantiatedwithanappropriatedistancemeasureissuperiortoCFRregretmatching(RM)andCFRwithregret-matching+(RM+)forsmall-to-medium-sizedgames.Inthispaper wepresenttheﬁrstexperimentsonalargegame—arealgameplayedbyhumans—showingthatanaggressivevariantofEGTinstantiatedwiththeDGFofKroeretal.[19]iscompetitivewiththeCFRfamilyinpractice.ItoutperformsCFRwithRM+ althoughCFR+isstillslightlyfaster.ThisistheﬁrsttimethataFOMhasbeenshownsuperiortoanyCFRvariantonareal-worldproblem.WeshowthisonsubgamesencounteredbyLibratus.TheLibratusagentsolvedanabstractionofthefullgameofno-limitTexashold’emaheadoftimeinordertoobtaina“blueprint”strategy.Duringplay Libratusthenreﬁnedthisblueprintstrategybysolvingsubgameswithsigniﬁcantlymoredetailedabstractionsinrealtime[4 3].OurexperimentsareonsolvingendgamesencounteredbyLibratusinthebeginningofthefourth(“river”inpokerlingo)bettinground withthefullﬁne-grainedabstractionactuallyusedbyLibratus.Thisabstractionhasnoabstractionofcards thatis themodelcapturesallaspectsofthecards.Thereisabstractionofbetsizestokeepthebranchingfactorreasonable;inourexperimentsweusetheexactfullﬁne-grainedbettingabstractionthatwasusedbyLibratus.ThusweshowthatitispossibletogetthetheoreticallysuperiorguaranteeofFOMswhilealsogettingstrongpracticalperformance.Inordertomakeourapproachpractical weintroduceanumberofpracticaltechniquesforrunningFOMsonEFGs.Inparticular wederiveefﬁcientandnumericallyfriendlyexpressionsforthesmoothed-bestresponse(SBR)andproxmapping twooptimizationsubproblemsthatEGTsolvesateveryiteration.Furthermore weintroduceaGPU-basedvariantoftheseoperationswhichallowsustoparallelizeEGTiterations.WeshowexperimentsforseveralvariantsofbothEGTandCFR.ForEGT weconsidertwopracticalvariants onethathastheinitialsmoothingparametersetoptimistically andonethatadditionallyperformsaggressivestepsizing.ForCFR weshowexperimentalresultsforCFRwithRM RM+ andCFR+(i.e. CFRwithlinearaveragingandRM+).Wewilldescribethesevariantsindetailinthebodyofthepaper.WeconductedalltheexperimentsonparallelizedGPUcode.22BilinearSaddle-PointProblemsThecomputationofaNashequilibriuminazero-sumimperfect-informationEFGcanbeformulatedasthefollowingbilinearsaddle-pointproblem:minx∈Xmaxy∈Yhx Ayi=maxy∈Yminx∈Xhx Ayi (2)whereX Yareconvex compactsetsinEuclideanspacesEx Ey.Aisthesequence-formpayoffmatrixandX Yarethesequence-formstrategyspacesofPlayer1and2 respectively.SeveralFOMswithattractiveconvergencepropertieshavebeenintroducedforBSPPs[25 24 23 8].ThesemethodsrelyonhavingsomeappropriatedistancemeasureoverXandY calledadistance-generatingfunction(DGF).Generally FOMsusetheDGFtochoosesteps:givenagradientandascalarstepsize aFOMmovesinthenegativegradientdirectionbyﬁndingthepointthatminimizesthesumofthegradientandoftheDGFevaluatedatthenewpoint.Inotherwords thenextstepcanbefoundbysolvingaregularizedoptimizationproblem wherelonggradientstepsarediscouragedbytheDGF.ForEGTonEFGs theDGFcanbeinterpretedasasmoothingfunctionappliedtothebest-responseproblemsfacedbytheplayers.Deﬁnition1.Adistance-generatingfunctionforXisafunctiond(x):X→RwhichisconvexandcontinuousonX admitscontinuousselectionofsubgradientsonthesetX◦={x∈X:∂d(x)6=∅} andhasstrongconvexitymodulusϕw.r.t.k·k.Distance-generatingfunctionsforYaredeﬁnedanalogously.GivenDGFsdX dYforX YwithstrongconvexitymoduliϕXandϕYrespectively wenowdescribeEGT[24]appliedto(1).EGTformstwosmoothedfunctionsusingtheDGFsfµy(x)=maxy∈Yhx Ayi−µydY φµx(y)=minx∈Xhx Ayi+µxdX.(3)Thesefunctionsaresmoothedapproximationstotheoptimizationproblemfacedbythexandyplayer respectively.Thescalarsµx µy>0aresmoothnessparametersdenotingtheamountofsmoothingapplied.Letyµy(x)andxµx(y)refertotheyandxvaluesattainingtheoptimain(3).Thesecanbethoughtofassmoothedbestresponses.Nesterov[25]showsthatthegradientsofthefunctionsfµy(x)andφµx(y)existandareLipschitzcontinuous.ThegradientoperatorsandLipschitzconstantsare∇fµy(x)=a1+Ayµy(x) ∇φµx(y)=a2+A>xµx(y) L1(cid:0)fµy(cid:1)=kAk2ϕYµy L2(φµx)=kAk2ϕXµx wherekAkisthe‘1-normoperatornorm.LettheconvexconjugateofdX:X→Rbedenotedbyd∗X(g)=maxx∈XgTx−d(x).Thegradient∇d∗(g)oftheconjugatethengivesthesolutiontothesmoothed-best-responseproblem.Basedonthissetup EGTminimizesthefollowingsaddle-pointresidual whichisequaltothesumofregretsfortheplayers.sad(xt yt)=maxy∈Y(xt)TAy−minx∈XxTAytTheideabehindEGTistomaintaintheexcessivegapcondition(EGC) EGV(x y):=φµx(y)−fµy(x)>0.TheEGCimpliesaboundonthesaddle-pointresidual:sad(xt yt)≤µxΩX+µyΩY whereΩX=maxx x0dX(x)−dX(x0) andΩYdeﬁnedanalogously.WeformallystateEGT[24]asAlgorithm1.TheEGTalgorithmalternatesbetweentakingstepsfocusedonXandY.Algorithm2showsasinglestepfocusedonX.Stepsfocusedonyareanalogous.Algorithm1showshowthealternatingstepsandstepsizesarecomputed aswellashowinitialpointsareselected.Supposetheinitialvaluesµx µysatisfyµx=ϕXL1(fµy).Then ateveryiterationt≥1ofEGT thecorrespondingsolutionzt=[xt;yt]satisﬁesxt∈X yt∈Y theexcessivegapconditionismaintained andsad(xT yT)≤4kAkT+1sΩXΩYϕXϕY.Consequently EGThasaconvergencerateofO(1T)[24].3Algorithm1EGT(DGF-centerxω DGFweightsµx µy and>0)1:x0=∇d∗X(cid:0)µ−1x∇fµy(xω)(cid:1)2:y0=yµy(xω)3:t=04:whilesad(xt yt)>do5:τt=2t+36:iftiseventhen7:(µt+1x xt+1 yt+1)=STEP(µtx µty xt yt τ)8:else9:(µt+1y yt+1 xt+1)=STEP(µty µtx yt xt τ)10:t=t+111:returnxt ytAlgorithm2STEP(µx µy x y τ)1:ˆx=(1−τ)x+τxµx(y)2:y+=(1−τ)y+τyµy(ˆx)3:˜x=∇d∗X(cid:16)∇dX(xµx(y))−τ(1−τ)µx∇fµy(ˆx)(cid:17)4:x+=(1−τ)x+τ˜x5:µ+x=(1−τ)µx6:returnµ+x x+ y+3TreeplexesHodaetal.[11]introducedthetreeplex aclassofconvexpolytopesthatcapturesthesequence-formofthestrategyspacesinperfect-recallEFGs.Deﬁnition2.Treeplexesaredeﬁnedrecursively:1.Basicsets:Thestandardsimplex∆misatreeplex.2.Cartesianproduct:IfQ1 ... Qkaretreeplexes thenQ1×···×Qkisatreeplex.3.Branching:GivenatreeplexP⊆[0 1]p acollectionoftreeplexesQ={Q1 ... Qk}whereQj⊆[0 1]nj andl={l1 ... lk}⊆{1 ... p} thesetdeﬁnedbyPlQ:=n(x y1 ... yk)∈Rp+Pjnj:x∈P y1∈xl1·Q1 ... yk∈xlk·Qkoisatreeplex.WesayxljisthebranchingvariableforthetreeplexQj.Oneinterpretationofthetreeplexisasasetofsimplexes whereeachsimplexisweightedbythevalueofthevariableaboveitintheparentbranchingoperation(or1ifthereisnobranchingoperationprecedingthesimplex).Thusthesimplexesgenerallysumtothevalueoftheparentratherthan1.ForatreeplexQ wedenotebySQtheindexsetofthesetofsimplexescontainedinQ(inanEFGSQisthesetofinformationsetsbelongingtotheplayer).Foreachj∈SQ thetreeplexrootedatthej-thsimplex∆jisreferredtoasQj.Givenvectorq∈Qandsimplex∆j weletIjdenotethesetofindicesofqthatcorrespondtothevariablesin∆janddeﬁneqjtobethesubvectorofqcorrespondingtothevariablesinIj.Foreachsimplex∆jandbranchi∈Ij thesetDijrepresentsthesetofindicesofsimplexesreachedimmediatelyafter∆jbytakingbranchi(inanEFG Dijisthesetofpotentialnext-stepinformationsetsfortheplayer).Givenavectorq∈Q simplex∆j andindexi∈Ij eachchildsimplex∆kforeveryk∈Dijisscaledbyqi.Foragivensimplex∆j weletpjdenotetheindexinqoftheparentbranchingvariableqpjscaling∆j.Weusetheconventionthatqpj=1ifQissuchthatnobranchingoperationprecedes∆j.Foreachj∈SQ djisthemaximumdepthofthetreeplexrootedat∆j thatis themaximumnumberofsimplexesreachablethroughaseriesofbranchingoperationsat∆j.ThendQgivesthedepthofQ.WeusebjQtoidentifythenumberofbranchingoperationsprecedingthej-thsimplexinQ.WesaythatasimplexjsuchthatbjQ=0isarootsimplex.Figure1illustratesanexampletreeplexQ.ThistreeplexQisconstructedfromninetwo-to-three-dimensionalsimplexes∆1 ... ∆9.Atlevel1 wehavetworootsimplexes ∆1 ∆2 obtainedbyaCartesianproductoperation(denotedby×).Wehavemaximumdepthsd1=2 d2=1beneaththem.Sincetherearenoprecedingbranchingoperations theparentvariablesforthesesimplexes∆1and∆2areqp1=qp2=1.For∆1 thecorrespondingsetofindicesinthevectorqisI1={1 2} whilefor∆2wehaveI2={3 4 5}.Atlevel2 wehavethesimplexes∆3 ... ∆7.Theparentvariableof∆3isqp3=q1;therefore ∆3isscaledbytheparentvariableqp3.Similarly eachofthesimplexes4∆3 ... ∆7isscaledbytheirparentvariablesqpjthatthebranchingoperationwasperformedon.Soonfor∆8and∆9aswell.Thenumberofbranchingoperationsrequiredtoreachsimplexes∆1 ∆3and∆8isb1Q=0 b3Q=1andb8Q=2 respectively.∆1q2·∆4q7q8q1·∆3q6·∆8q16q17q6·∆7q13q14q15q5q6q1q2∆2q4·∆6q11q12q3·∆5q9q10q3q4××Figure1:Anexampletreeplexconstructedfrom9simplexes.Cartesianproductoperationisdenotedby×.4SmoothedBestResponsesLetdj(x)=Pi∈Ijxilogxi+lognbetheentropyDGFforthen-dimensionalsimplex∆n wherenisthedimensionofthej’thsimplexinQ.Kroeretal.[19]introducedthefollowingDGFforQbydilatingdsforeachsimplexinSQandtaketheirsum:d(q)=Pj∈SQβjqpjdj(cid:16)qjqpj(cid:17) whereβj=2+Pk∈Dj2βk.OtherdilatedDGFsfortreeplexeswereintroducedbyHodaetal.[11]andwerealsostudiedbyKroeretal.[17].Kroeretal.[19]provedthatthisDGFisstronglyconvexmodulus1MwhereMisthemaximumvalueofthe‘1normoverQ.EGTinstantiatedwiththisDGFconvergesatarateofLM22dlognTwhereListhemaximumentryinthepayoffmatrix disthedepthofthetreeplex andnisthemaximumdimensionofanyindividualsimplex.Wenowshowhowtosolve(3)forthisparticularDGF.WhileitisknownthatthisDGFhasaclosed-formsolution thisistheﬁrsttimetheapproachhasbeenshowninapaper.Furthermore webelievethatourparticularsolutionisnovel andleadstobettercontrolovernumericalissues.Theproblemwewishtosolveisthefollowing.argminXj∈SQhqj gji+βjqpjdj(qj/qpj)=argminXj∈SQqpj(h¯qj gji+βjdj(¯qj))(4)wheretheequalityfollowsbythefactthatqi=qpj¯qi.Foraleafsimplexj itscorrespondingterminthesummationhasnodependenceonanyotherpartofthegametreeexceptforthemultiplicationbyxpj(becausenoneofitsvariablesareparenttoanyothersimplex).Becauseofthislackofdependence theexpressionh¯qj/qpj gji+βjdj(qj/qpj)canbeminimizedindependentlyasifitwereanoptimizationproblemoverasimplexwithvariables¯qj=xj/qpj(thiswasalsopointedoutinProposition3.4inHodaetal.[11]).Weshowhowtosolvetheoptimizationproblemataleaf:min¯qj∈∆jh¯qj gji+βjdj(¯qj).WritingtheLagrangianwithrespecttothesimplexconstraintandtakingthederivativewrt.¯qigivesmin¯qjh¯qj gji+βjdj(¯qj)+λ(1−Xi∈Ij¯qi)⇒gi+βj(1+log¯qi)=λ⇒¯qi∝e−gi/βjThisshowshowtosolvethesmoothed-best-responseproblemataleaf.Foraninternalsimplexj Proposition3.4ofHodaetal.[11]saysthatwecansimplycomputethevalueatallsimplexesbelowj addthevaluetogj(thisiseasilyseenfrom(4);eachqiactsasascalaronthevalueofallsimplexes5afteri) andproceedbyinduction.Letting|Ij|=n wenowsimplifytheobjectivefunction:h¯qj gji+βj(Xi∈Ij(¯qilog¯qi)+logn)=Xi(¯qi(gi+βjlog¯qi))+βjlogn=Xi(¯qi(λ−βj))+βjlogn=λ−βj+βjlogn wherethelasttwoequalitiesfollowﬁrstbyapplyingourderivationforλandthenthefactthat¯qjsumstoone.Thisshowsthatwecanchooseanarbitraryindexi∈Ijandpropagatethevaluegi+βjlog¯qi+βjlogn.Inparticular fornumericalreasonswechoosetheonethatmaximizes¯qi.Inadditiontosmoothedbestresponses fastFOMsusuallyalsorequirecomputationofproximalmappings whicharesolutionstoargminq∈Qhq gi+D(qkq0) whereD(qkq0)=d(q)−d(q0)−h∇d(q0) q−q0iistheBregmandivergenceassociatedwiththechosenDGFd.Unlikethesmoothedbestresponse weareusuallyonlyinterestedintheminimizingsolutionandnottheassociatedvalue.Thereforewecandroptermsthatdonotdependonqandtheproblemreducestoargminq∈Qhq gi+d(q)−h∇d(q0) qi whichcanbesolvedwithoursmoothedbestresponseapproachbyusingtheshiftedgradient˜g=g−∇d(q0).Thishasonepotentialnumericalpitfall:theDGF-gradient∇d(q0)maybeunstableneartheboundaryofQ forexamplebecausetheentropyDGF-gradientrequirestakinglogarithms.Itispossibletoderiveaseparateexpressionfortheproximalmappingthatissimilartowhatwedidforthesmoothedbestresponse;thisexpressioncanhelpavoidthisissue.However becauseweonlycareaboutgettingtheoptimalsolution notthevalueassociatedwithit thisisnotnecessary.Thelargegradientsneartheboundaryonlyaffectthesolutionbysettingbadactionstooclosetozero whichdoesnotseemtoaffectperformance.5PracticalEGTRatherthantheoverlyconservativestepsizeandµparameterssuggestedinthetheoryforEGTweusemorepracticalvariantscombiningpracticaltechniquesfromKroeretal.[19]andHodaetal.[11].ThepseudocodeisshowninAlgorithm3.AsinKroeretal.[19]weuseapractically-tunedinitialchoicefortheinitialsmoothingparametersµ.Furthermore ratherthanalternatingthestepsonplayers1and2 wealwayscallSTEPontheplayerwithahigherµvalue(thischoiceissomewhatreminiscentoftheµ-balancingheuristicemployedbyHodaetal.[11]althoughourapproachavoidsanadditionalﬁttingstep).TheEGTalgorithmwithapractically-tunedµandthisµbalancingheuristicwillbedenotedEGTinourexperiments.Inaddition weuseanEGTvariantthatemploystheaggressiveµreductiontechniqueintroducedbyHodaetal.[11].AggressiveµreductionusestheobservationthattheoriginalEGTstepsizechoices whichareτ=23+t arechosentoguaranteetheexcessivegapcondition butmaybeoverlyconservative.Instead aggressiveµreductionsimplymaintainssomecurrentτ initiallysetto0.5 andtriestoapplythesamestepsizeτrepeatedly.Aftereverystep wecheckthattheexcessivegapconditionstillholds;ifitdoesnotholdthenwebacktrack τisdecreased andwerepeattheprocess.AτthatmaintainstheconditionisalwaysguaranteedtoexistbyTheorem2ofNesterov[24].ThepseudocodeforthisisgiveninAlgorithm4.EGTwithaggressiveµreduction apracticallytunedinitialµ andµbalancing willbedenotedEGT/ASinourexperiments.6AlgorithmImplementationTocomputesmoothedbestresponses weuseaparallelizationscheme.WeparallelizeacrosstheinitialCartesianproductoftreeplexesattheroot.AslongasthisCartesianproductiswideenough thesmoothedbestresponsecomputationwilltakefulladvantageofparallelization.Thisisacommonstructureinreal-worldproblems forexamplerepresentingthestartinghandinpoker orsomestochasticprivatestateofeachplayerinotherapplications.Thisparallelizationschemealsoworksforgradientcomputationbasedontreetraversal.However inthispaperwedogradientcomputationbywritingdownasparsepayoffmatrixusingCUDA’ssparselibraryandletCUDAparallelizethegradientcomputation.Forpoker-speciﬁcapplications(andcertainothergameswhereutilitiesdecomposenicelybasedonprivateinformation)itispossibletospeedupthegradientcomputationsubstantiallybyemployingthe6Algorithm3EGT/AS(DGF-centerxω DGFweightsµx µy and>0)1:x0=∇d∗X(cid:0)µ−1x∇fµy(xω)(cid:1)2:y0=yµy(xω)3:t=04:τ=125:whilesad(xt yt)>do6:ifµx>µythen7:(µt+1x xt+1 yt+1 τ)=DECR(µtx µty xt yt τ)8:else9:(µt+1y yt+1 xt+1 τ)=DECR(µty µtx yt xt τ)10:t=t+111:returnxt ytAlgorithm4DECR(µx µy x y τ)1:(µ+x x+ y+)=STEP(µx µy x y τ)2:whileEGV(x y)<0do3:τ=12τ4:(µ+x x+ y+)=STEP(µx µy x y τ)5:returnµ+xxt yt τacceleratedtreetraversalofJohansonetal.[13].Wedidnotusethistechnique.Inourexperiments themajorityoftimeisspentingradientcomputation sothisaccelerationislikelytoaffectallthetestedalgorithmsequally.Furthermore sincethetechniqueisspeciﬁctogameswithcertainstructures ourexperimentsgiveabetterestimateofgeneralEFG-solvingperformance.7ExperimentsWenowpresentexperimentalresultsonrunningallthepreviouslydescribedalgorithmsonaGPU.AllexperimentswererunonaGoogleCloudinstancewithanNVIDIATeslaK80GPUwith12GBavailable.AllcodewasimplementedinC++usingCUDAforGPUoperations andcuSPARSEforthesparsepayoffmatrix.WecompareagainstseveralCFRvariants.1WerunCFRwithRM(CFR(RM)) RM+(CFR(RM+)) andCFR+whichisCFRwithRM+andalinearaveragingscheme.Wenowdescribethesevariants.DetaileddescriptionscanalsobefoundinZinkevichetal.[29]andTammelinetal.[27].Ourexperimentsareconductedonreallarge-scale“river”endgamesfacedbytheLibratusAI[4].Libratuswascreatedforthegameofheads-upno-limitTexashold’em.Libratuswasconstructedbyﬁrstcomputinga“blueprint”strategyforthewholegame(basedonabstractionandMonte-CarloCFR[20]).Then duringplay Libratuswouldsolveendgamesthatarereachedusingasigniﬁcantlyﬁner-grainedabstraction.Inparticular thoseendgameshavenocardabstraction andtheyhaveaﬁne-grainedbettingabstraction.Forthebeginningofthesubgame theblueprintstrategygivesaconditionaldistributionoverhandsforeachplayer.ThesubgameisconstructedbyhavingaChancenodedealouthandsaccordingtothisconditionaldistribution.2Asubgameisstructuredandparameterizedasfollows.Thegameisparameterizedbytheconditionaldistributionoverhandsforeachplayer currentpotsize boardstate(5cardsdealttotheboard) andabettingabstraction.First Chancedealsouthandstothetwoplayersaccordingtotheconditionalhanddistribution.Then Libratushasthechoiceoffolding checking orbettingbyanumberofmultipliersofthepotsize:0.25x 0.5x 1x 2x 4x 8x andall-in.IfLibratuschecksandtheotherplayerbetsthenLibratushasthechoiceoffolding calling(i.e.matchingthebetandendingthebetting) orraisingbypotmultipliers0.4x 0.7x 1.1x 2x andall-in.IfLibratusbetsandtheotherplayerraisesLibratuscanfold call orraiseby0.4x 0.7x 2x andall-in.FinallywhenfacingsubsequentraisesLibratuscanfold call orraiseby0.7xandall-in.Whenfacedwithaninitialcheck theopponentcanfold check orraiseby0.5x 0.75x 1x andall-in.Whenfacedwithaninitialbettheopponentcanfold call orraiseby0.7x 1.1x andall-in.Whenfacedwithsubsequentraisestheopponentcanfold call orraiseby0.7xandall-in.Thegameendswheneveraplayerfolds(theotherplayerwinsallmoneyinthepot) calls(ashowdownoccurs) orbothplayerscheckastheirﬁrstactionofthegame(ashowdownoccurs).Inashowdowntheplayerwiththebetterhandswinsthepot.Thepotissplitincaseofatie.(ForourexperimentsweusedendgameswhereitisLibratus’sturntomoveﬁrst.)1Allvariantsusethealternatingupdatesscheme.2Libratususedtwodifferentsubgame-solvingtechniques one“unsafe”andone“safe”[3].Thecomputationalprobleminthetwoisessentiallyidentical.Weexperimentwiththe“unsafe”version whichusesthepriordistributionsdescribedhere.710010110210310410−310−210−1100101102103Iteration(regretsum)[mbb]Endgame2CFR+EGTEGT/ASCFR(RM)CFR(RM+)10010110210310410−310−210−1100101102103Iteration(regretsum)[mbb]Endgame7CFR+EGTEGT/ASCFR(RM)CFR(RM+)Figure2:Solutionqualityasafunctionofthenumberofiterationsforallalgorithmsontworiversubgames.Thesolutionqualityisgivenasthesumofregretsfortheplayersinmilli-big-blinds.WeconductedexperimentsontworiverendgamesextractedfromLibratusplay:Endgame2andEndgame7.Endgame2hasapotofsize2100atthebeginningoftheriverendgame.Ithasdimension140kand144kforLibratusandtheopponent respectively and176Mleavesinthegamestree.Endgame7hasapotofsize$3750atthebeginningoftheriversubgame.Ithasdimension43kand86kfortheplayers and54Mleaves.Intheﬁrstsetofexperimentswelookattheper-iterationperformanceofeachalgorithm.TheresultsareshowninFigure2.They-axisshowsthesumoftheregretsforeachplayer thatis howmuchutilitytheycangainbyplayingabestresponseratherthantheircurrentstrategy.Theunitismilli-big-blinds(mbb);atthebeginningoftheoriginalpokergame Libratus asthe“bigblind” putin$100andtheopponentputin$50 inordertoinducebetting.Mbbisathousandthofthebigblindvalue thatis 10cents.Thisisastandardunitusedinresearchthatusespokergamesforevaluation.Onembbisoftenconsideredtheconvergencegoal.CFR+andEGT/ASperformthebest;bothreachthegoalof1mbbafterabout400iterationsinbothEndgame2and7.EGT CFR(RM) andCFR(RM+)alltakeabout3000iterationstoreach1mbbinEndgame7.InEndgame2 EGTisslowest althoughtheslopeissteeperthanforCFR(RM)andCFR(RM+).WesuspectthatbetterinitializationofEGTcouldleadtoitbeatingbothalgorithms.NotealsothatEGTwasshownbetterthanCFR(RM)andCFR(RM+)byKroeretal.[19]inthesmallergameofLeduchold’emwithanautomatedµ-tuningapproach.Theirresultsfurthersuggestthatbetterinitializationmayhelpenhanceconvergespeedsigniﬁcantly.Oneissuewithper-iterationconvergenceratesisthatthealgorithmsdonotperformthesameamountofworkperiteration.AllCFRvariantsinourexperimentscompute2gradientsperiteration whereasEGTcomputes3 andEGT/AScomputes4(theadditionalgradientcomputationisneededinordertoevaluatetheexcessivegap).Furthermore EGT/ASmayuseadditionalgradientcomputationsiftheexcessivegapcheckfailsandasmallerτistried(inourexperimentsabout15adjustmentswereneeded).Inoursecondsetofplots weshowtheconvergencerateasafunctionofthetotalnumberofgradientcomputationsperformedbythealgorithm.ThisisshowninFigure3.Bythismeasure EGT/ASandEGTperformslightlyworserelativetotheirperformanceasmeasuredbyiterationcount.Inparticular CFR+takesabout800gradientcomputationsinordertoreach1mbbineithergame whereasEGT/AStakesabout1800.InourexperimentsCFR+vastlyoutperformsitstheoreticalconvergencerate(infact everyCFRvariantdoessigniﬁcantlybetterthanthetheorypredicts butCFR+especiallyso).However CFR+isknowntoeventuallyreachapointwhereitslowsdownandperformsworsethan1T.InourexperimentswestarttoseeCFR+slowingdowntowardstheendofEndgame7.EGT incontrast isguaranteedtomaintainarateof1T andsomaybepreferableifaguaranteeagainstslowdownisdesiredorhighprecisionisneeded.8ConclusionsandFutureResearchWeintroducedapracticalvariantoftheEGTalgorithmthatemploysaggressivestepsizes µbalancing anumerically-friendlysmoothed-best-responsealgorithm parallelizationviaCartesianproductoperationsattherootofthestrategytreeplex andaGPUimplementation.Weshowedfortheﬁrsttime viaexperimentsonreallarge-scaleLibratusendgames thatFOMs(withthedilatedentropy810110210310410510−310−210−1100101102103Gradientcomputations(regretsum)[mbb]Endgame2CFR+EGTEGT/ASCFR(RM)CFR(RM+)10110210310410510−310−210−1100101102103Gradientcomputations(regretsum)[mbb]Endgame7CFR+EGTEGT/ASCFR(RM)CFR(RM+)Figure3:Solutionqualityasafunctionofthenumberofgradientcomputationsforallalgorithmsontworiversubgames.Thesolutionqualityisgivenasthesumofregretsfortheplayersinmilli-big-blinds.DGF)arecompetitivewiththeCFRfamilyofalgorithms.Speciﬁcally theyoutperformtheotherCFRvariantsandarecloseinefﬁciencytoCFR+.OurbestvariantofEGTcansolvesubgamestothedesiredaccuracyataspeedthatiswithinafactoroftwoofCFR+.OurresultssuggestthatitmaybepossibletomakeFOMsfasterthanCFR+.Forexample wedidnotspendmuchefforttuningtheparametersofEGT andtuningthemwouldmakethealgorithmevenmoreefﬁcient.Second weonlyinvestigatedEGT whichhasbeenmostpopularFOMinEFGsolving.However itispossiblethatotherFOMssuchasmirrorprox[23]ortheprimal-dualalgorithmbyChambolleandPock[8]couldbemadeevenfaster.Furthermore stochasticFOMs(i.e. oneswherethegradientisapproximatedbysamplingtomakethegradientcomputationdramaticallyfaster)couldbeinvestigatedaswell.Kroeretal.[17]triedthisusingstochasticmirrorprox[14]withoutpracticalsuccess butitislikelythatthisapproachcouldbemadebetterwithmoreengineering.ItwouldalsobeinterestingtocompareourEGTapproachtoCFRalgorithmsforcomputingequi-libriumreﬁnements forexampleintheapproximateextensive-formperfectequilibriummodelinvestigatedbyKroeretal.[18]andFarinaetal.[9].Pruningtechniques(fortemporarilyskippingpartsofthegametreeonsomeiterations)havebeenshowneffectiveforbothCFRandEGT-likealgorithms andcouldpotentiallybeincorporatedaswell[20 6 2].Finally whileEGT aswellasotherFOM-basedapproachestocomputingzero-sumNashequilibria arenotapplicabletothecomputationofgeneral-sumNashequilibriaintheorytheycouldstillbeappliedtothecomputationofstrategiesinpractice(gradientscanstillbecomputed andsothesmoothedbestresponsesandcorrespondingstrategyupdatesarestillwell-deﬁned).ForCFRtheanalogousapproachseemstoperformreasonablywell[7] andyoumightexpectthesamefromFOMssuchasEGT.AcknowledgmentsThismaterialisbasedonworksupportedbytheNationalScienceFoundationundergrantsIIS-1718457 IIS-1617590 andCCF-1733556 andtheAROunderawardW911NF-17-1-0082.ChristianKroerissupportedbyaFacebookFellowship.References[1]M.Bowling N.Burch M.Johanson andO.Tammelin.Heads-uplimithold’empokerissolved.Science 347(6218) Jan.2015.[2]N.BrownandT.Sandholm.Reducedspaceandfasterconvergenceinimperfect-informationgamesviapruning.InInternationalConferenceonMachineLearning(ICML) 2017.[3]N.BrownandT.Sandholm.Safeandnestedsubgamesolvingforimperfect-informationgames.InProceedingsoftheAnnualConferenceonNeuralInformationProcessingSystems(NIPS) pages689–699 2017.[4]N.BrownandT.Sandholm.SuperhumanAIforheads-upno-limitpoker:Libratusbeatstopprofessionals.Science pageeaao1733 Dec.2017.9[5]N.Brown S.Ganzfried andT.Sandholm.Hierarchicalabstraction distributedequilibriumcomputation andpost-processing withapplicationtoachampionno-limitTexasHold’emagent.InInternationalConferenceonAutonomousAgentsandMulti-AgentSystems(AAMAS) 2015.[6]N.Brown C.Kroer andT.Sandholm.Dynamicthresholdingandpruningforregretminimiza-tion.InAAAIConferenceonArtiﬁcialIntelligence(AAAI) 2017.[7]J.ˇCermák B.Bošansk`y andN.Gatti.Strategyeffectivenessofgame-theoreticalsolutionconceptsinextensive-formgeneral-sumgames.InAutonomousAgentsandMulti-AgentSystems pages1813–1814.InternationalFoundationforAutonomousAgentsandMultiagentSystems 2015.[8]A.ChambolleandT.Pock.Aﬁrst-orderprimal-dualalgorithmforconvexproblemswithapplicationstoimaging.JournalofMathematicalImagingandVision 2011.[9]G.Farina C.Kroer andT.Sandholm.Regretminimizationinbehaviorally-constrainedzero-sumgames.InInternationalConferenceonMachineLearning(ICML) 2017.[10]A.GilpinandT.Sandholm.Losslessabstractionofimperfectinformationgames.JournaloftheACM 54(5) 2007.[11]S.Hoda A.Gilpin J.Peña andT.Sandholm.SmoothingtechniquesforcomputingNashequilibriaofsequentialgames.MathematicsofOperationsResearch 35(2) 2010.[12]M.Johanson.Measuringthesizeoflargeno-limitpokergames.Technicalreport UniversityofAlberta 2013.[13]M.Johanson K.Waugh M.Bowling andM.Zinkevich.Acceleratingbestresponsecalculationinlargeextensivegames.InProceedingsoftheInternationalJointConferenceonArtiﬁcialIntelligence(IJCAI) 2011.[14]A.Juditsky A.Nemirovski andC.Tauvel.Solvingvariationalinequalitieswithstochasticmirror-proxalgorithm.StochasticSystems 1(1):17–58 2011.[15]D.KollerandA.Pfeffer.Representationsandsolutionsforgame-theoreticproblems.ArtiﬁcialIntelligence 94(1):167–215 July1997.[16]D.Koller N.Megiddo andB.vonStengel.Efﬁcientcomputationofequilibriaforextensivetwo-persongames.GamesandEconomicBehavior 14(2) 1996.[17]C.Kroer K.Waugh F.Kılınç-Karzan andT.Sandholm.Fasterﬁrst-ordermethodsforextensive-formgamesolving.InProceedingsoftheACMConferenceonEconomicsandComputation(EC) 2015.[18]C.Kroer G.Farina andT.Sandholm.Smoothingmethodforapproximateextensive-formper-fectequilibrium.InProceedingsoftheInternationalJointConferenceonArtiﬁcialIntelligence(IJCAI) 2017.[19]C.Kroer K.Waugh F.Kılınç-Karzan andT.Sandholm.Theoreticalandpracticaladvancesonsmoothingforextensive-formgames.arXivpreprintarXiv:1702.04849 2017.[20]M.Lanctot K.Waugh M.Zinkevich andM.Bowling.MonteCarlosamplingforregretmini-mizationinextensivegames.InProceedingsoftheAnnualConferenceonNeuralInformationProcessingSystems(NIPS) 2009.[21]M.Moravˇcík M.Schmid N.Burch V.Lisý D.Morrill N.Bard T.Davis K.Waugh M.Johanson andM.Bowling.Deepstack:Expert-levelartiﬁcialintelligenceinheads-upno-limitpoker.Science 356(6337) May2017.[22]J.Nash.Equilibriumpointsinn-persongames.ProceedingsoftheNationalAcademyofSciences 36:48–49 1950.10[23]A.Nemirovski.Prox-methodwithrateofconvergenceO(1/t)forvariationalinequalitieswithLipschitzcontinuousmonotoneoperatorsandsmoothconvex-concavesaddlepointproblems.SIAMJournalonOptimization 15(1) 2004.[24]Y.Nesterov.Excessivegaptechniqueinnonsmoothconvexminimization.SIAMJournalofOptimization 16(1) 2005.[25]Y.Nesterov.Smoothminimizationofnon-smoothfunctions.MathematicalProgramming 103 2005.[26]I.Romanovskii.Reductionofagamewithcompletememorytoamatrixgame.SovietMathematics 3 1962.[27]O.Tammelin N.Burch M.Johanson andM.Bowling.Solvingheads-uplimitTexashold’em.InProceedingsofthe24thInternationalJointConferenceonArtiﬁcialIntelligence(IJCAI) 2015.[28]B.vonStengel.Efﬁcientcomputationofbehaviorstrategies.GamesandEconomicBehavior 14(2):220–246 1996.[29]M.Zinkevich M.Bowling M.Johanson andC.Piccione.Regretminimizationingameswithincompleteinformation.InProceedingsoftheAnnualConferenceonNeuralInformationProcessingSystems(NIPS) 2007.11,Raphael Bailly
Xavier Carreras
Ariadna Quattoni
Christian Kroer
Gabriele Farina
Tuomas Sandholm