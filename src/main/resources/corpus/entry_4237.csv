2018,Parsimonious Quantile Regression of Financial Asset Tail Dynamics via Sequential Learning,We propose a parsimonious quantile regression framework to learn the dynamic tail behaviors of financial asset returns. Our model captures well both the time-varying characteristic and the asymmetrical heavy-tail property of financial time series. It combines the merits of a popular sequential neural network model  i.e.  LSTM  with a novel parametric quantile function that we construct to represent the conditional distribution of asset returns. Our model also captures individually the serial dependences of higher moments  rather than just the volatility. Across a wide range of asset classes  the out-of-sample forecasts of conditional quantiles or VaR of our model outperform the GARCH family. Further  the proposed approach does not suffer from the issue of quantile crossing  nor does it expose to the ill-posedness comparing to the parametric probability density function approach.,Parsimonious Quantile Regression of Financial Asset

Tail Dynamics via Sequential Learning

Xing Yan3

Weizhong Zhang1

Lin Ma1

Wei Liu1

Qi Wu2 ∗

1Tencent AI Lab

2School of Data Science  City University of Hong Kong

3Department of SEEM  The Chinese University of Hong Kong

xyan@se.cuhk.edu.hk {zhangweizhongzju forest.linma}@gmail.com

wl2223@columbia.edu qiwu55@cityu.edu.hk

Abstract

We propose a parsimonious quantile regression framework to learn the dynamic
tail behaviors of ﬁnancial asset returns. Our model captures well both the time-
varying characteristic and the asymmetrical heavy-tail property of ﬁnancial time
series. It combines the merits of a popular sequential neural network model  i.e. 
LSTM  with a novel parametric quantile function that we construct to represent the
conditional distribution of asset returns. Our model also captures individually the
serial dependences of higher moments  rather than just the volatility. Across a wide
range of asset classes  the out-of-sample forecasts of conditional quantiles or VaR
of our model outperform the GARCH family. Further  the proposed approach does
not suffer from the issue of quantile crossing  nor does it expose to the ill-posedness
comparing to the parametric probability density function approach.

1

Introduction

In general  machine learning models aim to predict one single value of output variable y given input
x  usually to estimate the conditional mean E[y|x]. In many situations  we are also interested in the
characteristics of the conditional distribution p(y|x). A typical domain needing the learning of these
characteristics is ﬁnancial returns. Data from ﬁnancial markets is highly stochastic or noisy. It is
impossible to accurately predict future ﬁnancial returns. What we can predict and what we really care
about are their conditional distributional characteristics like volatility  heavy tails  and Value-at-Risk 
which are all widely used measures of risks. The huge and increasing demands for risk management
and for understanding market behaviors make it extremely important to predict these characteristics.
In the scope of discrete-time econometric models  the benchmark of forecasting conditional distri-
bution of time-t asset return rt conditional on past return history is the Generalized Autoregressive
Conditional Heteroskedasticity (GARCH) model as well as its variants. First appearing in [9] and
[2] to model time-varying volatility  GARCH-type models have now become a big family  including
popular variants like EGARCH [24]  GJR-GARCH [16]  TGARCH [32]  etc. They all describe the
distribution p(rt|rt−1  rt−2  . . . ) by making strong assumptions on the probability density function
of it  e.g.  assuming it is Gaussian  and let the distribution parameters depend on past information.
Usually  t-distribution is assumed to model heavy tails. Quantile regression [19][20] is another
type of method to forecast the conditional distributional characteristics. It predicts the quantiles of
p(y|x) without making any distributional assumption. In this paper  we model and predict conditional
quantiles and heavy tails of ﬁnancial return series in a parsimonious quantile regression framework
that describes the distribution p(rt|rt−1  rt−2  . . . ) in a parametric quantile function way.

∗Corresponding author.

32nd Conference on Neural Information Processing Systems (NeurIPS 2018)  Montréal  Canada.

It is known that ﬁnancial asset returns are heavy-tail distributed  both conditionally and uncondition-
ally [7]. This has important consequences for both the pricing of assets and the management of their
risks [15]. More importantly  their tail behaviors are not only asymmetrical but also time-varying.
In GARCH family  t-distribution is heavy-tailed but symmetric  and more critically  the degrees of
freedom which control the tail heaviness cannot vary with time. Previous studies [17][22][1][25]
modelled time-varying conditional skewness and kurtosis in an autoregressive way  like volatility
modelling in GARCH. However  they all assumed complicated probability density functions  some
of which even have no analytical forms  which make model estimation difﬁcult. Besides  models that
allow the data to speak for itself rather than being restricted to linear auto-regressiveness are needed.
In this paper  we approach the problem by parameterizing the conditional quantile function of asset
returns  instead of assuming they are drawn from a given probability density function  hence suffering
from tractability and ill-posedness. Apart from probability density function  quantiles are another
representation of the asymmetry and tailedness of a distribution. If one can model and estimate
conditional quantiles for a ﬁne set of probability levels  it achieves almost the same effect as modelling
conditional mean  volatility  skewness  and kurtosis simultaneously. Quantile regression has the
potential to undertake this interesting task  but the traditional version suffers from some issues. One
is the lack of monotonicity in the estimated quantiles  also known as quantile crossing  despite some
imperfect solutions proposed in [27] and [5]. Other issues include an increasing number of parameters
when estimating more quantiles  and the lack of interpretability. Recently  some works deal with the
large-scale [31] and high-dimensional [26] situations of quantile regression.
In this paper  we propose a parametric heavy-tailed quantile function (HTQF) to model a distribution
with asymmetric left and right heavy tails. The Q-Q plot of the proposed HTQF against the standard
normal distribution is of an inverted S shape  and the degrees of the tail heaviness are controlled
by two parameters in a ﬂexible way. Our HTQF overcomes the disadvantages of the probability
density function approach in GARCH-type models when modelling asymmetric heavy tails. For
ﬁnancial asset returns  we let the quantile function of p(rt|rt−1  rt−2  . . . ) be an HTQF and let the
parameters of it be time-varying and depend on past information through a Long Short-term Memory
(LSTM) unit [18]  which is a popular sequential neural network model and has been applied to many
practical problems like video understanding [11][29][30]  video prediction [4]  and video retrieval
[12]. Parameters of the LSTM can be learned in a quantile regression framework with multiple
probability levels. After training  the conditional quantiles of rt and the interpretable parameters of
HTQF representing tail heaviness can be estimated.
Our model has signiﬁcant advantages over GARCH-type models and traditional quantile regression.
To summarize  our contributions are: (1) We propose a novel parametric quantile function to represent
a distribution with asymmetric heavy tails  and leverage it to model the conditional distribution of
ﬁnancial return series. (2) In the quantile regression framework  coupled with an LSTM unit  our
method can learn the time-varying tail behaviors successfully and predict conditional quantiles more
accurately  as veriﬁed by our experiments. (3) We overcome the disadvantages of traditional quantile
regression  including the quantile crossing  the increasing number of parameters when estimating
more quantiles  and the lack of interpretability.

2 GARCH-type Models
For a univariate ﬁnancial return series {rt}  GARCH model was ﬁrst proposed in [9] and [2] to model
its time-varying volatility or volatility clustering. By making a prior assumption on the conditional
distribution of the residual εt = rt − µt (µt is the conditional mean of rt)  letting it be normal
N (0  σ2
t )  the time-t volatility σt is modelled to depend on past residuals εt−1  . . .   εt−q and past
volatilities σt−1  . . .   σt−p. Formally  GARCH(p  q) is speciﬁed as follows:

εt|ψt−1 ∼ N (0  σ2
t ) 
t−q + β1σ2

t−1 + ··· + βpσ2

(1)

rt = µt + εt 

t−1 + ··· + αqε2

σ2
t = ω + α1ε2

(2)
where ψt−1 denotes the past information set. The parameters ω  αi  βj can be estimated with
maximum likelihood method. Because of its success in modelling and forecasting conditional
volatility  a lot of extensions and variants had been proposed such as EGARCH [24]  GJR-GARCH
[16]  TGARCH [32]  etc. Most of them made reasonable and interpretable changes to Equation (2)
and achieved better performances.

t−p 

2

Alternatives can also be made in Equation (1). A better choice of the distribution assumption is
Student’s t-distribution: εt = σtzt  zt|ψt−1 ∼ t(ν)  where ν is the degrees of freedom. t-distribution
has symmetric heavy tails at the left and right sides. We denote GARCH-type models with the
t-distribution assumption by GARCH-t  EGARCH-t  etc. Besides  one can also choose different
ways to model the conditional mean µt  e.g.  to use GARCH-type models alone  it can be set to a
constant µt = µ. One can also adopt the linear autoregressive way: µt = γ0 + γ1rt−1 +··· + γsrt−s.
We denote GARCH-type models with this linear autoregressive speciﬁcation of conditional mean and
with the t-distribution assumption by AR-GARCH-t  AR-EGARCH-t  etc.
Although GARCH-type models were initially designed to model and forecast conditional volatility 
they can naturally be used to predict conditional quantiles because they fully describe the conditional
distribution. Actually they are widely employed in ﬁnance to predict Value-at-Risk (VaR)  which are
the left-tail side quantiles  e.g.  0.01 or 0.05-quantile  representing downside risk of asset prices.
Another big family of models that have similarities with GARCH-type models are stochastic volatility
(SV) models. Some comparisons between GARCH-type and SV models were made in [28][13][3][14].
SV models are applied in situations when volatility contains independent risk driver. In continuous
time  if driven by Brownian Motion  they are Markovian  which is essentially different from GARCH
family and our proposed model and may not be suitable for modelling serial dependence of volatility.
What are comparable with GARCH-type and our models and are consistent with the focus of this
paper  are long-memory volatility models driven by  e.g.  fractional Brownian Motion or Hawkes
process  and preferably in discrete time. CAViaR [10] is another similar model for estimating
conditional quantiles inspired by GARCH. It models conditional quantiles separately for different
probability levels instead of making assumptions on the full conditional distribution. So it is somewhat
difﬁcult to estimate the conditional moments  also different from GARCH-type and our models.

3 Traditional Quantile Regression

Quantiles are important characteristics of a distribution. For a continuous distribution density p(y) 
for a given probability level τ ∈ (0  1)  e.g.  τ = 0.1 or 0.9  the τ-quantile q of p(y) is deﬁned as
q = F −1(τ ) where F (y) is the cumulative distribution function of p(y). Quantile regression [19][20]
aims to estimate the τ-quantile q of the conditional distribution p(y|x). To do this  without making
any assumption on p(y|x)  a parametric function q = fθ(x) is chosen  for example  a linear one
q = w(cid:62)x + b. Note that q is an unobservable quantity  a specially designed loss function (named
pinball loss in this paper) between y and q makes the estimation feasible in quantile regression:

Lτ (y  q) =

τ|y − q|
(1 − τ )|y − q|

y > q
y ≤ q

.

(3)

Then we minimize the expected loss in a traditional regression way to get the estimated parameter ˆθ:
(4)

E[Lτ (y  fθ(x))].

min

Given a dataset {xi  yi}N
i=1 Lτ (yi  fθ(xi)) is minimized instead.
When we want to estimate multiple conditional quantiles q1  q2  . . .   qK for different probability
levels τ1 < τ2 < ··· < τK  K different parametric functions qk = fθk (x) are chosen and the losses
are summed up to be minimized simultaneously:

i=1  the empirical average loss 1
N

(cid:80)N

(cid:26)

θ

K(cid:88)

N(cid:88)

k=1

i=1

min

θ1 ... θK

1
K

1
N

Lτk (yi  fθk (xi)).

(5)

However  this combination may lead to an embarrassing issue called quantile crossing  i.e.  for
some x and τj < τk  it is possible that fθj (x) > fθk (x) which contradicts the probability theory.
It occurs because θj and θk are in fact independently estimated in the optimization. To overcome
this  additional constraints on the monotonicity of the quantiles can be added to the optimization to
ensure non-crossing [27]. Another simpler solution is post-processing  i.e.  sorting or rearranging
the original estimated quantiles to be monotone [5]. Another two shortcomings of this traditional
quantile regession include an increasing number of parameters when estimating quantiles for a larger
set of τ  i.e.  K is larger. For a more elaborate description of a distribution  large K is necessary in
some cases. The other shortcoming is that the explicit mapping from x to the conditional quantile has
no interpretability  making it difﬁcult to combine domain knowledge.

3

(a)

(b)

(c)

Figure 1: Q-Q plots against N (0  1): (a) t(2); (b) HTQF with u = 1.0 and v = 0.1; (c) HTQF with
u = 0.6 and v = 1.2. For all three distributions  µ = 1 and σ = 1.5. For HTQF  A = 4.

4 Our Model

We ﬁrst describe the proposed parametric quantile function  then show how it is used to model the
conditional distribution p(rt|rt−1  rt−2  . . . ) of ﬁnancial return series and how the dependence on
past information is modelled. Our proposed model is completed in a quantile regression framework.

4.1 Heavy-tailed Quantile Function

There are three common ways to fully express a continuous distribution  through probability density
function (PDF)  cumulative distribution function (CDF)  or quantile function. In ﬁnancial data
modelling  much attention is paid to how to choose an appropriate parametric PDF that is consistent
with the empirical facts of ﬁnancial returns  like heavy tails. In our model  we design a parametric
quantile function that allows varying tails and is intuitively easy to be understood.
Our idea starts from the Q-Q plot  which is a popular method to determine whether a set of observa-
tions follows a normal distribution or not. The theory behind this is quite simple: the τ-quantile of
a normal distribution N (µ  σ2) is µ + σZτ   where Zτ is the τ-quantile of the standard normal one.
When τ takes different values in (0  1)  their Q-Q plot forms a straight line. If the Q-Q plot yields an
inverted S shape  it indicates that the corresponding distribution is heavy-tailed (see Figure 1 (a) for
an example of the Q-Q plot of t-distribution with 2 degrees of freedom against N (0  1)).
We construct a parsimonious parametric quantile function  as a function of Zτ   to let it have a
controllable shape in the Q-Q plot against the standard normal distribution. Speciﬁcally  the up tail
and down tail of the inverted S shape in the Q-Q plot are controlled by two parameters respectively.
Our proposed heavy-tailed quantile function (HTQF) has the following form:

Q(τ|µ  σ  u  v) = µ + σZτ

+ 1

(6)

(cid:18) euZτ

A

(cid:19)(cid:18) e−vZτ

(cid:19)

+ 1

 

A

where µ  σ are location and scale parameters respectively  A is a relatively large positive constant.
u > 0 controls the up tail of the inverted S shape  i.e.  the right tail of the corresponding distribution.
v > 0 controls the down tail  i.e.  the left tail of the corresponding distribution. The larger u or v  the
heavier the tail. When u = v = 0  the HTQF becomes the quantile function of a normal distribution.
To understand these  note that in Equation (6)  Zτ is ﬁrst multiplied by two factors fu(Zτ ) =
euZτ /A + 1 and fv(Zτ ) = e−vZτ /A + 1  then multiplied by σ and added by µ (for simplicity one
can set µ = 0 and σ = 1). The factor fu is a monotonically increasing and convex function of Zτ  
and satisﬁes fu → 1 as Zτ → −∞. So Zτ fu(Zτ ) will exhibit the up tail of the inverted S only. The
same analysis applies to the factor fv too. Thus  Zτ fu(Zτ )fv(Zτ ) exhibits the whole inverted S of
the Q-Q plot. The roles of A are to let fu(0) and fv(0) be close to 1  and to ensure the HTQF is
monotonically increasing with Zτ . Figure 1 (b) and (c) show the Q-Q plots of HTQF with different
values of u and v against N (0  1). They exhibit different degrees of tailedness and the tails can
ﬂexibly change according to u and v. In addition  for an HTQF with ﬁxed values of its parameters 
there exists a unique probability distribution associated with it because the inverse function of it exists
and is a CDF. Please refer to the proof in the supplementary material.

4

2021050510202105051020210505104.2 Quantile Regression with HTQF
For the distribution p(rt|rt−1  rt−2  . . . )  different from GARCH-type models  we do not make
assumptions on the PDF of it. Instead  we assume its quantile function being an HTQF  denoted by
Q(τ|µt  σt  ut  vt)  where µt  σt  ut  vt are time-varying parameters representing the location  scale 
and heavy tails of the corresponding distribution. Hence  the conditional τk-quantile of rt can be
easily obtained by putting τk into the function: qt
Obviously  the parameters µt  σt  ut  vt should depend on past series rt−1  rt−2  . . . . To model that 
we select a subsequence of ﬁxed length from rt−1  rt−2  . . . to construct a feature vector sequence 
and apply an LSTM unit on it. LSTM [18] is a popular and powerful sequential neural network model
in machine learning  so it is a natural choice in our method (see the supplementary material for a brief
introduction and [23] for a comprehensive review of LSTM). In detail  a ﬁxed length L is chosen 
and then a feature vector sequence of length L is constructed from rt−1  . . .   rt−L:

k = Q(τk|µt  σt  ut  vt)  k = 1  . . .   K.



rt−L

(rt−L − ¯rt)2
(rt−L − ¯rt)3
(rt−L − ¯rt)4

   . . .  



  

rt−1

(rt−1 − ¯rt)2
(rt−1 − ¯rt)3
(rt−1 − ¯rt)4

(7)

xt
1  . . .   xt

L =

(cid:80)L

K(cid:88)

T(cid:88)

k=1

t=L+1

where ¯rt = 1
i=1 rt−i. The intuition behind this construction is straightforward  which is to
L
extract information contained in raw quantities associated with the ﬁrst  second  third  and fourth
central moments of past L samples. After this construction  we model the four HTQF parameters
µt  σt  ut  vt as the output of an LSTM unit when feeding input xt

[µt  σt  ut  vt](cid:62) = tanh(W oht + bo) 

(8)
where Θ is the LSTM parameters  ht is the last hidden state. W o  bo are the output layer parameters.
At last  for multiple probability levels 0 < τ1 < τ2 < ··· < τK < 1  the pinball losses between rt
k = Q(τk|µt  σt  ut  vt) are summed up to be minimized together  like
and its conditional quantiles qt
in traditional quantile regression:

L) 

L:
1  . . .   xt
ht = LSTMΘ(xt
1  . . .   xt

min

Θ W o bo

1
K

1

T − L

Lτk (rt  Q(τk|µt  σt  ut  vt)) .

(9)

Combine Equation (6)(7)(8)(9) to complete our proposed quantile regression model using LSTM and
HTQF  denoted by LSTM-HTQF. After training  for new subsequent series {rt(cid:48)}  the time-varying
parameters µt(cid:48)  σt(cid:48)  ut(cid:48)  vt(cid:48) of HTQF can be calculated directly with the learned model parameters
ˆΘ  ˆW o  ˆbo. Among them  {ut(cid:48)} and {vt(cid:48)} can represent how the tails behave temporally. In addition 
conditional quantiles qt(cid:48)
k can be predicted and the summed loss in Equation (9) is evaluated again for
testing the performance on the new subsequent series  since no ground truth of quantiles are available.

4.3 Discussions

The advantages of our model over GARCH-type models are obvious. The proposed HTQF is more
intuitive and ﬂexible to model asymmetric heavy tails than the PDFs in GARCH-type models  like
the skewed generalized t-distribution in [1]. To have varying tails  one PDF must be in complicated
analytical form that will make model estimation difﬁcult. Even for the simplest one  the t-distribution 
the analytical complexity of its PDF makes model estimation unfeasible if one assumes time-varying
degrees of freedom  while our HTQF parameters can be easily set to be time-varying in the quantile
regression framework. Besides  the LSTM can help to learn nonlinear dependence on past information
while the linear auto-regressiveness in GARCH-type models cannot. We quantitatively compare our
model to several classical GARCH-type models in the experiments.
Comparing to traditional quantile regression  our model overcomes the three shortcomings mentioned
in Section 3. First  it is not hard to prove that the HTQF is a monotonically increasing function with
Zτ   and also with τ  so quantile crossing will never happen. Then  no matter how large K is  i.e.  a lot
of quantiles need to be estimated  we only need HTQF’s four parameters µt  σt  ut  vt to determine
all of them. That is a big saving in the number of parameters. At last  our model is interpretable  and
combines domain knowledge in ﬁnance. For quantitative evaluation  we implement the traditional
quantile regression in our experiments  also coupled with an LSTM unit. Mathematically describing it 

5

(cid:80)K

(cid:80)T

1

T−L

k=1

1  xt

k: [qt

1  . . .   qt

2  . . .   xt

t=L+1 Lτk (rt  qt
1   . . .   qt(cid:48)

K](cid:62) = tanh(W oht +
k) is minimized as in Equation (9). For
K of rt(cid:48) are sorted to ensure no crossing.

in Equation (8)  the output µt  σt  ut  vt are replaced by quantiles qt
bo) and the summed loss 1
K
new subsequent time t(cid:48)  the predicted quantiles qt(cid:48)
We denote this model by LSTM-TQR.
Generally  feature vector sequence xt
L should be designed to contain any information
that is related to the conditional distribution of rt or is helpful to the prediction  like trading volume 
related assets  or fundamentals. To keep consistency with GARCH family and ensure the fairness of
the comparisons in experiments  we construct xt
L only from past returns rt−1  rt−2  . . . .
In real applications of our method  more information can be included in the feature vector sequence.
Our method is widely applicable in quantile prediction or time series modelling in many other non-
ﬁnancial ﬁelds. Time series data exhibiting asymmetrical time-varying tail behavior and nonlinear
serial dependence of conditional distribution  e.g.  hydrologic data  internet trafﬁc data  and electricity
price and demand  is most suited. One can also change the standard normal distribution in the Q-Q
plot (Zτ in HTQF in Equation (6)) to other baseline distribution  to let the HTQF have a controllable
shape in the Q-Q plot against the speciﬁed distribution  like exponential one or lognormal one  the
choice of which relies on domain knowledge.

1  xt

2  . . .   xt

5 Experiments

Our experiments are conducted on three types of time series datasets: simulated data  daily asset
returns (of stock indexes  exchange rates  and treasury yields)  and intraday 5-minute commodity
futures returns. For daily returns  for every time series  the data of maximum possible length is used 
e.g.  S&P 500 index returns start from January 4  1950 and end at July 2  2018  which is the longest
series with more than 17 000 observations. The shortest has nearly 8000 observations. For intraday
commodity futures returns  the recent 1-year every 5-minute returns are used and each series has
about 20 000 observations. All returns are calculated by rt = Pt/Pt−1 − 1 where Pt is the price 
rate  or yield at time t.
Each time series is divided into three successive parts  for training  validation  and testing respectively.
The training set is four ﬁfths of the original series  and the validation and test sets are both one
tenth. The training set is normalized to have sample mean 0 and sample variance 1  followed by
normalizing the validation and test sets in the exactly same way. The validation set is used for tuning
hyper-parameters  and for stopping training when the loss on the validation set begins to increase  to
prevent overﬁtting. Our model has two hyper-parameters  the length L of past series rt−1  . . .   rt−L
on which time-t HTQF parameters µt  σt  ut  vt depend  and the hidden state dimension H of the
LSTM unit. We denote our model with them by LSTM-HTQF(L H). Similarly  the LSTM-TQR
model described in Section 4.3 also has L and H as hyper-parameters. Our competing models are
mainly GARCH-type models  from which we select some popular ones for comparisons: GARCH 
GARCH-t  EGARCH-t  GJR-GARCH-t  AR-EGARCH-t  and AR-GJR-GARCH-t. In all of them 
s  p  q are hyper-parameters that will be tuned (see Section 2 for details).
The tuning of the hyper-parameters is done in the following sets: L ∈ {40  60  80  100}  H ∈ {8  16} 
and s  p  q ∈ {1  2  3}. The A in the HTQF is set to be 4 arbitrarily. We choose K = 21 probability
levels into the τ set: [τ1  . . .   τ21] = [0.01  0.05  0.1  . . .   0.9  0.95  0.99]. Performance is evaluated
using the pinball loss on the test set. GARCH-type models can easily do this because the conditional
PDF is modelled. For comparisons from different perspectives  two test performances over two
different τ sets are evaluated: one is the full τ set  the other is [0.01  0.05  0.1]  the quantiles of which
are VaR representing downside risk.

5.1 Simulated Data

The purpose of the simulation experiment is to verify whether our method can learn the true temporal
behavior of the conditional distribution of a given time series. We generate our simulated time series
in a way similar to GARCH-t model  but differently  let the degrees of freedom νt be time-varying.
Speciﬁcally  starting from r0 = 0 and σ0 = 1  the time series {rt} together with the scale parameter
{σt} and tail parameter {νt} are generated as follows:

νt = max{8 − 2πt  3} 

πt =

0.136 + 0.257r2

t−1 + 0.717π2

t−1 

(10)

(cid:113)

6

(a)

(b)

Figure 2: Comparisons between true parameters {σt} {νt} (black lines) and the learned HTQF
parameters {ˆσt} {ˆut} (red lines). Upper part of (a): {σt} v.s. {ˆσt} on the training set; lower part of
(a): {σt} v.s. {ˆσt} on the test set; upper part of (b): {νt} v.s. {ˆut} on the training set; lower part of
(b): {νt} v.s. {ˆut} on the test set. Linear transformations are made before plotting.

(cid:113)

t−1 + 0.575σ2

t−1 

rt = σtzt 

σt =

0.293 + 0.161r2

zt is sampled from t(νt).

(11)
Totally 10 000 data points are generated. Some example pieces of the generated {σt} and {νt} are
shown in Figure 2  where the left two black lines are {σt} and the right two black ones are {νt}.
The upper two are from training set  while the lower two are from test set. The red lines are HTQF
parameters {ˆσt} and {ˆut} learned by our method LSTM-HTQF(20 8) (20 and 8 are set arbitrarily
without tuning). {σt} and {ˆσt} are plotted together  and {νt} and {ˆut} are plotted together. We make
linear transformations to the raw quantities to let them be in similar ranges  to be plotted together.
One can see that the learned HTQF scale and tail parameters {ˆσt} {ˆut} are highly linearly correlated
to the true parameters {σt} {νt}  on both the training set and the test set. It means that our method
has successfully learned the temporal behavior of the conditional distribution of rt. In fact  the linear
correlation coefﬁcients between the two lines in the four subplots are 0.8751  -0.8974  0.9548  and
-0.8808 respectively. Negative signs are due to the fact that the heavier the tail  the bigger ˆut but
the smaller νt. After running linear regressions between them  we obtain R-squared values: 0.7658 
0.8054  0.9116  and 0.7758. Another learned parameter {ˆvt} is similar to {ˆut}  and is not shown
here  because the t-distribution used for generating the data is symmetric.

5.2 Real-world Market Data

In this experiment  ﬁrst  world’s representative stock indexes  exchange rates  and treasury yields are
selected  including S&P 500  NASDAQ 100  HSI  Nikkei 225  DAX  FTSE 100  exchange rate of
USD to EUR/GBP/CHF/JPY/AUD  and U.S. treasury yield of 2/10/30 years. We report the pinball
losses of every methods on the test sets of every asset return series  as shown in Table 1. In parts (a)
and (c) of Table 1  the losses over the full τ set are reported  while in parts (b) and (d) the losses over
only [0.01  0.05  0.1] (the quantiles of which are VaR) are reported. It is clearly shown that on most
assets our LSTM-HTQF outperforms the competitors. Moreover  in parts (b) and (d)  the performance
improvements are more signiﬁcant than in (a) and (c)  which is consistent with the intuition that
the tails are better modelled by our method. Note that the pinball loss is such a measure between
observation and quantile that  even for ground truth quantile  the loss is not zero and is bounded by a
positive number. So a small decrease in the loss may actually be a substantial improvement. We also
conduct the Kupiec’s unconditional coverage test [21]  the Christoffersen’s independence test [6]  and
the mixed conditional coverage test for backtesting the VaR forecasts of various models  and show
the results in the supplementary material (see [8] for a description of details of these statistical tests).
To investigate the tail dynamics captured by the LSTM-HTQF model  we plot the HTQF parameters
{ˆut} and {ˆvt} on the S&P 500 test set in Figure 3 (a)  where the blue line is the right tail parameter

7

Table 1: The pinball losses on the test sets of daily data of stock indexes  exchange rates  and treasury
yields. The losses are evaluated over two different τ sets: (a)(c) [0.01  0.05  0.1  . . .   0.9  0.95  0.99];
(b)(d) [0.01  0.05  0.1]. USnY represents the U.S. treasury yield of n years.

Method\Stock Index
GARCH
GARCH-t
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-GARCH-t
LSTM-TQR
LSTM-HTQF

Method\Stock Index
GARCH
GARCH-t
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-GARCH-t
LSTM-TQR
LSTM-HTQF

(a)
S&P 500 NASDAQ 100
0.2316
0.2314
0.2308
0.2314
0.2304
0.2310
0.2325
0.2299

0.1406
0.1396
0.1395
0.1396
0.1391
0.1393
0.1380
0.1387

(b)
S&P 500 NASDAQ 100
0.1039
0.1048
0.1037
0.1048
0.1041
0.1052
0.1032
0.1025

0.0669
0.0667
0.0668
0.0667
0.0666
0.0666
0.0644
0.0646

HSI
0.1623
0.1612
0.1611
0.1612
0.1611
0.1612
0.1601
0.1598

HSI
0.0729
0.0719
0.0717
0.0719
0.0715
0.0717
0.0709
0.0702

Nikkei 225

0.2868
0.2855
0.2851
0.2855
0.2847
0.2852
0.2822
0.2854

Nikkei 225

0.1339
0.1330
0.1324
0.1330
0.1327
0.1333
0.1284
0.1289

DAX
0.1968
0.1961
0.1957
0.1961
0.1952
0.1963
0.1938
0.1932

DAX
0.0853
0.0850
0.0840
0.0850
0.0834
0.0854
0.0812
0.0810

FTSE 100

0.1987
0.1987
0.1983
0.1987
0.1982
0.1981
0.1961
0.1959

FTSE 100

0.0855
0.0861
0.0854
0.0861
0.0856
0.0852
0.0830
0.0827

Method\Asset
GARCH
GARCH-t
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-t
LSTM-TQR
LSTM-HTQF

Method\Asset
GARCH
GARCH-t
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-t
LSTM-TQR
LSTM-HTQF

(c)

USDEUR USDGBP USDCHF USDJPY USDAUD US2Y US10Y US30Y
0.2952
0.2260
0.2948
0.2258
0.2940
0.2258
0.2948
0.2258
0.2258
0.2941
0.2947
0.2259
0.2943
0.2250
0.2247
0.2937

0.2861
0.1935
0.2858
0.1931
0.2855
0.1923
0.1931
0.2858
0.1916 0.2854
0.2857
0.1924
0.2872
0.1928
0.2849
0.1925

0.2329
0.2338
0.2370
0.2338
0.2367
0.2346
0.2318
0.2322

0.2361
0.2366
0.2352
0.2366
0.2353
0.2367
0.2350
0.2351

0.2222
0.2206
0.2202
0.2206
0.2199
0.2203
0.2195
0.2193

0.2025
0.2009
0.2032
0.2009
0.2007
0.2005
0.1966
0.1966

(d)

USDEUR USDGBP USDCHF USDJPY USDAUD US2Y US10Y US30Y
0.1232
0.0942
0.1236
0.0941
0.1223
0.0938
0.0941
0.1236
0.1224
0.0938
0.1226
0.0941
0.0923
0.1231
0.0930
0.1224

0.1232
0.0902
0.1229
0.0876
0.1218
0.0879
0.1229
0.0876
0.1218
0.0877
0.1229
0.0875
0.0879
0.1231
0.0869 0.1199

0.0996
0.0978
0.0975
0.0978
0.0976
0.0980
0.0965
0.0958

0.1041
0.1026
0.1054
0.1026
0.1026
0.1026
0.0975
0.0971

0.0913
0.0923
0.1062
0.0923
0.1053
0.0916
0.0899
0.0897

0.0965
0.0984
0.0959
0.0984
0.0960
0.0982
0.0948
0.0946

{ˆut} and the red one is the left {ˆvt}. We can see roughly similar patterns in the two lines  both with
clustering and spikes  but different in details.
At last  we collect intraday 5-minute returns of ﬁve commodity futures from Chinese futures market:
steel rebar  natural rubber  soybean  cotton  and sugar. To reduce the difﬁculty  the overnight jumps
are eliminated. In the same way as daily asset returns  the losses on the test sets are reported in
Table 2  which also shows that our LSTM-HTQF outperforms the competitors on most assets. The
plotting of {ˆut} and {ˆvt} on the steel rebar test set is shown in Figure 3 (b)  which indicates that
high-frequency ﬁnancial asset returns also have time-varying heavy tails. The different tail dynamic
with S&P 500 may attribute to the different time scales of the two time series.

6 Conclusions

In summary  in this paper  we proposed a parametric HTQF to represent the asymmetric heavy-tailed
conditional distribution of ﬁnancial return series. The dependence of HTQF’s parameters on past

8

(a)

(b)

Figure 3: The HTQF parameters {ˆut} and {ˆvt} on the test set of: (a) S&P 500 daily data; (b) steel
rebar 5-minute data. The blue line is {ˆut} and the red one is {ˆvt}.

Table 2: The pinball losses on the test sets of 5-minute return data of commodity futures. The losses
are evaluated over two different τ sets: (a) [0.01  0.05  0.1  . . .   0.9  0.95  0.99]; (b) [0.01  0.05  0.1].

Steel Rebar Natural Rubber

Steel Rebar Natural Rubber

Method\Commodity
GARCH
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-GARCH-t
LSTM-TQR
LSTM-HTQF

Method\Commodity
GARCH
EGARCH-t
GJR-GARCH-t
AR-EGARCH-t
AR-GJR-GARCH-t
LSTM-TQR
LSTM-HTQF

0.1770
0.1643
0.1648
0.1646
0.1652
0.1644
0.1639

0.0882
0.0797
0.0801
0.0805
0.0807
0.0769
0.0767

(a)

0.1701
0.1564
0.1576
0.1572
0.1586
0.1543
0.1548
(b)

0.0885
0.0797
0.0807
0.0810
0.0825
0.0765
0.0770

Soybean
0.2424
0.2392
0.2393
0.2391
0.2391
0.2389
0.2385

Soybean
0.1077
0.1062
0.1059
0.1063
0.1060
0.1059
0.1065

Cotton
0.1621
0.1524
0.1526
0.1522
0.1524
0.1504
0.1501

Cotton
0.0783
0.0720
0.0721
0.0719
0.0721
0.0710
0.0704

Sugar
0.1958
0.1859
0.1859
0.1857
0.1857
0.1844
0.1842

Sugar
0.0994
0.0935
0.0935
0.0937
0.0937
0.0922
0.0916

information is modelled by an LSTM unit. The pinball loss between the observation and conditional
quantiles makes the learning of LSTM parameters be in a quantile regression framework  which
overcomes the disadvantages of traditional quantile regression. After learning  conditional quantiles
or VaR can be predicted with relatively better accuracy  and besides  the plotting of HTQF parameters
shows us the dynamic tail behaviors of ﬁnancial asset returns  some of which display clustering and
spikes but difference between left and right tails.
Although our paper focuses on the tail dynamics  in the future  more advanced models that can learn
more elaborate dynamics of the conditional distribution of ﬁnancial time series are necessary  e.g. 
improving the ﬂexibility of the HTQF or modifying the way how LSTM is used may be needed.
Moreover  it is important to discover how LSTM and HTQF in our model work respectively and
how they contribute to the performance improvements. It is also interesting to interpret what tail
dynamics of ﬁnancial assets we have captured  and what consequences it has for understanding
market behaviors  for asset pricing  and for risk management. To make those clear  we may need
more in-depth analysis of our model and more statistical testing and analysis of the VaR or quantile
forecasts of the model in the future.

Acknowledgement

Qi WU acknowledges the ﬁnancial support from the Hong Kong Research Grants Council  in
particular the Early Career Scheme 24200514 and the General Research Funds 14211316 and
14206117.

9

0.40.20.00.20.40.60.81.00.40.60.81.01.21.41.61.80.40.20.00.20.40.60.81.01.20.60.81.01.21.41.61.82.0References
[1] Turan G Bali  Hengyong Mo  and Yi Tang. The role of autoregressive conditional skewness and
kurtosis in the estimation of conditional var. Journal of Banking & Finance  32(2):269–282 
2008.

[2] Tim Bollerslev. Generalized autoregressive conditional heteroskedasticity. Journal of econo-

metrics  31(3):307–327  1986.

[3] M Angeles Carnero  Daniel Peña  and Esther Ruiz. Persistence and kurtosis in garch and

stochastic volatility models. Journal of Financial Econometrics  2(2):319–342  2004.

[4] Xinpeng Chen  Jingyuan Chen  Lin Ma  Jian Yao  Wei Liu  Jiebo Luo  and Tong Zhang. Fine-
grained video attractiveness prediction using multimodal deep learning on a large real-world
dataset. In Companion of the The Web Conference 2018 on The Web Conference 2018  pages
671–678. International World Wide Web Conferences Steering Committee  2018.

[5] Victor Chernozhukov  Iván Fernández-Val  and Alfred Galichon. Quantile and probability

curves without crossing. Econometrica  78(3):1093–1125  2010.

[6] Peter F Christoffersen. Evaluating interval forecasts. International economic review  pages

841–862  1998.

[7] Rama Cont. Empirical properties of asset returns: stylized facts and statistical issues. Quantita-

tive Finance  1(2):223–236  2001.

[8] Alexandra Dias. Market capitalization and value-at-risk. Journal of Banking & Finance 

37(12):5248–5260  2013.

[9] Robert F Engle. Autoregressive conditional heteroscedasticity with estimates of the variance of
united kingdom inﬂation. Econometrica: Journal of the Econometric Society  pages 987–1007 
1982.

[10] Robert F Engle and Simone Manganelli. Caviar: Conditional autoregressive value at risk by

regression quantiles. Journal of Business & Economic Statistics  22(4):367–381  2004.

[11] Lijie Fan  Wenbing Huang  Stefano Ermon Chuang Gan  Boqing Gong  and Junzhou Huang.
End-to-end learning of motion representation for video understanding. In Proceedings of the
IEEE Conference on Computer Vision and Pattern Recognition  pages 6016–6025  2018.

[12] Yang Feng  Lin Ma  Wei Liu  Tong Zhang  and Jiebo Luo. Video re-localization. In Proceedings

of the European Conference on Computer Vision (ECCV)  pages 51–66  2018.

[13] Jeff Fleming and Chris Kirby. A closer look at the relation between garch and stochastic

autoregressive volatility. Journal of ﬁnancial econometrics  1(3):365–419  2003.

[14] Philip Hans Franses  Marco Van Der Leij  and Richard Paap. A simple test for garch against a

stochastic volatility model. Journal of Financial Econometrics  6(3):291–306  2007.

[15] Paul Glasserman and Qi Wu. Persistence and procyclicality in margin requirements. Manage-

ment Science  2018.

[16] Lawrence R Glosten  Ravi Jagannathan  and David E Runkle. On the relation between the
expected value and the volatility of the nominal excess return on stocks. The journal of ﬁnance 
48(5):1779–1801  1993.

[17] Bruce E Hansen. Autoregressive conditional density estimation. International Economic Review 

pages 705–730  1994.

[18] Sepp Hochreiter and Jürgen Schmidhuber. Long short-term memory. Neural computation 

9(8):1735–1780  1997.

[19] Roger Koenker and Gilbert Bassett Jr. Regression quantiles. Econometrica: journal of the

Econometric Society  pages 33–50  1978.

10

[20] Roger Koenker and Kevin F Hallock. Quantile regression. Journal of economic perspectives 

15(4):143–156  2001.

[21] Paul H Kupiec. Techniques for verifying the accuracy of risk measurement models. The Journal

of Derivatives  3(2):73–84  1995.

[22] Ángel León  Gonzalo Rubio  and Gregorio Serna. Autoregresive conditional volatility  skewness

and kurtosis. The Quarterly Review of Economics and Finance  45(4-5):599–618  2005.

[23] Zachary C Lipton  John Berkowitz  and Charles Elkan. A critical review of recurrent neural

networks for sequence learning. arXiv preprint arXiv:1506.00019  2015.

[24] Daniel B Nelson. Conditional heteroskedasticity in asset returns: A new approach. Economet-

rica: Journal of the Econometric Society  pages 347–370  1991.

[25] Michael Rockinger and Eric Jondeau. Entropy densities with an application to autoregressive

conditional skewness and kurtosis. Journal of Econometrics  106(1):119–142  2002.

[26] Vidyashankar Sivakumar and Arindam Banerjee. High-dimensional structured quantile regres-

sion. In International Conference on Machine Learning  pages 3220–3229  2017.

[27] Ichiro Takeuchi  Quoc V Le  Timothy D Sears  and Alexander J Smola. Nonparametric quantile

estimation. Journal of Machine Learning Research  7(Jul):1231–1264  2006.

[28] Stephen J Taylor. Modeling stochastic volatility: A review and comparative study. Mathematical

ﬁnance  4(2):183–204  1994.

[29] Bairui Wang  Lin Ma  Wei Zhang  and Wei Liu. Reconstruction network for video captioning.
In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition  pages
7622–7631  2018.

[30] Jingwen Wang  Wenhao Jiang  Lin Ma  Wei Liu  and Yong Xu. Bidirectional attentive fusion
with context gating for dense video captioning. In Proceedings of the IEEE Conference on
Computer Vision and Pattern Recognition  pages 7190–7198  2018.

[31] Jiyan Yang  Xiangrui Meng  and Michael Mahoney. Quantile regression for large-scale applica-

tions. In International Conference on Machine Learning  pages 881–887  2013.

[32] Jean-Michel Zakoian. Threshold heteroskedastic models. Journal of Economic Dynamics and

control  18(5):931–955  1994.

11

,Noga Alon
Nicolò Cesa-Bianchi
Claudio Gentile
Yishay Mansour
Xing Yan
Weizhong Zhang
Lin Ma
Wei Liu
Qi Wu
Eugene Ndiaye
Ichiro Takeuchi